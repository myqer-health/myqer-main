<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MYQERâ„¢ - Your FREE Emergency QR Card</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Toast notifications */
        .toast-area {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3000;
            pointer-events: none;
        }

        .toast {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            margin-bottom: 0.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 0.875rem;
            font-weight: 500;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            pointer-events: auto;
            max-width: 400px;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            border-left: 4px solid #10B981;
            color: #065F46;
        }

        .toast.error {
            border-left: 4px solid #EF4444;
            color: #991B1B;
        }

        .toast.info {
            border-left: 4px solid #3B82F6;
            color: #1E40AF;
        }

        :root {
            --red: #D32F2F;
            --ink: #0F172A;
            --slate: #64748B;
            --bg: #F8FAFC;
            --white: #FFFFFF;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #FFFFFF;
            color: var(--ink);
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(211, 47, 47, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(15, 23, 42, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 60% 20%, rgba(211, 47, 47, 0.02) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* Medical floating elements */
        .floating-bg {
            position: fixed;
            pointer-events: none;
            z-index: -1;
        }

        .floating-heart {
            width: 60px;
            height: 60px;
            opacity: 0.1;
            animation: floatMedical 25s ease-in-out infinite;
        }

        .floating-stethoscope {
            width: 80px;
            height: 80px;
            opacity: 0.08;
            animation: floatMedical 30s ease-in-out infinite;
        }

        .floating-cross {
            width: 40px;
            height: 40px;
            opacity: 0.12;
            animation: floatMedical 20s ease-in-out infinite;
        }

        .floating-pulse {
            width: 120px;
            height: 40px;
            opacity: 0.06;
            animation: floatMedical 35s ease-in-out infinite;
        }

        .medical-element-1 {
            top: 15%;
            left: 8%;
            animation-delay: 0s;
        }

        .medical-element-2 {
            top: 25%;
            right: 12%;
            animation-delay: 8s;
        }

        .medical-element-3 {
            bottom: 30%;
            left: 15%;
            animation-delay: 16s;
        }

        .medical-element-4 {
            top: 60%;
            right: 20%;
            animation-delay: 4s;
        }

        .medical-element-5 {
            bottom: 15%;
            right: 8%;
            animation-delay: 12s;
        }

        .medical-element-6 {
            top: 40%;
            left: 5%;
            animation-delay: 20s;
        }

        .floating-grid {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(211, 47, 47, 0.015) 1px, transparent 1px),
                linear-gradient(90deg, rgba(211, 47, 47, 0.015) 1px, transparent 1px);
            background-size: 120px 120px;
            animation: gridMove 40s linear infinite;
            opacity: 0.2;
        }

        @keyframes floatMedical {
            0%, 100% { 
                transform: translateY(0px) translateX(0px) rotate(0deg);
                opacity: 0.08;
            }
            25% { 
                transform: translateY(-40px) translateX(30px) rotate(5deg);
                opacity: 0.15;
            }
            50% { 
                transform: translateY(-80px) translateX(-20px) rotate(-3deg);
                opacity: 0.12;
            }
            75% { 
                transform: translateY(-30px) translateX(-40px) rotate(2deg);
                opacity: 0.18;
            }
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(120px, 120px); }
        }

        /* Header */
        header {
            position: fixed;
            top: 1rem;
            left: 2rem;
            right: 2rem;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            animation: float 6s ease-in-out infinite;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo h1 {
            font-size: 1.75rem;
            font-weight: 800;
            letter-spacing: -0.02em;
        }

        .logo-myq {
            color: #0F172A;
        }

        .logo-er {
            color: #D32F2F;
        }

        .logo-tm {
            color: #0F172A;
            font-size: 0.8em;
            vertical-align: super;
        }

        .logo-sub {
            font-size: 0.75rem;
            color: var(--slate);
            font-style: italic;
            font-weight: 400;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        #langSelector {
            background: var(--white);
            border: 1px solid rgba(100, 116, 139, 0.2);
            border-radius: 20px;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            cursor: pointer;
            position: relative;
        }

        .lang-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--white);
            border: 1px solid rgba(100, 116, 139, 0.2);
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            min-width: 120px;
            display: none;
        }

        .lang-dropdown button {
            width: 100%;
            padding: 0.75rem 1rem;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .lang-dropdown button:hover {
            background: var(--bg);
        }

        #menuToggle {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .hamburger-line {
            width: 20px;
            height: 2px;
            background: var(--ink);
            border-radius: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--red) 0%, #B71C1C 100%);
            color: var(--white);
            border: none;
            border-radius: 16px;
            padding: 1rem 2.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 8px 32px rgba(211, 47, 47, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            letter-spacing: 0.01em;
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #B71C1C 0%, #8B0000 100%);
            transform: translateY(-4px);
            box-shadow: 
                0 16px 48px rgba(211, 47, 47, 0.35),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-outline {
            background: rgba(255, 255, 255, 0.6);
            color: var(--ink);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 16px;
            padding: 1rem 2.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            letter-spacing: 0.01em;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            position: relative;
            overflow: hidden;
        }

        .btn-outline::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(15, 23, 42, 0.1), transparent);
            transition: left 0.6s;
        }

        .btn-outline:hover::before {
            left: 100%;
        }

        .btn-outline:hover {
            background: rgba(15, 23, 42, 0.9);
            color: var(--white);
            border-color: rgba(15, 23, 42, 0.9);
            transform: translateY(-4px);
            box-shadow: 
                0 16px 48px rgba(15, 23, 42, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Menu Sheet */
        #menuSheet {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100vh;
            background: var(--white);
            box-shadow: -10px 0 25px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            z-index: 1002;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        #menuSheet.open {
            transform: translateX(0);
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .menu-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        #menuClose {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--slate);
        }

        .menu-items {
            margin-top: 3rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .menu-items button {
            background: none;
            border: none;
            font-size: 1.125rem;
            font-weight: 500;
            text-align: left;
            cursor: pointer;
            color: var(--ink);
            padding: 0.5rem 0;
        }

        .menu-items button:hover {
            color: var(--red);
        }

        /* Main Content */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 8rem 2rem 2rem;
            text-align: center;
            min-height: calc(100vh - 100px);
        }

        #hero {
            max-width: 600px;
            margin-bottom: 3rem;
        }

        #heroTitle {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            line-height: 1.1;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, var(--ink) 0%, var(--slate) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .free-text {
            color: #D32F2F !important;
            font-weight: 900 !important;
            background: none !important;
            -webkit-text-fill-color: #D32F2F !important;
        }

        #heroSubtitle {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--red);
            margin-bottom: 1.5rem;
            letter-spacing: -0.01em;
        }

        #heroSupport {
            font-size: 1.25rem;
            color: var(--slate);
            margin-bottom: 0.75rem;
            font-weight: 400;
            line-height: 1.6;
        }

        #heroPronounce {
            font-size: 0.875rem;
            color: var(--slate);
            font-style: italic;
            margin-bottom: 2rem;
        }

        .cta-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 3rem;
        }

        /* Value Propositions Section */
        #valueProps {
            max-width: 800px;
            margin-bottom: 3rem;
            text-align: center;
        }

        .value-badge {
            position: relative;
            display: inline-block;
            background: linear-gradient(135deg, #E5E7EB 0%, #F9FAFB 50%, #E5E7EB 100%);
            border: 2px solid rgba(156, 163, 175, 0.3);
            border-radius: 50px;
            padding: 1rem 2.5rem;
            margin-bottom: 2.5rem;
            overflow: hidden;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.9),
                inset 0 -1px 0 rgba(156, 163, 175, 0.2);
        }

        .badge-shine {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            animation: platinumShine 3s ease-in-out infinite;
        }

        .badge-text {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--ink);
            letter-spacing: 0.02em;
            text-transform: uppercase;
            position: relative;
            z-index: 1;
        }

        .value-highlights {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
            align-items: center;
        }

        .value-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.1rem;
            color: var(--ink);
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.7) 0%, rgba(255, 255, 255, 0.4) 100%);
            backdrop-filter: blur(30px);
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            position: relative;
            overflow: hidden;
            min-width: 320px;
        }

        .value-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(211, 47, 47, 0.05), transparent);
            transition: left 0.6s;
        }

        .value-item:hover::before {
            left: 100%;
        }

        .value-item:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            border-color: rgba(211, 47, 47, 0.2);
        }

        .value-dot {
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, var(--red) 0%, #B71C1C 100%);
            border-radius: 50%;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(211, 47, 47, 0.3);
        }

        .value-item strong {
            color: var(--red);
            font-weight: 700;
        }

        @keyframes platinumShine {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }

        /* Footer */
        #trustNote {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.875rem;
            color: var(--slate);
            text-align: center;
            max-width: 600px;
            padding: 1.5rem 2rem;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 24px;
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-weight: 500;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        #trustNote::before {
            content: '';
            width: 16px;
            height: 16px;
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            border-radius: 50%;
            flex-shrink: 0;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.open {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(30px);
            border-radius: 32px;
            padding: 3rem;
            max-width: 420px;
            width: 90%;
            position: relative;
            box-shadow: 
                0 32px 64px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--slate);
        }

        .modal h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid rgba(100, 116, 139, 0.2);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--red);
        }

        .password-field {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: var(--slate);
            font-size: 0.875rem;
        }

        .modal-actions {
            margin: 1.5rem 0;
        }

        .modal-links {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .link {
            background: none;
            border: none;
            color: var(--red);
            cursor: pointer;
            font-size: 0.875rem;
            text-decoration: underline;
        }

        .legal-text {
            font-size: 0.75rem;
            color: var(--slate);
            text-align: center;
            line-height: 1.4;
        }

        .legal-text a {
            color: var(--red);
            text-decoration: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                padding: 1rem 1.5rem;
            }

            #heroTitle {
                font-size: 2.5rem;
            }

            #heroSubtitle {
                font-size: 1.375rem;
            }

            .cta-buttons {
                flex-direction: column;
                align-items: center;
                gap: 1rem;
            }

            .cta-buttons button {
                width: 100%;
                max-width: 280px;
            }

            .value-item {
                min-width: 280px;
                font-size: 1rem;
            }

            .badge-text {
                font-size: 1rem;
            }

            main {
                padding: 5rem 1.5rem 1.5rem;
            }

            .floating-heart, .floating-stethoscope, .floating-cross, .floating-pulse {
                display: none;
            }
        }

        /* RTL Support */
        [dir="rtl"] {
            text-align: right;
        }

        [dir="rtl"] .header-controls {
            flex-direction: row-reverse;
        }

        [dir="rtl"] #menuSheet {
            right: auto;
            left: 0;
            transform: translateX(-100%);
        }

        [dir="rtl"] #menuSheet.open {
            transform: translateX(0);
        }

        /* Floating animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Reset password view */
        #viewReset {
            display: none;
        }

        #viewReset.active {
            display: block;
        }

        #viewLogin.hidden {
            display: none;
        }

        /* Focus styles for accessibility */
        button:focus,
        input:focus {
            outline: 2px solid var(--red);
            outline-offset: 2px;
        }

        /* No scroll class */
        .no-scroll {
            overflow: hidden;
        }

        /* Toast area in modal */
        #toastArea {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3001;
            pointer-events: none;
            font-size: 0.875rem;
            color: var(--slate);
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #toastArea.success {
            color: #10B981;
            opacity: 1;
        }

        #toastArea.error {
            color: #EF4444;
            opacity: 1;
        }

        #toastArea.info {
            color: #3B82F6;
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Medical Floating Background Elements -->
    <div class="floating-bg floating-grid"></div>
    
    <!-- Heart SVG -->
    <div class="floating-bg floating-heart medical-element-1">
        <svg viewBox="0 0 24 24" fill="currentColor" style="color: #D32F2F;">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
    </div>
    
    <!-- Stethoscope SVG -->
    <div class="floating-bg floating-stethoscope medical-element-2">
        <svg viewBox="0 0 24 24" fill="currentColor" style="color: #64748B;">
            <path d="M19 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 3c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-8-3c0-1.66-1.34-3-3-3S5 6.34 5 8v6c0 1.66 1.34 3 3 3s3-1.34 3-3V8zm-2 6c0 .55-.45 1-1 1s-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v6zm6-6v2.5c0 .83-.67 1.5-1.5 1.5S11 11.33 11 10.5V8c0-2.21-1.79-4-4-4S3 5.79 3 8v2.5c0 .83.67 1.5 1.5 1.5S6 11.33 6 10.5V8c0-1.1.9-2 2-2s2 .9 2 2v2.5c0 1.93 1.57 3.5 3.5 3.5S17 12.43 17 10.5V8h-2z"/>
        </svg>
    </div>
    
    <!-- Medical Cross SVG -->
    <div class="floating-bg floating-cross medical-element-3">
        <svg viewBox="0 0 24 24" fill="currentColor" style="color: #D32F2F;">
            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14h-4v-4H6v-2h4V7h4v4h4v2h-4v4z"/>
        </svg>
    </div>
    
    <!-- Pulse/EKG SVG -->
    <div class="floating-bg floating-pulse medical-element-4">
        <svg viewBox="0 0 24 24" fill="currentColor" style="color: #64748B;">
            <path d="M3 13h2l2-7 4 12 4-9 2 4h4v-2h-2.8l-1.2-2.4L15 17l-4-12L7 12l-1.8-5H3v2z"/>
        </svg>
    </div>
    
    <!-- Additional medical elements -->
    <div class="floating-bg floating-heart medical-element-5">
        <svg viewBox="0 0 24 24" fill="currentColor" style="color: #D32F2F;">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
    </div>
    
    <div class="floating-bg floating-cross medical-element-6">
        <svg viewBox="0 0 24 24" fill="currentColor" style="color: #D32F2F;">
            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14h-4v-4H6v-2h4V7h4v4h4v2h-4v4z"/>
        </svg>
    </div>

    <!-- Header -->
    <header>
        <div class="logo">
            <h1><span class="logo-myq">MYQ</span><span class="logo-er">ER</span><span class="logo-tm">â„¢</span></h1>
            <span class="logo-sub">pronounced "My Care"</span>
        </div>
        <div class="header-controls">
            <div style="position: relative;">
                <button id="langSelector" aria-haspopup="true" aria-expanded="false">EN</button>
                <div class="lang-dropdown" id="langDropdown">
                    <button data-lang="en">EN</button>
                    <button data-lang="es">ES</button>
                    <button data-lang="fr">FR</button>
                    <button data-lang="de">DE</button>
                    <button data-lang="it">IT</button>
                    <button data-lang="pt">PT</button>
                    <button data-lang="ro">RO</button>
                    <button data-lang="ar">AR</button>
                    <button data-lang="hi">HI</button>
                    <button data-lang="zh">ZH</button>
                </div>
            </div>
            <button id="menuToggle" aria-controls="menuSheet" aria-expanded="false">
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
            </button>
            <button id="btnOpenApp" class="btn-primary" data-i18n="menu.openApp">Open App</button>
        </div>
    </header>

    <!-- Menu Sheet -->
    <div class="menu-overlay" id="menuOverlay"></div>
    <aside id="menuSheet" hidden>
        <button id="menuClose" aria-label="Close menu">âœ•</button>
        <nav class="menu-items">
            <button id="navAbout" data-i18n="menu.about">About</button>
            <button id="navClinician" data-i18n="menu.clinician">Clinician</button>
            <button id="navHow" data-i18n="menu.how">How it works</button>
            <button id="navPrivacy" data-i18n="menu.privacy">Privacy</button>
            <button id="navTerms" data-i18n="menu.terms">Terms</button>
            <button id="navContact" data-i18n="menu.contact">Contact</button>
        </nav>
    </aside>

    <!-- Main Content -->
    <main>
        <section id="hero">
            <h1 id="heroTitle" data-i18n="hero.title">Your <span class="free-text" data-i18n="hero.free">FREE</span> emergency QR card.</h1>
            <h2 id="heroSubtitle" data-i18n="hero.subtitle">One scan, instant triage.</h2>
            <p id="heroSupport" data-i18n="hero.support">A QR triage code to guide responders â€” anywhere, anytime.</p>
            <p id="heroPronounce" data-i18n="hero.pronounce">(pronounced "My Care")</p>
            
            <div class="cta-buttons">
                <button id="btnCreate" class="btn-primary" data-i18n="cta.create">Create Account</button>
                <button id="btnLogin" class="btn-outline" data-i18n="cta.signin">Sign In</button>
            </div>
        </section>

        <section id="valueProps">
            <div class="value-badge">
                <div class="badge-shine"></div>
                <span class="badge-text" data-i18n="value.access">People â€” Essential Access</span>
            </div>
            
            <div class="value-highlights">
                <div class="value-item">
                    <span class="value-dot"></span>
                    <span data-i18n="value.free">Free to use (No cost â€¢ No trial â€¢ No ads)</span>
                </div>
                <div class="value-item">
                    <span class="value-dot"></span>
                    <span data-i18n="value.card">Emergency card (allergies, meds, ICE)</span>
                </div>
                <div class="value-item">
                    <span class="value-dot"></span>
                    <span data-i18n="value.offline">Works offline (no signal needed)</span>
                </div>
                <div class="value-item">
                    <span class="value-dot"></span>
                    <span data-i18n="value.diy">DIY printable QR tags & stickers</span>
                </div>
                <div class="value-item">
                    <span class="value-dot"></span>
                    <span data-i18n="value.multi">Multi-language</span>
                </div>
                <div class="value-item">
                    <span class="value-dot"></span>
                    <span data-i18n="value.privacy">Zero tracking & on-device privacy</span>
                </div>
            </div>
        </section>

        <footer id="trustNote">
            <span data-i18n="footer.trust">GDPR & HIPAA compliant. Your emergency info stays private until you choose to share.</span>
        </footer>
    </main>

    <!-- Login Modal -->
    <div id="modalLogin" class="modal" role="dialog" aria-labelledby="loginTitle" hidden>
        <div class="modal-content">
            <button class="modal-close" aria-label="Close modal">âœ•</button>
            
            <!-- Login View -->
            <div id="viewLogin">
                <h2 id="loginTitle" data-i18n="login.title">Sign in to MYQER</h2>
                <form>
                    <div class="form-group">
                        <input id="loginFullname" type="text" data-i18n-placeholder="common.fullname" placeholder="Full Name" style="display: none;">
                        <input id="loginEmail" type="email" data-i18n-placeholder="common.email" placeholder="Email" required aria-label="Email">
                    </div>
                    <div class="form-group">
                        <div class="password-field">
                            <input id="loginPassword" type="password" data-i18n-placeholder="common.password" placeholder="Password" required aria-label="Password">
                            <button type="button" class="password-toggle" id="loginPasswordToggle" data-i18n="common.show">Show</button>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button id="doLogin" type="submit" class="btn-primary" style="width: 100%;" data-i18n="cta.signin">Sign In</button>
                    </div>
                </form>
                <div class="modal-links">
                    <button id="linkToRegister" class="link" data-i18n="cta.create">Create Account</button>
                    <button id="linkForgot" class="link" data-i18n="login.forgot">Forgot password?</button>
                </div>
                <p class="legal-text">
                    <span data-i18n="common.legalPrefix">By continuing you agree to our</span> <a href="/terms.html" id="linkTerms" data-i18n="common.terms">Terms</a> <span>and</span> <a href="/privacy.html" id="linkPrivacy" data-i18n="common.privacy">Privacy</a>
                </p>
            </div>

            <!-- Reset Password View -->
            <div id="viewReset">
                <h3 data-i18n="reset.title">Reset Password</h3>
                <form>
                    <div class="form-group">
                        <input id="resetEmail" type="email" data-i18n-placeholder="common.email" placeholder="Email" required aria-label="Email">
                    </div>
                    <div class="modal-actions">
                        <button id="doSendReset" type="submit" class="btn-primary" style="width: 100%;" data-i18n="reset.send">Send Reset Link</button>
                    </div>
                </form>
                <div class="modal-links">
                    <button id="linkBackToLogin" class="link" data-i18n="register.back">Back to sign in</button>
                </div>
            </div>

            <div id="toastArea" aria-live="polite"></div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="modalRegister" class="modal" role="dialog" aria-labelledby="registerTitle" hidden>
        <div class="modal-content">
            <button class="modal-close" aria-label="Close modal">âœ•</button>
            <h2 id="registerTitle" data-i18n="register.title">Create your MYQER account</h2>
            <form>
                <div class="form-group">
                    <input id="registerFullname" type="text" data-i18n-placeholder="common.fullname" placeholder="Full Name" required aria-label="Full Name">
                </div>
                <div class="form-group">
                    <input id="registerEmail" type="email" data-i18n-placeholder="common.email" placeholder="Email" required aria-label="Email">
                </div>
                <div class="form-group">
                    <div class="password-field">
                        <input id="registerPassword" type="password" data-i18n-placeholder="common.password" placeholder="Password" required aria-label="Password">
                        <button type="button" class="password-toggle" id="registerPasswordToggle" data-i18n="common.show">Show</button>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="doRegister" type="submit" class="btn-primary" style="width: 100%;" data-i18n="cta.create">Create Account</button>
                </div>
            </form>
            <div class="modal-links">
                <button id="linkToLogin" class="link" data-i18n="register.back">Already have an account? Sign in</button>
            </div>
            <p class="legal-text">
                <span data-i18n="common.legalPrefix">By continuing you agree to our</span> <a href="/terms.html" data-i18n="common.terms">Terms</a> <span>and</span> <a href="/privacy.html" data-i18n="common.privacy">Privacy</a>
            </p>
            
            <div id="toastAreaRegister" aria-live="polite"></div>
        </div>
    </div>

    <!-- Global Toast Area -->
    <div class="toast-area" id="globalToastArea" aria-live="polite"></div>

    <script>
        /////////////////////////////////////////
        // 1) Supabase Setup & Auth Handling
        /////////////////////////////////////////
        const SUPABASE_URL = 'https://your-project.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key';
        const DASHBOARD_URL = '/dashboard.html';

        let supabase = null;
        let isSupabaseAvailable = false;

        // Initialize Supabase
        try {
            if (window.supabase && SUPABASE_URL && SUPABASE_ANON_KEY) {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
                    auth: {
                        autoRefreshToken: true,
                        persistSession: true,
                        detectSessionInUrl: true,
                        flowType: 'pkce'
                    }
                });
                isSupabaseAvailable = true;
                console.log('âœ… Supabase initialized successfully');
            }
        } catch (error) {
            console.warn('âš ï¸ Supabase initialization failed, falling back to demo mode:', error);
            isSupabaseAvailable = false;
        }

        // Handle authentication redirects and deep links
        document.addEventListener('DOMContentLoaded', async () => {
            if (!isSupabaseAvailable) {
                console.log('ðŸ“± Running in demo mode - authentication will be simulated');
                handleDeepLinks();
                return;
            }

            try {
                const url = new URL(window.location.href);

                // A) Magic link (hash tokens)
                const hash = new URLSearchParams(url.hash.slice(1));
                if (hash.get("access_token") && hash.get("refresh_token")) {
                    const { error } = await supabase.auth.setSession({
                        access_token: hash.get("access_token"),
                        refresh_token: hash.get("refresh_token"),
                    });
                    if (error) console.error("setSession:", error);
                    history.replaceState({}, "", url.origin + url.pathname + url.search);
                }

                // B) PKCE / OAuth (?code=...)
                if (url.searchParams.get("code")) {
                    const { error } = await supabase.auth.exchangeCodeForSession(url.toString());
                    if (error) console.error("exchangeCodeForSession:", error);
                    history.replaceState({}, "", url.origin + url.pathname);
                }

                // Deep link to open modals
                const auth = (url.searchParams.get("auth") || "").toLowerCase();
                if (auth === "login") openModal("login");
                if (auth === "register") openModal("register");
            } catch (error) {
                console.error('Auth redirect handling failed:', error);
            }

            handleDeepLinks();
        });

        function handleDeepLinks() {
            const url = new URL(window.location.href);
            const auth = (url.searchParams.get("auth") || "").toLowerCase();
            if (auth === "login") openModal("login");
            if (auth === "register") openModal("register");
        }

        /////////////////////////////////////////
        // 2) Tiny helpers (qs, toast, rtl etc.)
        /////////////////////////////////////////
        const $ = (id) => document.getElementById(id);
        const on = (el, ev, fn) => el && el.addEventListener(ev, fn);

        const toast = (msg, type="info") => {
            const area = $("toastArea");
            if (!area) {
                showToast(msg, type);
                return;
            }
            area.textContent = msg;
            area.className = type;
            setTimeout(() => {
                area.textContent = "";
                area.className = "";
            }, 3000);
        };

        const setRTL = (lang) => {
            const rtl = lang === "ar";
            document.documentElement.setAttribute("lang", lang);
            document.documentElement.setAttribute("dir", rtl ? "rtl" : "ltr");
        };

        /////////////////////////////////////////
        // 3) i18n (EN base + external overrides)
        /////////////////////////////////////////
        const I18N_KEYS = {
            "hero.title": "Your FREE emergency QR card.",
            "hero.subtitle": "One scan, instant triage.",
            "hero.support": "A QR triage code to guide responders â€” anywhere, anytime.",
            "hero.pronounce": "(pronounced \"My Care\")",
            "cta.create": "Create Account",
            "cta.signin": "Sign In",
            "menu.openApp": "Open App",
            "menu.about": "About",
            "menu.clinician": "Clinician",
            "menu.how": "How it works",
            "menu.privacy": "Privacy",
            "menu.terms": "Terms",
            "menu.contact": "Contact",
            "value.access": "People â€” Essential Access",
            "value.free": "Free to use (No cost â€¢ No trial â€¢ No ads)",
            "value.card": "Emergency card (allergies, meds, ICE)",
            "value.offline": "Works offline (no signal needed)",
            "value.diy": "DIY printable QR tags & stickers",
            "value.multi": "Multi-language",
            "value.privacy": "Zero tracking & on-device privacy",
            "footer.trust": "GDPR & HIPAA compliant. Your emergency info stays private until you choose to share.",
            "login.title": "Sign in to MYQER",
            "login.forgot": "Forgot password?",
            "register.title": "Create your MYQER account",
            "register.back": "Back to sign in",
            "reset.title": "Reset Password",
            "reset.send": "Send Reset Link",
            "common.fullname": "Full Name",
            "common.email": "Email",
            "common.password": "Password",
            "common.show": "Show",
            "common.hide": "Hide",
            "common.terms": "Terms",
            "common.privacy": "Privacy",
            "common.legalPrefix": "By continuing you agree to our"
        };

        // External locales hook (optional): window.MYQER_LOCALES = { es:{...}, fr:{...}, ... }
        let currentLang = "en";
        const getLocale = () => (window.MYQER_LOCALES?.[currentLang] || {});
        const t = (key) => getLocale()[key] ?? I18N_KEYS[key] ?? key;

        const bindText = () => {
            const map = {
                heroTitle: "hero.title",
                heroSubtitle: "hero.subtitle",
                heroSupport: "hero.support",
                heroPronounce: "hero.pronounce",
                btnCreate: "cta.create",
                btnLogin: "cta.signin",
                btnOpenApp: "menu.openApp",
                navAbout: "menu.about",
                navClinician: "menu.clinician",
                navHow: "menu.how",
                navPrivacy: "menu.privacy",
                navTerms: "menu.terms",
                navContact: "menu.contact",
                trustNote: "footer.trust",
            };
            Object.entries(map).forEach(([id, key]) => {
                const el = $(id);
                if (el) el.textContent = t(key);
            });
            // value row items: expect <span data-i18n="value.free"> etc.
            document.querySelectorAll("[data-i18n]").forEach(el => {
                const k = el.getAttribute("data-i18n");
                el.textContent = t(k);
            });
            
            // Update placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                const translation = t(key);
                if (translation) {
                    el.placeholder = translation;
                }
            });
        };

        // Update all i18n elements
        function updateLanguage(lang) {
            currentLang = lang;
            
            // Handle RTL for Arabic
            setRTL(lang);
            
            // Bind all text
            bindText();

            // Update language selector
            const langMap = {
                'en': 'EN', 'es': 'ES', 'fr': 'FR', 'de': 'DE', 
                'it': 'IT', 'pt': 'PT', 'ro': 'RO', 'ar': 'AR', 
                'hi': 'HI', 'zh': 'ZH'
            };
            document.getElementById('langSelector').textContent = langMap[lang] || 'EN';
        }

        // Toast notification system
        function showToast(message, type = 'success', duration = 4000) {
            const toastArea = document.getElementById('globalToastArea');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            toastArea.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Remove toast
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toastArea.contains(toast)) {
                        toastArea.removeChild(toast);
                    }
                }, 300);
            }, duration);
        }

        /////////////////////////////////////////
        // 4) Menu sheet + language chooser
        /////////////////////////////////////////
        const menu = {
            sheet: $("menuSheet"),
            toggle: $("menuToggle"),
            close: $("menuClose"),
            overlay: $("menuOverlay")
        };
        const openSheet = () => { 
            menu.sheet.hidden = false; 
            menu.sheet.classList.add('open');
            menu.overlay.classList.add('open');
            document.body.classList.add("no-scroll"); 
        };
        const closeSheet = () => { 
            menu.sheet.classList.remove('open');
            menu.overlay.classList.remove('open');
            document.body.classList.remove("no-scroll"); 
            setTimeout(() => {
                menu.sheet.hidden = true;
            }, 300);
        };

        on(menu.toggle, "click", () => (menu.sheet.hidden ? openSheet() : closeSheet()));
        on(menu.close, "click", closeSheet);
        on(menu.overlay, "click", closeSheet);

        // Language selector
        const langSelector = document.getElementById('langSelector');
        const langDropdown = document.getElementById('langDropdown');

        langSelector.addEventListener('click', () => {
            const isOpen = langDropdown.style.display === 'block';
            langDropdown.style.display = isOpen ? 'none' : 'block';
            langSelector.setAttribute('aria-expanded', !isOpen);
        });

        // Language selection
        langDropdown.addEventListener('click', (e) => {
            if (e.target.dataset.lang) {
                currentLang = e.target.dataset.lang;
                langSelector.textContent = (currentLang || "EN").toUpperCase();
                setRTL(currentLang);
                bindText();
                langDropdown.style.display = 'none';
                langSelector.setAttribute('aria-expanded', 'false');
            }
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!langSelector.contains(e.target) && !langDropdown.contains(e.target)) {
                langDropdown.style.display = 'none';
                langSelector.setAttribute('aria-expanded', 'false');
            }
        });

        // Menu navigation
        document.getElementById('navAbout').addEventListener('click', () => window.location.href = '/about.html');
        document.getElementById('navClinician').addEventListener('click', () => window.location.href = '/clinician.html');
        document.getElementById('navHow').addEventListener('click', () => window.location.href = '/app.html');
        document.getElementById('navPrivacy').addEventListener('click', () => window.location.href = '/privacy.html');
        document.getElementById('navTerms').addEventListener('click', () => window.location.href = '/terms.html');
        document.getElementById('navContact').addEventListener('click', () => window.location.href = '/contact.html');

        /////////////////////////////////////////
        // 5) Modals open/close + toggles
        /////////////////////////////////////////
        const modals = {
            login: $("modalLogin"),
            register: $("modalRegister"),
        };

        function openModal(which) {
            const el = modals[which];
            if (!el) return;
            el.hidden = false;
            el.classList.add('open');
            document.body.classList.add("no-scroll");
            if (which === 'login') {
                showLoginView();
            }
        }
        function closeModal(which) {
            const el = modals[which];
            if (!el) return;
            el.classList.remove('open');
            document.body.classList.remove("no-scroll");
            setTimeout(() => {
                el.hidden = true;
            }, 300);
        }

        // Switchers
        on($("linkToRegister"), "click", () => { closeModal("login"); setTimeout(() => openModal("register"), 300); });
        on($("linkToLogin"), "click", () => { closeModal("register"); setTimeout(() => openModal("login"), 300); });

        // Modal view switching
        function showLoginView() {
            document.getElementById('viewLogin').classList.remove('hidden');
            document.getElementById('viewReset').classList.remove('active');
        }

        function showResetView() {
            document.getElementById('viewLogin').classList.add('hidden');
            document.getElementById('viewReset').classList.add('active');
        }

        // Forgot view (inside login modal)
        const forgotLink = $("linkForgot");
        const viewReset = $("viewReset");
        on(forgotLink, "click", () => { if (viewReset) showResetView(); });

        // Reset password flow
        document.getElementById('linkBackToLogin').addEventListener('click', () => {
            showLoginView();
        });

        // Modal close buttons
        document.querySelectorAll('.modal-close').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modal = e.target.closest('.modal');
                if (modal === modals.login) closeModal('login');
                if (modal === modals.register) closeModal('register');
            });
        });

        // Close modals on overlay click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    if (modal === modals.login) closeModal('login');
                    if (modal === modals.register) closeModal('register');
                }
            });
        });

        // Password toggle functionality
        const wireShowHide = (btnId, inputId) => {
            const btn = $(btnId), input = $(inputId);
            on(btn, "click", (e) => {
                e.preventDefault();
                const pwd = input.type === "password";
                input.type = pwd ? "text" : "password";
                btn.textContent = pwd ? t("common.hide") : t("common.show");
            });
        };
        wireShowHide("loginPasswordToggle", "loginPassword");
        wireShowHide("registerPasswordToggle", "registerPassword");

        // Email validation
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        /////////////////////////////////////////
        // 6) Auth actions (email+password)
        /////////////////////////////////////////
        async function getSession() {
            if (!isSupabaseAvailable) {
                return null;
            }
            try {
                const { data, error } = await supabase.auth.getSession();
                if (error) throw error;
                return data.session;
            } catch (e) {
                console.error("getSession:", e);
                return null;
            }
        }

        // Authentication functions
        async function handleLogin(email, password) {
            if (!isSupabaseAvailable) {
                // Demo mode
                showToast('Welcome back! Redirecting to dashboard...', 'success');
                setTimeout(() => {
                    window.location.href = '/dashboard.html';
                }, 2000);
                return;
            }

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password,
                });

                if (error) {
                    showToast(error.message, 'error');
                    return;
                }

                showToast('Welcome back! Redirecting to dashboard...', 'success');
                setTimeout(() => {
                    window.location.href = '/dashboard.html';
                }, 2000);
            } catch (error) {
                console.error('Login error:', error);
                showToast('Login failed. Please try again.', 'error');
            }
        }

        async function handleRegister(fullname, email, password) {
            if (!isSupabaseAvailable) {
                // Demo mode
                showToast('Account created successfully! Redirecting to dashboard...', 'success');
                setTimeout(() => {
                    window.location.href = '/dashboard.html';
                }, 2000);
                return;
            }

            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: fullname,
                        }
                    }
                });

                if (error) {
                    showToast(error.message, 'error');
                    return;
                }

                if (data.user && !data.user.email_confirmed_at) {
                    showToast('Please check your email to confirm your account!', 'info');
                } else {
                    showToast('Account created successfully! Redirecting to dashboard...', 'success');
                    setTimeout(() => {
                        window.location.href = '/dashboard.html';
                    }, 2000);
                }
            } catch (error) {
                console.error('Registration error:', error);
                showToast('Registration failed. Please try again.', 'error');
            }
        }

        async function handlePasswordReset(email) {
            if (!isSupabaseAvailable) {
                // Demo mode
                showToast('Password reset email sent successfully!', 'success');
                showLoginView();
                return;
            }

            try {
                const { error } = await supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: `${window.location.origin}/reset-password.html`,
                });

                if (error) {
                    showToast(error.message, 'error');
                    return;
                }

                showToast('Password reset email sent successfully!', 'success');
                showLoginView();
            } catch (error) {
                console.error('Password reset error:', error);
                showToast('Password reset failed. Please try again.', 'error');
            }
        }

        // Button event handlers
        on($("btnOpenApp"), "click", async () => {
            const session = await getSession();
            if (session) location.href = '/dashboard.html';
            else openModal("login");
        });

        on($("btnCreate"), "click", () => openModal("register"));
        on($("btnLogin"), "click", () => openModal("login"));

        // Do login
        on($("doLogin"), "click", async () => {
            const email = $("loginEmail")?.value?.trim();
            const password = $("loginPassword")?.value || "";
            if (!email || !password) return toast("Enter email and password", "error");
            const { error } = await window.supabaseClient.auth.signInWithPassword({ email, password });
            if (error) return toast(error.message, "error");
            toast("Welcome back!", "success");
            location.href = DASHBOARD_URL;
        });

        // Do register
        on($("doRegister"), "click", async () => {
            const name = $("registerFullname")?.value?.trim();
            const email = $("registerEmail")?.value?.trim();
            const password = $("registerPassword")?.value || "";
            if (!name || !email || !password) return toast("Fill all fields", "error");
            const { data, error } = await window.supabaseClient.auth.signUp({ email, password });
            if (error) return toast(error.message, "error");
            // Optional: store name later in profile page
            toast("Check your email to confirm.", "success");
            closeModal("register");
        });

        // Reset password
        on($("doSendReset"), "click", async () => {
            const email = $("resetEmail")?.value?.trim();
            if (!email) return toast("Enter your email", "error");
            const { error } = await window.supabaseClient.auth.resetPasswordForEmail(email, {
                redirectTo: location.origin + "/?auth=login" // back to login after reset
            });
            if (error) return toast(error.message, "error");
            toast("Password reset email sent!", "success");
        });

        // Initialize the application
        function initializeApp() {
            // Initialize with English
            updateLanguage('en');
            
            // Ensure login view is shown by default
            showLoginView();
        }

        // Clicking background closes modals (optional: add overlay click handlers if desired)
        document.querySelectorAll('[role="dialog"]').forEach(d => {
            on(d, "click", (e) => { if (e.target === d) d.hidden = true; });
        });

        /////////////////////////////////////////
        // 7) Initial render
        /////////////////////////////////////////
        (() => {
            setRTL(currentLang);
            bindText();
        })();

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (modalLogin.classList.contains('open')) closeModal(modalLogin);
                if (modalRegister.classList.contains('open')) closeModal(modalRegister);
                if (menuSheet.classList.contains('open')) closeMenu();
                if (langDropdown.style.display === 'block') {
                    langDropdown.style.display = 'none';
                    langSelector.setAttribute('aria-expanded', 'false');
                }
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97953931c532496e',t:'MTc1NjkwMjI1OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
