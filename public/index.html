<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MYQER‚Ñ¢ - Your FREE Emergency QR Card. One Scan, Instant Triage.</title>
  <meta name="description" content="MYQER gives responders instant access to your medical info ‚Äî allergies, meds, ICE contacts ‚Äî anywhere, anytime.">
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@100;200;300;400;500;600;700;800;900&family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }

    :root{
      --myqer-red:#ff3b30; --apple-blue:#007aff; --luxury-gold:#ffcc02;
      --pure-white:#fff; --off-white:#fafafa; --light-gray:#f5f5f7;
      --medium-gray:#86868b; --dark-gray:#1d1d1f;
      --glass-white:rgba(255,255,255,.8); --glass-border:rgba(255,255,255,.3);
      --shadow-light:rgba(0,0,0,.05); --shadow-medium:rgba(0,0,0,.1);
      --gradient-bg:linear-gradient(135deg,#fff 0%,#f8f9fa 50%,#fff 100%);
      --glass-gradient:linear-gradient(135deg,rgba(255,255,255,.9) 0%,rgba(255,255,255,.7) 100%);
    }

    body{
      font-family:'SF Pro Display','Inter',-apple-system,BlinkMacSystemFont,sans-serif;
      background:var(--gradient-bg); color:var(--dark-gray); line-height:1.6;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      min-height:100vh; overflow-x:hidden; position:relative;
    }

    /* Premium background pattern */
    body::before{
      content:""; position:fixed; inset:0;
      background-image:
        radial-gradient(circle at 20% 20%, rgba(255,59,48,.03) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(0,122,255,.03) 0%, transparent 50%),
        radial-gradient(circle at 40% 60%, rgba(255,204,2,.02) 0%, transparent 50%);
      background-size:800px 800px, 600px 600px, 400px 400px;
      animation:backgroundFloat 30s ease-in-out infinite;
      z-index:0;
      pointer-events:none; /* never block clicks */
    }
    @keyframes backgroundFloat{
      0%,100%{transform:translate(0,0) rotate(0deg)}
      33%{transform:translate(-20px,-20px) rotate(1deg)}
      66%{transform:translate(20px,-10px) rotate(-1deg)}
    }

    /* Floating icons */
    @keyframes float-elegant{
      0%{transform:translateX(-100vw) translateY(0) rotate(0) scale(.8); opacity:0}
      10%{opacity:.3; transform:translateX(-60vw) translateY(-10px) rotate(15deg) scale(.9)}
      50%{opacity:.6; transform:translateX(50vw) translateY(-30px) rotate(180deg) scale(1)}
      90%{opacity:.3; transform:translateX(110vw) translateY(-10px) rotate(345deg) scale(.9)}
      100%{transform:translateX(120vw) translateY(0) rotate(360deg) scale(.8); opacity:0}
    }
    @keyframes float-reverse{
      0%{transform:translateX(120vw) translateY(0) rotate(0) scale(.8); opacity:0}
      10%{opacity:.3; transform:translateX(100vw) translateY(10px) rotate(-15deg) scale(.9)}
      50%{opacity:.6; transform:translateX(50vw) translateY(20px) rotate(-180deg) scale(1)}
      90%{opacity:.3; transform:translateX(-10vw) translateY(5px) rotate(-345deg) scale(.9)}
      100%{transform:translateX(-100vw) translateY(0) rotate(-360deg) scale(.8); opacity:0}
    }
    .animate-float-elegant{animation:float-elegant 60s linear infinite}
    .animate-float-reverse{animation:float-reverse 65s linear infinite}

    /* FREE highlight */
    @keyframes pulseGold{0%{box-shadow:0 0 5px gold}50%{box-shadow:0 0 20px gold}100%{box-shadow:0 0 5px gold}}
    .free-highlight{color:red!important;font-weight:900;padding:.2em .5em;border:3px solid gold;border-radius:8px;animation:pulseGold 2s infinite;display:inline-block}

    /* Foreground stacking */
    header, main, footer, .menu-sheet, .nav-menu { position:relative; z-index:1 }

    /* Background icon container */
    .bg-animations{ position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden }
    .floating-icon{ position:absolute; font-size:3rem; opacity:.4; filter:drop-shadow(0 0 10px rgba(0,0,0,.1)) }

    /* Header */
    header{
      display:flex; justify-content:space-between; align-items:center;
      padding:1.5rem 2rem; background:rgba(255,255,255,.8);
      backdrop-filter:blur(20px) saturate(180%); border-bottom:1px solid rgba(0,0,0,.05);
    }
    .logo-text{font-size:2rem;font-weight:700;letter-spacing:-.02em}
    .logo-myq{color:var(--dark-gray)} .logo-er{color:var(--myqer-red)} .logo-tm{color:var(--medium-gray);font-size:.7em;vertical-align:super}
    .header-controls{display:flex;align-items:center;gap:1rem}

    /* Language selector */
    .lang-selector{position:relative}
    #langSelector{
      background:rgba(255,255,255,.9); backdrop-filter:blur(10px);
      border:1px solid rgba(0,0,0,.1); border-radius:12px; padding:.5rem 1rem;
      font-weight:500; cursor:pointer; color:var(--dark-gray); transition:.3s; font-size:.875rem; min-width:120px; box-shadow:0 2px 8px var(--shadow-light);
    }
    #langSelector:hover{background:#fff; transform:translateY(-1px); box-shadow:0 4px 16px var(--shadow-medium)}
    .lang-dropdown{
      position:absolute; top:100%; right:0; margin-top:.5rem; min-width:200px;
      background:rgba(255,255,255,.95); backdrop-filter:blur(20px) saturate(180%);
      border:1px solid rgba(0,0,0,.1); border-radius:16px; box-shadow:0 20px 64px var(--shadow-medium);
      display:none; overflow:hidden; z-index:1001;
    }
    .lang-dropdown button{width:100%; padding:.75rem 1rem; border:0; background:none; text-align:left; cursor:pointer; font-weight:500; font-size:.875rem; color:var(--dark-gray)}
    .lang-dropdown button:hover{background:rgba(0,0,0,.05)}

    /* Hamburger & sheet */
    .hamburger{display:flex;flex-direction:column;gap:4px;cursor:pointer;padding:.5rem;border-radius:8px;transition:.3s}
    .hamburger:hover{background:rgba(0,0,0,.05)}
    .hamburger span{width:20px;height:2px;background:var(--dark-gray);border-radius:1px;transition:.3s}

    .menu-sheet{
      position:fixed; top:0; right:-100%; width:320px; height:100vh; padding:2rem;
      background:rgba(255,255,255,.95); backdrop-filter:blur(20px) saturate(180%);
      box-shadow:-10px 0 30px var(--shadow-medium); border-left:1px solid rgba(0,0,0,.1);
      z-index:1000; transition:right .3s cubic-bezier(.4,0,.2,1);
    }
    .menu-sheet.open{right:0}
    .menu-overlay{position:fixed; inset:0; background:rgba(0,0,0,.3); backdrop-filter:blur(4px); z-index:999; opacity:0; visibility:hidden; transition:.3s}
    .menu-overlay.open{opacity:1; visibility:visible}
    .menu-close{position:absolute; top:1rem; right:1rem; background:none; border:0; font-size:1.5rem; cursor:pointer; color:var(--dark-gray); padding:.5rem; border-radius:8px}
    .menu-nav{margin-top:3rem}
    .menu-nav a{display:block; padding:1rem 0; color:var(--dark-gray); text-decoration:none; font-weight:500; font-size:1.125rem; border-bottom:1px solid rgba(0,0,0,.05)}
    .menu-nav a:hover{color:var(--myqer-red); padding-left:1rem}

    /* Main */
    main{display:flex; align-items:center; justify-content:center; padding:4rem 2rem; min-height:80vh}
    .main-content{max-width:1200px; margin:0 auto; text-align:center}
    .main-headline{font-size:4rem;font-weight:700;color:var(--dark-gray);line-height:1.1;margin-bottom:1.5rem;letter-spacing:-.02em}
    .sub-headline{font-size:2.5rem;font-weight:600;color:var(--myqer-red);margin-bottom:1.5rem;letter-spacing:-.01em}
    .description{font-size:1.5rem;color:var(--medium-gray);margin-bottom:1rem}
    .pronunciation{font-size:1.125rem;color:var(--medium-gray);margin-bottom:.5rem;font-style:italic}
    .value-row{max-width:900px;margin:0 auto 3rem;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;text-align:left}
    .value-card{position:relative;padding:1.25rem;background:linear-gradient(135deg,rgba(255,59,48,.08) 0%,rgba(255,255,255,.9) 50%,rgba(255,59,48,.05) 100%);backdrop-filter:blur(20px) saturate(180%);border-radius:16px;border:1px solid rgba(255,59,48,.2);box-shadow:0 4px 16px rgba(255,59,48,.1),0 1px 0 rgba(255,255,255,.5) inset;transition:.4s;overflow:hidden}
    .value-card::before{content:""; position:absolute; top:0; left:0; right:0; height:3px; background:linear-gradient(90deg,var(--myqer-red),var(--luxury-gold),var(--myqer-red))}
    .value-card:hover{transform:translateY(-4px) scale(1.01); box-shadow:0 12px 32px rgba(255,59,48,.2),0 1px 0 rgba(255,255,255,.7) inset}
    .value-card h3{font-size:1rem;font-weight:700;color:var(--myqer-red);margin-bottom:.5rem}
    .value-card p{font-size:.875rem;color:var(--medium-gray)}

    .cta-buttons{display:flex;justify-content:center;gap:1.5rem;flex-wrap:wrap;margin-top:3rem}
    .btn-primary{background:linear-gradient(135deg,var(--myqer-red) 0%,#e60012 100%);color:#fff;border:0;border-radius:16px;padding:1rem 2rem;font-weight:600;font-size:1.125rem;cursor:pointer;transition:.3s;text-decoration:none;display:inline-flex;align-items:center;justify-content:center;box-shadow:0 8px 32px rgba(255,59,48,.3)}
    .btn-primary:hover{transform:translateY(-2px) scale(1.02); box-shadow:0 16px 48px rgba(255,59,48,.4)}
    .btn-secondary{background:var(--glass-gradient);backdrop-filter:blur(20px) saturate(180%);color:var(--dark-gray);border:2px solid rgba(255,59,48,.3);border-radius:16px;padding:1rem 2rem;font-weight:600;font-size:1.125rem;cursor:pointer;transition:.3s;text-decoration:none;display:inline-flex;align-items:center;justify-content:center;box-shadow:0 8px 32px var(--shadow-light)}
    .btn-secondary:hover{background:var(--myqer-red);color:#fff;border-color:var(--myqer-red);transform:translateY(-2px) scale(1.02)}

    /* Auth modal */
    #authModal{position:fixed; inset:0; background:rgba(255,255,255,.8); backdrop-filter:blur(20px) saturate(180%); z-index:9999; display:none; align-items:center; justify-content:center; padding:1rem}
    .auth-dialog{background:rgba(255,255,255,.95); backdrop-filter:blur(20px) saturate(180%); border:1px solid rgba(0,0,0,.1); border-radius:20px; padding:2.5rem; max-width:420px; width:100%; box-shadow:0 32px 80px var(--shadow-medium); position:relative; max-height:90vh; overflow-y:auto}
    #authClose{position:absolute; top:1rem; right:1rem; background:none; border:0; font-size:1.5rem; cursor:pointer; color:var(--medium-gray); width:32px; height:32px; border-radius:8px; display:flex; align-items:center; justify-content:center}
    .auth-view{display:none} .auth-view.active{display:block}
    .auth-header{text-align:center;margin-bottom:2rem}
    .auth-header h2{font-size:1.75rem;font-weight:600;color:var(--dark-gray);margin-bottom:.5rem}
    .form-group{margin-bottom:1.5rem}
    .form-group label{display:block;font-weight:500;color:var(--dark-gray);margin-bottom:.5rem;font-size:.875rem}
    .form-group input{width:100%;padding:.875rem 1rem;border:2px solid rgba(0,0,0,.1);border-radius:12px;font-size:1rem;transition:.2s;background:rgba(255,255,255,.8);color:var(--dark-gray)}
    .form-group input:focus{outline:none;border-color:var(--myqer-red);box-shadow:0 0 0 3px rgba(255,59,48,.1);background:#fff}
    .password-field{position:relative}
    .password-toggle{position:absolute;right:1rem;top:50%;transform:translateY(-50%);background:none;border:0;cursor:pointer;color:var(--medium-gray);font-size:.875rem}
    .auth-button{width:100%;background:linear-gradient(135deg,var(--myqer-red) 0%,#e60012 100%);color:#fff;border:0;border-radius:12px;padding:1rem;font-weight:600;cursor:pointer;transition:.2s;font-size:1rem;margin-bottom:1rem;box-shadow:0 4px 16px rgba(255,59,48,.2)}
    .auth-links{text-align:center}
    .auth-links button{background:none;border:0;color:var(--apple-blue);cursor:pointer;font-size:.875rem;text-decoration:underline;margin:0 .5rem}
    #toastArea{margin-bottom:1rem;padding:.75rem 1rem;border-radius:8px;font-size:.875rem;display:none}
    #toastArea.success{background:rgba(52,199,89,.1);color:#34c759;border:1px solid rgba(52,199,89,.2)}
    #toastArea.error{background:rgba(255,59,48,.1);color:var(--myqer-red);border:1px solid rgba(255,59,48,.2)}

    /* Responsive */
    @media (max-width:768px){
      .main-headline{font-size:2.5rem}
      .sub-headline{font-size:2rem}
      .description{font-size:1.25rem}
      .value-row{grid-template-columns:1fr}
      .cta-buttons{flex-direction:column;align-items:center}
      .btn-primary,.btn-secondary{width:100%;max-width:300px}
      header{padding:1rem}
      main{padding:2rem 1rem}
      .floating-icon{font-size:2.5rem}
      .free-highlight{font-size:1.1em;padding:.6rem 1.2rem}
    }

    /* RTL tweaks */
    [dir="rtl"] .lang-dropdown{right:auto; left:0}
    [dir="rtl"] .password-toggle{right:auto; left:1rem}
    [dir="rtl"] #authClose{right:auto; left:1rem}
    [dir="rtl"] .header-controls{flex-direction:row-reverse}
    [dir="rtl"] .value-row{direction:rtl}
    [dir="rtl"] .main-content{text-align:right}
  </style>
</head>
<body>
  <!-- Animated background -->
  <div class="bg-animations">
    <div class="floating-icon animate-float-elegant" style="top:10%;color:var(--myqer-red)">üíì</div>
    <div class="floating-icon animate-float-reverse" style="top:20%;color:var(--apple-blue)">ü´Ä</div>
    <div class="floating-icon animate-float-elegant" style="top:30%;color:var(--luxury-gold)">‚ù§Ô∏è</div>
    <div class="floating-icon animate-float-reverse" style="top:40%;color:var(--medium-gray)">üíó</div>
    <div class="floating-icon animate-float-reverse" style="top:50%;color:var(--myqer-red)">ü©∫</div>
    <div class="floating-icon animate-float-elegant" style="top:60%;color:var(--apple-blue)">üíä</div>
    <div class="floating-icon animate-float-reverse" style="top:70%;color:var(--luxury-gold)">üöë</div>
    <div class="floating-icon animate-float-elegant" style="top:80%;color:var(--medium-gray)">‚öïÔ∏è</div>
    <div class="floating-icon animate-float-reverse" style="top:15%;color:var(--myqer-red)">üè•</div>
    <div class="floating-icon animate-float-elegant" style="top:25%;color:var(--apple-blue)">üî¨</div>
  </div>

  <!-- Drawer -->
  <div class="menu-overlay" id="menuOverlay"></div>
  <div class="menu-sheet" id="menuSheet">
    <button class="menu-close" id="menuClose">&times;</button>
    <nav class="menu-nav">
      <a href="/about.html" data-i18n="menu.about">About</a>
      <a href="/clinician.html" data-i18n="menu.clinician">Clinician</a>
      <a href="/how.html" data-i18n="menu.how">How it works</a>
      <a href="/privacy.html" data-i18n="menu.privacy">Privacy</a>
      <a href="/terms.html" data-i18n="menu.terms">Terms</a>
      <a href="/contact.html" data-i18n="menu.contact">Contact</a>
    </nav>
    <button class="btn-primary" id="mOpenApp" data-i18n="menu.openApp" style="margin-top:2rem;width:100%">Open App</button>
  </div>

  <!-- Header -->
  <header>
    <div class="logo-text"><span class="logo-myq">MYQ</span><span class="logo-er">ER</span><span class="logo-tm">‚Ñ¢</span></div>
    <div class="header-controls">
      <div class="lang-selector">
        <button id="langSelector" aria-haspopup="true" aria-expanded="false">üá∫üá∏ English</button>
        <div class="lang-dropdown" id="langDropdown">
          <button data-lang="en">üá∫üá∏ English</button><button data-lang="es">üá™üá∏ Espa√±ol</button>
          <button data-lang="fr">üá´üá∑ Fran√ßais</button><button data-lang="de">üá©üá™ Deutsch</button>
          <button data-lang="it">üáÆüáπ Italiano</button><button data-lang="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
          <button data-lang="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button><button data-lang="zh">üá®üá≥ ‰∏≠Êñá</button>
          <button data-lang="hu">üá≠üá∫ Magyar</button><button data-lang="ro">üá∑üá¥ Rom√¢nƒÉ</button>
        </div>
      </div>
      <div class="hamburger" id="menuToggle"><span></span><span></span><span></span></div>
    </div>
  </header>

  <!-- Main -->
  <main>
    <div class="main-content">
      <h2 class="main-headline" id="heroTitle" data-i18n="hero.title">Your <span class="free-highlight">FREE</span> emergency QR card.</h2>
      <h3 class="sub-headline" id="heroSubtitle" data-i18n="hero.subtitle">One scan, instant triage.</h3>
      <p class="description" id="heroSupport" data-i18n="hero.support">A QR triage code to guide responders ‚Äî anywhere, anytime.</p>
      <p class="pronunciation" id="heroPronounce" data-i18n="hero.pronounce">(pronounced "My Care")</p>

      <div class="value-row" id="valueRow">
        <div class="value-card featured"><h3 data-i18n="value.access">People ‚Äî Essential Access</h3><p data-i18n="value.free">Free to use (No cost ‚Ä¢ No trial ‚Ä¢ No ads)</p></div>
        <div class="value-card"><h3 data-i18n="value.card">Emergency card (allergies, meds, ICE)</h3><p data-i18n="value.offline">Works offline (no signal needed)</p></div>
        <div class="value-card"><h3 data-i18n="value.diy">DIY printable QR tags & stickers</h3><p data-i18n="value.multi">Multi-language</p></div>
        <div class="value-card"><h3 data-i18n="value.privacy">Zero tracking & on-device privacy</h3><p data-i18n="footer.trust">GDPR & HIPAA compliant. Your emergency info stays private until you choose to share.</p></div>
      </div>

      <div class="cta-buttons">
        <button class="btn-primary" id="btnCreate" data-i18n="cta.create">Create Account</button>
        <button class="btn-secondary" id="btnLogin" data-i18n="cta.signin">Sign In</button>
      </div>
    </div>
  </main>

  <div class="trust-note" id="trustNote" data-i18n="footer.trust">
    GDPR & HIPAA compliant. Your emergency info stays private until you choose to share.
  </div>

  <!-- Auth Modal -->
  <div id="authModal" role="dialog" aria-labelledby="authTitle" aria-hidden="true">
    <div class="auth-dialog">
      <button id="authClose" aria-label="Close">&times;</button>
      <div id="toastArea" role="alert"></div>

      <!-- Login -->
      <div id="modalLogin" class="auth-view active">
        <div class="auth-header"><h2 id="loginTitle" data-i18n="login.title">Sign in to MYQER</h2></div>
        <form id="loginForm">
          <div class="form-group"><label for="loginEmail" data-i18n="auth.email">Email</label><input type="email" id="loginEmail" required autocomplete="email"></div>
          <div class="form-group"><label for="loginPassword" data-i18n="auth.password">Password</label>
            <div class="password-field"><input type="password" id="loginPassword" required autocomplete="current-password"><button type="button" class="password-toggle" id="toggleLoginPass" data-i18n="auth.show">Show</button></div>
          </div>
          <button type="submit" class="auth-button" id="doLogin" data-i18n="cta.signin">Sign In</button>
        </form>
        <div class="auth-links">
          <button type="button" id="linkToRegister" data-i18n="cta.create">Create Account</button>
          <button type="button" id="linkForgot" data-i18n="login.forgot">Forgot password?</button>
        </div>
        <div class="auth-links" style="margin-top:1rem;font-size:.75rem">
          <button type="button" id="linkTerms" data-i18n="menu.terms">Terms</button>
          <button type="button" id="linkPrivacy" data-i18n="menu.privacy">Privacy</button>
        </div>
      </div>

      <!-- Register -->
      <div id="modalRegister" class="auth-view">
        <div class="auth-header"><h2 id="regTitle" data-i18n="register.title">Create your MYQER account</h2></div>
        <form id="registerForm">
          <div class="form-group"><label for="regName" data-i18n="auth.fullName">Full Name</label><input type="text" id="regName" required autocomplete="name"></div>
          <div class="form-group"><label for="regEmail" data-i18n="auth.email">Email</label><input type="email" id="regEmail" required autocomplete="email"></div>
          <div class="form-group"><label for="regPassword" data-i18n="auth.password">Password</label>
            <div class="password-field"><input type="password" id="regPassword" required autocomplete="new-password" minlength="6"><button type="button" class="password-toggle" id="toggleRegPass" data-i18n="auth.show">Show</button></div>
          </div>
          <button type="submit" class="auth-button" id="doRegister" data-i18n="cta.create">Create Account</button>
        </form>
        <div class="auth-links"><button type="button" id="linkToLogin" data-i18n="register.back">Back to sign in</button></div>
      </div>

      <!-- Reset -->
      <div id="viewReset" class="auth-view">
        <div class="auth-header"><h2 data-i18n="reset.title">Reset Password</h2></div>
        <form id="resetForm">
          <div class="form-group"><label for="resetEmail" data-i18n="auth.email">Email</label><input type="email" id="resetEmail" required autocomplete="email"></div>
          <button type="submit" class="auth-button" id="doSendReset" data-i18n="reset.send">Send Reset Link</button>
        </form>
        <div class="auth-links"><button type="button" id="backToLogin" data-i18n="register.back">Back to sign in</button></div>
      </div>

      <!-- Update -->
      <div id="viewUpdate" class="auth-view">
        <div class="auth-header"><h2 data-i18n="auth.updatePassword">Update Password</h2></div>
        <form id="updateForm">
          <div class="form-group"><label for="newPassword" data-i18n="auth.newPassword">New Password</label>
            <div class="password-field"><input type="password" id="newPassword" required autocomplete="new-password" minlength="6"><button type="button" class="password-toggle" id="toggleNewPass" data-i18n="auth.show">Show</button></div>
          </div>
          <div class="form-group"><label for="confirmPassword" data-i18n="auth.confirmPassword">Confirm Password</label><input type="password" id="confirmPassword" required autocomplete="new-password" minlength="6"></div>
          <button type="submit" class="auth-button" id="doUpdate" data-i18n="auth.updatePasswordButton">Update Password</button>
        </form>
      </div>
    </div>
  </div>

  <script type="module">
    // ---- Config
    const SUPABASE_URL = "https://dmntmhkncldgynufajei.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRtbnRtaGtuY2xkZ3ludWZhamVpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4MzQ2MzUsImV4cCI6MjA3MjQxMDYzNX0.6DzOSb0xu5bp4g2wKy3SNtEEuSQavs_ohscyawvPmrY";
    const DASHBOARD_URL = "./dashboard.html";

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    window._supabase = supabase;

    // ---- i18n strings (EN shown here ‚Äì your full LOCALES object from before fits)
    const LOCALES = {
      en: {
        "hero.title": "Your <span class='free-highlight'>FREE</span> emergency QR card.",
        "hero.subtitle": "One scan, instant triage.",
        "hero.support": "A QR triage code to guide responders ‚Äî anywhere, anytime.",
        "hero.pronounce": "(pronounced \"My Care\")",
        "cta.create": "Create Account", "cta.signin": "Sign In",
        "menu.openApp": "Open App","menu.about": "About","menu.clinician": "Clinician","menu.how": "How it works","menu.privacy": "Privacy","menu.terms": "Terms","menu.contact": "Contact",
        "value.access": "People ‚Äî Essential Access","value.free": "Free to use (No cost ‚Ä¢ No trial ‚Ä¢ No ads)","value.card": "Emergency card (allergies, meds, ICE)","value.offline": "Works offline (no signal needed)","value.diy": "DIY printable QR tags & stickers","value.multi": "Multi-language","value.privacy": "Zero tracking & on-device privacy",
        "footer.trust": "GDPR & HIPAA compliant. Your emergency info stays private until you choose to share.",
        "login.title": "Sign in to MYQER","login.forgot": "Forgot password?","register.title": "Create your MYQER account","register.back": "Back to sign in","reset.title": "Reset Password","reset.send": "Send Reset Link",
        "auth.email": "Email","auth.password": "Password","auth.fullName": "Full Name","auth.show": "Show","auth.hide": "Hide","auth.newPassword": "New Password","auth.confirmPassword": "Confirm Password","auth.updatePassword": "Update Password","auth.updatePasswordButton": "Update Password"
      },
      /* keep your other locales as in your file */
      es:{}, fr:{}, de:{}, it:{}, hi:{}, ar:{}, zh:{}, hu:{}, ro:{}
    };

    let currentLang = 'en';

    // ---- i18n helpers (fixed: single definition, allows HTML for hero.title)
    const t = (key) => LOCALES[currentLang]?.[key] || LOCALES.en[key] || key;

    const updateTranslations = () => {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const value = t(key);
        if (key === 'hero.title') el.innerHTML = value;
        else el.textContent = value;
      });
    };

    const updateLanguage = (lang) => {
      currentLang = lang;
      document.documentElement.setAttribute('lang', lang);
      document.documentElement.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');
      updateTranslations();

      const langMap = { en:'üá∫üá∏ English', es:'üá™üá∏ Espa√±ol', fr:'üá´üá∑ Fran√ßais', de:'üá©üá™ Deutsch', it:'üáÆüáπ Italiano', hi:'üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä', ar:'üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', zh:'üá®üá≥ ‰∏≠Êñá', hu:'üá≠üá∫ Magyar', ro:'üá∑üá¥ Rom√¢nƒÉ' };
      document.getElementById('langSelector').textContent = langMap[lang] || 'üá∫üá∏ English';

      const valueRow = document.querySelector('.value-row');
      const mainContent = document.querySelector('.main-content');
      if (lang === 'ar') { valueRow.style.direction = 'rtl'; mainContent.style.textAlign = 'right'; }
      else { valueRow.style.direction = 'ltr'; mainContent.style.textAlign = 'center'; }
    };

    // ---- UI helpers
    const openModal = (view) => {
      const authModal = document.getElementById('authModal');
      const views = { login:'#modalLogin', register:'#modalRegister', reset:'#viewReset', update:'#viewUpdate' };
      Object.values(views).forEach(sel => document.querySelector(sel).classList.remove('active'));
      document.querySelector(views[view]).classList.add('active');
      authModal.style.display = 'flex'; authModal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden';
      setTimeout(()=>{ document.querySelector(`${views[view]} input`)?.focus(); },100);
    };
    const showAlert = (msg,type='error') => { const el = document.getElementById('toastArea'); el.textContent = msg; el.className = type; el.style.display='block'; };
    const clearAlert = () => { const el = document.getElementById('toastArea'); el.style.display='none'; el.textContent=''; };

    // ---- Session helpers
    const checkSession = async () => {
      try {
        const { data:{ session }, error } = await supabase.auth.getSession();
        if (error) { console.error('Session check error:', error); return null; }
        return session;
      } catch (e){ console.error(e); return null; }
    };

    const handleOpenApp = async () => {
      const session = await checkSession();
      if (session?.user) window.location.href = DASHBOARD_URL;
      else openModal('login');
    };

    const setupAuthListener = () => {
      supabase.auth.onAuthStateChange((event, session) => {
        if (event === 'SIGNED_IN' && session && !window.isInitialLoad) {
          document.getElementById('authModal').style.display='none';
          document.body.style.overflow='';
          setTimeout(()=> window.location.href = DASHBOARD_URL, 500);
        }
      });
    };

    // ---- Boot
    document.addEventListener('DOMContentLoaded', async () => {
      window.isInitialLoad = true;

      updateLanguage('en');         // init i18n
      setupAuthListener();          // auth listener

      // recovery flow
      const url = new URLSearchParams(location.search);
      if (url.get('type') === 'recovery') openModal('update');

      const session = await checkSession();
      if (session?.user) console.log('Authenticated session present');

      setTimeout(()=> window.isInitialLoad = false, 800);

      // menu
      const menuToggle = document.getElementById('menuToggle');
      const menuSheet  = document.getElementById('menuSheet');
      const menuOverlay= document.getElementById('menuOverlay');
      const menuClose  = document.getElementById('menuClose');
      const openMenu = ()=>{ menuSheet.classList.add('open'); menuOverlay.classList.add('open'); document.body.style.overflow='hidden'; };
      const closeMenu = ()=>{ menuSheet.classList.remove('open'); menuOverlay.classList.remove('open'); document.body.style.overflow=''; };
      menuToggle.addEventListener('click', openMenu);
      menuClose.addEventListener('click', closeMenu);
      menuOverlay.addEventListener('click', closeMenu);

      // language
      const langSelector = document.getElementById('langSelector');
      const langDropdown = document.getElementById('langDropdown');
      langSelector.addEventListener('click', () => {
        const open = langDropdown.style.display === 'block';
        langDropdown.style.display = open ? 'none' : 'block';
        langSelector.setAttribute('aria-expanded', String(!open));
      });
      langDropdown.addEventListener('click', (e) => {
        if (e.target.dataset.lang){ updateLanguage(e.target.dataset.lang); langDropdown.style.display='none'; langSelector.setAttribute('aria-expanded','false'); }
      });
      document.addEventListener('click', (e) => { if (!langSelector.contains(e.target) && !langDropdown.contains(e.target)) { langDropdown.style.display='none'; langSelector.setAttribute('aria-expanded','false'); } });

      // CTA & Open App
      document.getElementById('mOpenApp').addEventListener('click', handleOpenApp);
      document.getElementById('btnCreate').addEventListener('click', ()=> openModal('register'));
      document.getElementById('btnLogin').addEventListener('click',  ()=> openModal('login'));

      // Modal wiring
      const authModal = document.getElementById('authModal');
      const closeModal = ()=>{ authModal.style.display='none'; authModal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; clearAlert(); };
      document.getElementById('authClose').addEventListener('click', closeModal);
      authModal.addEventListener('click', e => { if (e.target === authModal) closeModal(); });

      // nav links
      document.getElementById('linkToRegister').addEventListener('click', ()=> openModal('register'));
      document.getElementById('linkForgot').addEventListener('click',   ()=> openModal('reset'));
      document.getElementById('linkToLogin').addEventListener('click',   ()=> openModal('login'));
      document.getElementById('backToLogin').addEventListener('click',   ()=> openModal('login'));
      document.getElementById('linkTerms').addEventListener('click',     ()=> window.open('/terms.html','_blank'));
      document.getElementById('linkPrivacy').addEventListener('click',   ()=> window.open('/privacy.html','_blank'));

      // password toggles
      const togglePassword = (inputId, buttonId) => {
        const input = document.getElementById(inputId);
        const button = document.getElementById(buttonId);
        if (input.type === 'password'){ input.type = 'text'; button.textContent = t('auth.hide'); }
        else { input.type = 'password'; button.textContent = t('auth.show'); }
      };
      document.getElementById('toggleLoginPass').addEventListener('click', ()=> togglePassword('loginPassword','toggleLoginPass'));
      document.getElementById('toggleRegPass').addEventListener('click',   ()=> togglePassword('regPassword','toggleRegPass'));
      document.getElementById('toggleNewPass').addEventListener('click',   ()=> togglePassword('newPassword','toggleNewPass'));

      // forms
      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault(); clearAlert();
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;
        if (!email || !password) return showAlert('Please enter both email and password.');

        const btn = document.getElementById('doLogin'); const txt = btn.textContent;
        btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>Signing in...';
        try{
          const { data, error } = await supabase.auth.signInWithPassword({ email, password });
          if (error) throw error;
          showAlert('Sign in successful! Redirecting...','success');
          window.isInitialLoad = false;
          window.location.href = DASHBOARD_URL;
        }catch(err){
          let m = 'Sign in failed. Please try again.';
          if (err.message?.includes('Invalid login credentials')) m = 'Invalid email or password. Please check your credentials.';
          else if (err.message?.includes('Email not confirmed')) m = 'Please check your email and confirm your account first.';
          else if (err.message) m = err.message;
          showAlert(m);
        }finally{ btn.disabled=false; btn.textContent = txt; }
      });

      document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault(); clearAlert();
        const name = document.getElementById('regName').value.trim();
        const email = document.getElementById('regEmail').value.trim();
        const password = document.getElementById('regPassword').value;
        if (!name || !email || !password) return showAlert('Please fill in all fields.');
        if (password.length < 6) return showAlert('Password must be at least 6 characters long.');

        const btn = document.getElementById('doRegister'); const txt = btn.textContent;
        btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>Creating account...';
        try{
          const { data, error } = await supabase.auth.signUp({ email, password, options:{ data:{ full_name:name, display_name:name } } });
          if (error) throw error;
          if (data.user && !data.user.email_confirmed_at) showAlert('Account created! Please check your email to confirm your account before signing in.','success');
          else showAlert('Account created successfully! You can now sign in.','success');
          setTimeout(()=>{ openModal('login'); document.getElementById('loginEmail').value = email; }, 2000);
        }catch(err){
          let m = 'Registration failed. Please try again.';
          if (err.message?.includes('already registered')) m = 'This email is already registered. Please sign in instead.';
          else if (err.message?.includes('invalid email')) m = 'Please enter a valid email address.';
          else if (err.message) m = err.message;
          showAlert(m);
        }finally{ btn.disabled=false; btn.textContent = txt; }
      });

      document.getElementById('resetForm').addEventListener('submit', async (e) => {
        e.preventDefault(); clearAlert();
        const email = document.getElementById('resetEmail').value;
        const btn = document.getElementById('doSendReset'); const txt = btn.textContent;
        btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>Sending...';
        try{
          const { error } = await supabase.auth.resetPasswordForEmail(email, { redirectTo: `${location.origin}/?type=recovery` });
          if (error) throw error;
          showAlert('Password reset email sent! Check your inbox.','success');
          setTimeout(()=> openModal('login'), 2000);
        }catch(err){ showAlert(err.message || 'Password reset failed. Please try again.'); }
        finally{ btn.disabled=false; btn.textContent = txt; }
      });

      document.getElementById('updateForm').addEventListener('submit', async (e) => {
        e.preventDefault(); clearAlert();
        const a = document.getElementById('newPassword').value;
        const b = document.getElementById('confirmPassword').value;
        if (a !== b) return showAlert('Passwords do not match.');
        const btn = document.getElementById('doUpdate'); const txt = btn.textContent;
        btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>Updating...';
        try{
          const { error } = await supabase.auth.updateUser({ password:a });
          if (error) throw error;
          showAlert('Password updated successfully! Redirecting...','success');
          setTimeout(()=> location.href = DASHBOARD_URL, 1500);
        }catch(err){ showAlert(err.message || 'Password update failed. Please try again.'); }
        finally{ btn.disabled=false; btn.textContent = txt; }
      });

      // keyboard
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape'){
          if (document.getElementById('authModal').style.display === 'flex') document.getElementById('authClose').click();
          if (document.getElementById('menuSheet').classList.contains('open')) document.getElementById('menuClose').click();
          const dd = document.getElementById('langDropdown'); if (dd.style.display==='block'){ dd.style.display='none'; document.getElementById('langSelector').setAttribute('aria-expanded','false'); }
        }
      });

      console.log('üçé MYQER landing initialized.');
    });
  </script>
</body>
</html>
