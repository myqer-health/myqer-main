<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MYQER - Emergency Medical Information</title>
  <link rel="icon" href="/assets/logo-myqer.png">
  <meta name="theme-color" content="#c62828">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase (keep secrets in /scripts/config.js) -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    import { SUPABASE_URL, SUPABASE_ANON_KEY } from '/scripts/config.js';
    window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>

  <style>
    :root{--brand:#c62828;--ink:#111318;--muted:#667085;--stroke:rgba(17,24,39,.10)}
    body{font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:linear-gradient(135deg,#f8fafc 0%,#e6ecf5 100%);color:var(--ink)}
    .glass     {background:rgba(255,255,255,.16);backdrop-filter:blur(16px);border:1px solid var(--stroke)}
    .glasscard {background:rgba(255,255,255,.24);backdrop-filter:blur(18px);border:1px solid var(--stroke);border-radius:18px;box-shadow:0 18px 42px rgba(2,8,23,.12),0 2px 6px rgba(2,8,23,.06)}
    .btn-red{background:var(--brand);color:#fff} .btn-red:hover{filter:brightness(1.03)}
    .pill{border-radius:999px;padding:.45rem .75rem;border:1px solid var(--stroke);background:rgba(255,255,255,.7)}
    .pill-red{background:var(--brand);color:#fff;border-color:var(--brand)}
    /* phone */
    .phone-shadow{box-shadow:0 25px 50px -12px rgba(0,0,0,.25),0 0 0 1px rgba(255,255,255,.05)}
    .dropdown{position:relative} .dropdown-menu{display:none;position:absolute;top:100%;left:0;margin-top:8px;min-width:200px;background:#dc2626;border:1px solid rgba(220,38,38,.35);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.25);padding:6px;z-index:50}
    .dropdown:hover .dropdown-menu{display:block}
    .dropdown-menu a{display:block;color:#fff;padding:10px 12px;margin:4px;border-radius:8px}
    .dropdown-menu a:hover{background:rgba(255,255,255,.18)}
    .modal-open{overflow:hidden}
  </style>
</head>
<body>
  <!-- NAV -->
  <header class="glass fixed inset-x-0 top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
      <div class="h-16 flex items-center justify-between">
        <a href="/" class="flex items-center gap-2 font-extrabold text-lg">
          <img src="/assets/logo.svg" class="h-6 w-auto" alt="MYQER" onerror="this.style.display='none';this.nextElementSibling.style.display='inline'">
          <span style="display:none">MYQ<span class="text-[#c62828]">ER</span></span>
        </a>

        <nav class="hidden md:flex items-center gap-3">
          <!-- language -->
          <select id="lang" class="px-3 py-2 rounded-lg border border-slate-300 text-sm">
            <option value="en">🇺🇸 EN</option><option value="es">🇪🇸 ES</option>
            <option value="fr">🇫🇷 FR</option><option value="de">🇩🇪 DE</option>
            <option value="it">🇮🇹 IT</option><option value="hi">🇮🇳 HI</option>
            <option value="ar">🇸🇦 AR</option><option value="zh">🇨🇳 ZH</option>
            <option value="hu">🇭🇺 HU</option><option value="ro">🇷🇴 RO</option>
          </select>

          <div class="dropdown">
            <button class="px-3 py-2 rounded-lg text-sm font-medium hover:text-red-600">
              <span data-i18n="pages">Pages</span> ▾
            </button>
            <div class="dropdown-menu">
              <a href="/privacy.html">Privacy</a>
              <a href="/terms.html">Terms</a>
              <a href="/clinician.html">Clinician</a>
              <a href="/how.html">How it works</a>
            </div>
          </div>

          <button id="openApp"  class="px-3 py-2 rounded-lg text-sm font-semibold border border-red-500 text-red-600 hover:bg-red-50" data-i18n="openApp">Open App</button>
          <button id="navLogin" class="px-3 py-2 rounded-lg text-sm font-semibold btn-red" data-i18n="signIn">Sign In</button>
          <button id="navReg"   class="px-3 py-2 rounded-lg text-sm font-semibold border border-red-600 text-red-600 hover:bg-red-50" data-i18n="signUp">Sign Up</button>
        </nav>

        <button id="burger" class="md:hidden w-10 h-10 rounded-lg hover:bg-white/50" aria-label="Menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7h16M4 12h16M4 17h16"/></svg>
        </button>
      </div>
    </div>
    <!-- mobile -->
    <div id="mNav" class="hidden md:hidden border-t border-white/30">
      <div class="px-4 py-3 space-y-2">
        <div class="flex gap-2">
          <button id="mOpen" class="flex-1 px-3 py-2 rounded-lg text-sm font-semibold border border-red-500 text-red-600">Open App</button>
          <button id="mLogin" class="flex-1 px-3 py-2 rounded-lg text-sm font-semibold btn-red">Sign In</button>
          <button id="mReg"   class="flex-1 px-3 py-2 rounded-lg text-sm font-semibold border border-red-600 text-red-600">Sign Up</button>
        </div>
        <div class="grid grid-cols-2 gap-2 text-sm">
          <a class="px-3 py-2 rounded-lg hover:bg-white/60" href="/privacy.html">Privacy</a>
          <a class="px-3 py-2 rounded-lg hover:bg-white/60" href="/terms.html">Terms</a>
          <a class="px-3 py-2 rounded-lg hover:bg-white/60" href="/clinician.html">Clinician</a>
          <a class="px-3 py-2 rounded-lg hover:bg-white/60" href="/how.html">How it works</a>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="pt-24">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
      <div class="flex flex-col lg:grid lg:grid-cols-2 lg:gap-10 items-stretch min-h-[70vh]">

        <!-- LEFT: copy + CTAs -->
        <section class="flex items-center mb-10 lg:mb-0">
          <div class="space-y-6 max-w-xl">
            <div class="inline-flex items-center gap-2">
              <span class="pill pill-red text-sm font-semibold" data-i18n="badgeFree">Free to use</span>
              <span class="pill text-sm" data-i18n="badgeOffline">Works offline</span>
            </div>

            <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">
              <span data-i18n="heroLine1">Your</span> <span class="text-[#c62828]" data-i18n="heroLine2">emergency triage</span>, <span data-i18n="heroLine3">voiced for you.</span>
              <span class="block text-[12px] text-slate-500/80 italic mt-1">(pronounced “My Care”)</span>
            </h1>

            <p class="text-lg text-gray-600" data-i18n="subcopy">
              Scan a MYQER tag to show <strong>allergies, conditions, medications, ICE</strong> — on any phone, in any language, even with no signal.
            </p>

            <div class="flex flex-wrap gap-3">
              <button id="ctaStart" class="px-5 py-3 rounded-lg text-base font-semibold btn-red shadow" data-i18n="createFree">Create free account</button>
              <button id="ctaSign"  class="px-5 py-3 rounded-lg text-base font-semibold border border-red-600 text-red-600 hover:bg-white" data-i18n="signIn">Sign in</button>
              <button id="ctaOpen"  class="px-5 py-3 rounded-lg text-base font-semibold border border-slate-300 hover:bg-white" data-i18n="openApp">Open App</button>
            </div>

            <p class="text-xs text-gray-500" data-i18n="privacyLine">
              No ads. No trackers. Your data stays on your device unless you choose to share it.
            </p>
          </div>
        </section>

        <!-- RIGHT: Phone (NO QR block) -->
        <section class="flex items-center justify-center">
          <div class="w-80 h-[640px] bg-black rounded-[3rem] p-2 phone-shadow">
            <div class="w-full h-full bg-white rounded-[2.5rem] overflow-hidden relative">
              <!-- status -->
              <div class="flex justify-between items-center px-6 py-3 text-sm opacity-80">
                <div class="text-gray-900 font-medium text-xs">MYQER</div>
                <div class="text-gray-900 font-medium">09:41</div>
              </div>
              <!-- screen -->
              <div class="px-6 pb-24 h-full flex flex-col">
                <!-- triage pill -->
                <div class="mb-5">
                  <div class="inline-flex items-center px-3 py-1.5 rounded-full bg-green-100 border border-green-200">
                    <span class="text-green-800 font-bold text-xs">GREEN — Standard</span>
                  </div>
                </div>
                <!-- headline -->
                <div class="mb-4">
                  <h2 class="text-xl font-semibold text-gray-900 leading-tight mb-2">
                    <span data-i18n="phoneTitle1">Your</span> <span class="text-[#c62828]" data-i18n="phoneTitle2">emergency</span> <span data-i18n="phoneTitle3">card.</span><br>
                    <span data-i18n="phoneTitle4">One scan, instant</span> <span class="text-[#c62828]" data-i18n="phoneTitle5">triage</span>.
                  </h2>
                  <p class="text-sm text-gray-600 opacity-80" data-i18n="phoneSub">
                    A triage code to guide responders — anywhere, anytime.
                  </p>
                </div>
                <!-- vitals -->
                <div class="glasscard rounded-2xl p-4 mb-4">
                  <div class="grid grid-cols-2 gap-y-3 gap-x-4">
                    <div><div class="text-xs uppercase tracking-wide text-gray-600 mb-1">Blood</div><div class="font-bold text-gray-900">O+</div></div>
                    <div><div class="text-xs uppercase tracking-wide text-gray-600 mb-1">ICE</div><div class="font-bold text-gray-900">+44 7700…</div></div>
                    <div class="col-span-2"><div class="h-px bg-[#c62828] opacity-30 mb-2"></div></div>
                    <div><div class="text-xs uppercase tracking-wide text-gray-600 mb-1">Allergies</div><div class="font-bold text-gray-900 text-sm">Penicillin, Nuts</div></div>
                    <div><div class="text-xs uppercase tracking-wide text-gray-600 mb-1">Meds</div><div class="font-bold text-gray-900 text-sm">Metformin</div></div>
                  </div>
                </div>
                <!-- message -->
                <div class="glasscard rounded-2xl p-3 mb-4 text-center">
                  <div class="text-xs text-gray-800 font-medium"><span data-i18n="simplePeople">Simple for people.</span> <span class="text-[#c62828] font-semibold" data-i18n="preciseResponders">Precise</span> <span data-i18n="forResponders">for responders.</span></div>
                </div>
                <!-- bottom buttons -->
                <div class="absolute bottom-6 left-6 right-6">
                  <div class="flex gap-3">
                    <button id="phSignIn" class="flex-1 bg-green-500 text-white py-3 rounded-full font-semibold text-sm shadow-lg hover:bg-green-600">Sign In</button>
                    <button id="phSignUp" class="flex-1 bg-[#c62828] text-white py-3 rounded-full font-semibold text-sm shadow-lg hover:bg-red-700">Sign Up</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 text-center text-sm text-gray-500">© 2025 MYQER — My QR for Emergency Response</div>
  </footer>

  <!-- AUTH MODAL -->
  <div id="authModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="glasscard rounded-2xl p-8 max-w-md w-full relative">
      <button id="authClose" class="absolute top-3 right-3 w-9 h-9 rounded-lg hover:bg-white/60 flex items-center justify-center" aria-label="Close">
        <svg class="w-5 h-5" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
      <div id="authAlerts" class="mb-3"></div>

      <!-- LOGIN -->
      <div id="view-login" class="space-y-4">
        <h2 class="text-xl font-bold" data-i18n="signIn">Sign in</h2>
        <label class="block text-sm font-medium" data-i18n="email">Email</label>
        <input id="loginEmail" type="email" class="w-full rounded-lg border border-slate-300 px-3 py-2 bg-white/90" placeholder="you@example.com" />
        <label class="block text-sm font-medium" data-i18n="password">Password</label>
        <div class="relative">
          <input id="loginPass" type="password" class="w-full rounded-lg border border-slate-300 px-3 py-2 bg-white/90 pr-24" placeholder="••••••••" />
          <button id="toggleLoginPass" class="absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1 rounded-lg border text-sm bg-white/80">Show</button>
        </div>
        <div class="grid gap-2 mt-2">
          <button id="doLogin" class="btn-red py-2.5 rounded-lg font-semibold" data-i18n="signIn">Sign in</button>
          <button id="goRegister" class="py-2.5 rounded-lg font-semibold border border-red-600 text-red-600 hover:bg-red-50" data-i18n="signUp">Create account</button>
          <button id="goReset" class="text-sm text-red-600 hover:underline" data-i18n="forgot">Forgot password?</button>
        </div>
      </div>

      <!-- REGISTER -->
      <div id="view-register" class="space-y-4 hidden">
        <h2 class="text-xl font-bold" data-i18n="createFree">Create your account</h2>
        <label class="block text-sm font-medium" data-i18n="fullName">Full name</label>
        <input id="regName" type="text" class="w-full rounded-lg border border-slate-300 px-3 py-2 bg-white/90" />
        <label class="block text-sm font-medium" data-i18n="email">Email</label>
        <input id="regEmail" type="email" class="w-full rounded-lg border border-slate-300 px-3 py-2 bg-white/90" />
        <label class="block text-sm font-medium" data-i18n="password">Password</label>
        <div class="relative">
          <input id="regPass" type="password" class="w-full rounded-lg border border-slate-300 px-3 py-2 bg-white/90 pr-24" placeholder="At least 6 characters" />
          <button id="toggleRegPass" class="absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1 rounded-lg border text-sm bg-white/80">Show</button>
        </div>
        <div class="grid gap-2 mt-2">
          <button id="doRegister" class="btn-red py-2.5 rounded-lg font-semibold" data-i18n="signUp">Create account</button>
          <button id="backLogin1" class="py-2.5 rounded-lg font-semibold border border-slate-300 hover:bg-white" data-i18n="backSignin">Back to sign in</button>
        </div>
      </div>

      <!-- RESET -->
      <div id="view-reset" class="space-y-4 hidden">
        <h2 class="text-xl font-bold" data-i18n="resetHeader">Reset your password</h2>
        <label class="block text-sm font-medium" data-i18n="email">Email</label>
        <input id="resetEmail" type="email" class="w-full rounded-lg border border-slate-300 px-3 py-2 bg-white/90" />
        <div class="grid gap-2 mt-2">
          <button id="doReset" class="btn-red py-2.5 rounded-lg font-semibold" data-i18n="sendReset">Send reset link</button>
          <button id="backLogin2" class="py-2.5 rounded-lg font-semibold border border-slate-300 hover:bg-white" data-i18n="backSignin">Back to sign in</button>
        </div>
      </div>

      <!-- UPDATE (from recovery link) -->
      <div id="view-update" class="space-y-4 hidden">
        <h2 class="text-xl font-bold" data-i18n="updateHeader">Set a new password</h2>
        <label class="block text-sm font-medium" data-i18n="newPassword">New password</label>
        <div class="relative">
          <input id="newPass" type="password" class="w-full rounded-lg border border-slate-300 px-3 py-2 bg-white/90 pr-24" />
          <button id="toggleNewPass" class="absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1 rounded-lg border text-sm bg-white/80">Show</button>
        </div>
        <label class="block text-sm font-medium" data-i18n="confirmPassword">Confirm password</label>
        <input id="newPass2" type="password" class="w-full rounded-lg border border-slate-300 px-3 py-2 bg-white/90" />
        <div class="grid gap-2 mt-2">
          <button id="doUpdate" class="btn-red py-2.5 rounded-lg font-semibold" data-i18n="updateBtn">Update password</button>
          <button id="backLogin3" class="py-2.5 rounded-lg font-semibold border border-slate-300 hover:bg-white" data-i18n="backSignin">Back to sign in</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPTS: UI + i18n + Auth -->
  <script>
    // ----- i18n (10 languages) -----
    const T = {
      en:{pages:"Pages",openApp:"Open App",signIn:"Sign In",signUp:"Sign Up",badgeFree:"Free to use",badgeOffline:"Works offline",
          heroLine1:"Your",heroLine2:"emergency triage",heroLine3:"voiced for you.",subcopy:"Scan a MYQER tag to show allergies, conditions, medications, ICE — on any phone, in any language, even with no signal.",
          createFree:"Create free account",privacyLine:"No ads. No trackers. Your data stays on your device unless you choose to share it.",
          phoneTitle1:"Your",phoneTitle2:"emergency",phoneTitle3:"card.",phoneTitle4:"One scan, instant",phoneTitle5:"triage",
          simplePeople:"Simple for people.",preciseResponders:"Precise",forResponders:"for responders.",
          email:"Email",password:"Password",forgot:"Forgot password?",fullName:"Full name",backSignin:"Back to sign in",
          resetHeader:"Reset your password",sendReset:"Send reset link",updateHeader:"Set a new password",newPassword:"New password",confirmPassword:"Confirm password",updateBtn:"Update password"},
      es:{pages:"Páginas",openApp:"Abrir App",signIn:"Iniciar sesión",signUp:"Registrarse",badgeFree:"Gratis",badgeOffline:"Funciona sin conexión",
          heroLine1:"Tu",heroLine2:"triaje de emergencia",heroLine3:"con voz.",subcopy:"Escanea una etiqueta MYQER para mostrar alergias, condiciones, medicamentos e ICE — en cualquier teléfono, en cualquier idioma, incluso sin señal.",
          createFree:"Crear cuenta gratis",privacyLine:"Sin anuncios. Sin rastreadores. Tus datos permanecen en tu dispositivo salvo que decidas compartirlos.",
          phoneTitle1:"Tu",phoneTitle2:"emergencia",phoneTitle3:"tarjeta.",phoneTitle4:"Un escaneo, triaje",phoneTitle5:"instantáneo",
          simplePeople:"Simple para personas.",preciseResponders:"Preciso",forResponders:"para los socorristas.",
          email:"Correo",password:"Contraseña",forgot:"¿Olvidaste la contraseña?",fullName:"Nombre completo",backSignin:"Volver a iniciar sesión",
          resetHeader:"Restablecer tu contraseña",sendReset:"Enviar enlace de restablecimiento",updateHeader:"Establecer nueva contraseña",newPassword:"Nueva contraseña",confirmPassword:"Confirmar contraseña",updateBtn:"Actualizar contraseña"},
      fr:{pages:"Pages",openApp:"Ouvrir l'app",signIn:"Se connecter",signUp:"S'inscrire",badgeFree:"Gratuit",badgeOffline:"Fonctionne hors-ligne",
          heroLine1:"Votre",heroLine2:"triage d'urgence",heroLine3:"avec synthèse vocale.",subcopy:"Scannez un tag MYQER pour afficher allergies, pathologies, médicaments, ICE — sur tout téléphone, dans toute langue, même sans réseau.",
          createFree:"Créer un compte gratuit",privacyLine:"Pas de pubs. Pas de pisteurs. Vos données restent sur votre appareil sauf si vous choisissez de les partager.",
          phoneTitle1:"Votre",phoneTitle2:"urgence",phoneTitle3:"carte.",phoneTitle4:"Un scan, triage",phoneTitle5:"instantané",
          simplePeople:"Simple pour tous.",preciseResponders:"Précis",forResponders:"pour les secours.",
          email:"E-mail",password:"Mot de passe",forgot:"Mot de passe oublié ?",fullName:"Nom complet",backSignin:"Retour à la connexion",
          resetHeader:"Réinitialiser votre mot de passe",sendReset:"Envoyer le lien",updateHeader:"Définir un nouveau mot de passe",newPassword:"Nouveau mot de passe",confirmPassword:"Confirmer le mot de passe",updateBtn:"Mettre à jour"},
      de:{pages:"Seiten",openApp:"App öffnen",signIn:"Anmelden",signUp:"Registrieren",badgeFree:"Kostenlos",badgeOffline:"Offline nutzbar",
          heroLine1:"Deine",heroLine2:"Notfalltriage",heroLine3:"mit Sprache.",subcopy:"Scanne ein MYQER-Tag für Allergien, Erkrankungen, Medikamente, ICE – auf jedem Handy, in jeder Sprache, auch ohne Netz.",
          createFree:"Kostenloses Konto erstellen",privacyLine:"Keine Werbung. Kein Tracking. Deine Daten bleiben auf deinem Gerät, außer du teilst sie.",
          phoneTitle1:"Deine",phoneTitle2:"Notfall",phoneTitle3:"karte.",phoneTitle4:"Ein Scan, sofortige",phoneTitle5:"Triage",
          simplePeople:"Einfach für Menschen.",preciseResponders:"Präzise",forResponders:"für Einsatzkräfte.",
          email:"E-Mail",password:"Passwort",forgot:"Passwort vergessen?",fullName:"Vollständiger Name",backSignin:"Zur Anmeldung",
          resetHeader:"Passwort zurücksetzen",sendReset:"Link senden",updateHeader:"Neues Passwort setzen",newPassword:"Neues Passwort",confirmPassword:"Passwort bestätigen",updateBtn:"Passwort aktualisieren"},
      it:{pages:"Pagine",openApp:"Apri App",signIn:"Accedi",signUp:"Registrati",badgeFree:"Gratuito",badgeOffline:"Funziona offline",
          heroLine1:"Il tuo",heroLine2:"triage di emergenza",heroLine3:"con voce.",subcopy:"Scansiona un tag MYQER per mostrare allergie, condizioni, farmaci, ICE — su qualsiasi telefono, in qualsiasi lingua, anche senza segnale.",
          createFree:"Crea account gratuito",privacyLine:"Niente annunci. Niente tracker. I tuoi dati restano sul dispositivo salvo tua scelta.",
          phoneTitle1:"La tua",phoneTitle2:"emergenza",phoneTitle3:"card.",phoneTitle4:"Una scansione, triage",phoneTitle5:"istantaneo",
          simplePeople:"Semplice per le persone.",preciseResponders:"Preciso",forResponders:"per i soccorritori.",
          email:"Email",password:"Password",forgot:"Password dimenticata?",fullName:"Nome completo",backSignin:"Torna al login",
          resetHeader:"Reimposta la password",sendReset:"Invia link",updateHeader:"Imposta nuova password",newPassword:"Nuova password",confirmPassword:"Conferma password",updateBtn:"Aggiorna password"},
      hi:{pages:"पेज",openApp:"ऐप खोलें",signIn:"साइन इन",signUp:"साइन अप",badgeFree:"मुफ़्त",badgeOffline:"ऑफ़लाइन भी",
          heroLine1:"आपका",heroLine2:"आपातकालीन ट्रायेज",heroLine3:"आवाज़ के साथ।",subcopy:"MYQER टैग स्कैन करें— एलर्जी, रोग, दवाएँ, ICE — किसी भी फ़ोन पर, किसी भी भाषा में, बिना नेटवर्क के भी।",
          createFree:"मुफ़्त खाता बनाएँ",privacyLine:"कोई विज्ञापन नहीं। कोई ट्रैकिंग नहीं। डेटा आपके डिवाइस पर रहता है।",
          phoneTitle1:"आपका",phoneTitle2:"आपातकाल",phoneTitle3:"कार्ड.",phoneTitle4:"एक स्कैन, तुरंत",phoneTitle5:"ट्रायेज",
          simplePeople:"लोगों के लिए सरल।",preciseResponders:"सटीक",forResponders:"रिस्पॉन्डर्स के लिए।",
          email:"ईमेल",password:"पासवर्ड",forgot:"पासवर्ड भूल गए?",fullName:"पूरा नाम",backSignin:"साइन इन पर वापस",
          resetHeader:"पासवर्ड रीसेट करें",sendReset:"लिंक भेजें",updateHeader:"नया पासवर्ड सेट करें",newPassword:"नया पासवर्ड",confirmPassword:"पासवर्ड पुष्टि",updateBtn:"अपडेट करें"},
      ar:{pages:"الصفحات",openApp:"افتح التطبيق",signIn:"تسجيل الدخول",signUp:"إنشاء حساب",badgeFree:"مجانًا",badgeOffline:"يعمل دون إنترنت",
          heroLine1:"رعايتك",heroLine2:"فرز طارئ",heroLine3:"بالصوت.",subcopy:"امسح وسم MYQER لعرض الحساسية والحالات والأدوية وجهات ICE — على أي هاتف وبأي لغة وبدون شبكة.",
          createFree:"أنشئ حسابًا مجانيًا",privacyLine:"بدون إعلانات أو تتبع. تبقى بياناتك على جهازك إلا إذا شاركتها.",
          phoneTitle1:"بطاقتك",phoneTitle2:"الطارئة",phoneTitle3:".",phoneTitle4:"مسح واحد، فرز",phoneTitle5:"فوري",
          simplePeople:"بسيط للناس.",preciseResponders:"دقيق",forResponders:"للمسعفين.",
          email:"البريد الإلكتروني",password:"كلمة المرور",forgot:"نسيت كلمة المرور؟",fullName:"الاسم الكامل",backSignin:"العودة لتسجيل الدخول",
          resetHeader:"إعادة تعيين كلمة المرور",sendReset:"إرسال الرابط",updateHeader:"تعيين كلمة مرور جديدة",newPassword:"كلمة مرور جديدة",confirmPassword:"تأكيد كلمة المرور",updateBtn:"تحديث"},
      zh:{pages:"页面",openApp:"打开应用",signIn:"登录",signUp:"注册",badgeFree:"免费",badgeOffline:"离线可用",
          heroLine1:"你的",heroLine2:"紧急分诊",heroLine3:"语音辅助。",subcopy:"扫描 MYQER 标签即可显示过敏、病症、用药与 ICE 联系人——任何手机、任何语言、无网络也可用。",
          createFree:"创建免费账号",privacyLine:"无广告，无跟踪。数据保留在你的设备上，除非你选择共享。",
          phoneTitle1:"你的",phoneTitle2:"紧急",phoneTitle3:"卡。",phoneTitle4:"一扫即得，即时",phoneTitle5:"分诊",
          simplePeople:"对人简单。",preciseResponders:"对急救",forResponders:"更精准。",
          email:"邮箱",password:"密码",forgot:"忘记密码？",fullName:"姓名",backSignin:"返回登录",
          resetHeader:"重置密码",sendReset:"发送重置链接",updateHeader:"设置新密码",newPassword:"新密码",confirmPassword:"确认密码",updateBtn:"更新密码"},
      hu:{pages:"Oldalak",openApp:"App megnyitása",signIn:"Bejelentkezés",signUp:"Regisztráció",badgeFree:"Ingyenes",badgeOffline:"Offline is működik",
          heroLine1:"A te",heroLine2:"sürgősségi triázsod",heroLine3:"hanggal.",subcopy:"Olvasd be a MYQER címkét – allergiák, állapotok, gyógyszerek, ICE – bármely telefonon, bármely nyelven, net nélkül is.",
          createFree:"Ingyenes fiók létrehozása",privacyLine:"Nincs reklám. Nincs követés. Az adataid a készüléken maradnak.",
          phoneTitle1:"A te",phoneTitle2:"sürgősségi",phoneTitle3:"kártyád.",phoneTitle4:"Egy beolvasás, azonnali",phoneTitle5:"triázs",
          simplePeople:"Egyszerű az embereknek.",preciseResponders:"Precíz",forResponders:"a segítőknek.",
          email:"Email",password:"Jelszó",forgot:"Elfelejtett jelszó?",fullName:"Teljes név",backSignin:"Vissza a bejelentkezéshez",
          resetHeader:"Jelszó visszaállítása",sendReset:"Visszaállító link küldése",updateHeader:"Új jelszó beállítása",newPassword:"Új jelszó",confirmPassword:"Jelszó megerősítése",updateBtn:"Frissítés"},
      ro:{pages:"Pagini",openApp:"Deschide aplicația",signIn:"Autentificare",signUp:"Înregistrare",badgeFree:"Gratuit",badgeOffline:"Merge offline",
          heroLine1:"Triage-ul tău",heroLine2:"de urgență",heroLine3:"cu voce.",subcopy:"Scanează eticheta MYQER pentru alergii, afecțiuni, medicații, ICE — pe orice telefon, în orice limbă, chiar și fără semnal.",
          createFree:"Creează cont gratuit",privacyLine:"Fără reclame. Fără tracking. Datele rămân pe dispozitivul tău.",
          phoneTitle1:"Cardul tău",phoneTitle2:"de urgență",phoneTitle3:".",phoneTitle4:"O scanare, triere",phoneTitle5:"instant",
          simplePeople:"Simplu pentru oameni.",preciseResponders:"Precis",forResponders:"pentru salvatori.",
          email:"Email",password:"Parolă",forgot:"Ai uitat parola?",fullName:"Nume complet",backSignin:"Înapoi la autentificare",
          resetHeader:"Resetează parola",sendReset:"Trimite linkul",updateHeader:"Setează parolă nouă",newPassword:"Parolă nouă",confirmPassword:"Confirmă parola",updateBtn:"Actualizează"}
    };

    function applyI18n(lang){
      const t = T[lang] || T.en;
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        if(t[key]) el.textContent = t[key];
      });
    }

    // ----- UI wiring -----
    const langSel = document.getElementById('lang');
    const burger  = document.getElementById('burger');
    const mNav    = document.getElementById('mNav');

    const authModal = document.getElementById('authModal');
    const views = {
      login:   document.getElementById('view-login'),
      register:document.getElementById('view-register'),
      reset:   document.getElementById('view-reset'),
      update:  document.getElementById('view-update')
    };
    const alerts = document.getElementById('authAlerts');
    const showAlert = (msg,type='error')=>{
      alerts.innerHTML = `<div class="rounded-lg border px-3 py-2 text-sm ${type==='success'?'bg-green-50 border-green-200 text-green-700':'bg-red-50 border-red-200 text-red-700'}">${msg}</div>`;
    };
    const clearAlert=()=>alerts.innerHTML='';

    function openModal(which='login'){
      document.body.classList.add('modal-open');
      authModal.classList.remove('hidden');
      Object.values(views).forEach(v=>v.classList.add('hidden'));
      views[which]?.classList.remove('hidden');
      clearAlert();
    }
    function closeModal(){
      document.body.classList.remove('modal-open');
      authModal.classList.add('hidden');
      clearAlert();
    }

    // language init
    const savedLang = localStorage.getItem('myqer_lang') || 'en';
    langSel.value = savedLang; applyI18n(savedLang);
    langSel.addEventListener('change', e=>{
      const L = e.target.value; localStorage.setItem('myqer_lang', L); applyI18n(L);
    });

    // mobile menu
    burger?.addEventListener('click', ()=> mNav.classList.toggle('hidden'));

    // open app smart
    async function openAppSmart(){
      const { data:{ session } } = await window.supabase.auth.getSession();
      if(session) window.location.href = '/dashboard.html';
      else openModal('login');
    }

    // nav/hero/phone buttons
    document.getElementById('openApp')?.addEventListener('click', openAppSmart);
    document.getElementById('navLogin')?.addEventListener('click', ()=>openModal('login'));
    document.getElementById('navReg')  ?.addEventListener('click', ()=>openModal('register'));
    document.getElementById('mOpen')   ?.addEventListener('click', ()=>{ mNav.classList.add('hidden'); openAppSmart(); });
    document.getElementById('mLogin')  ?.addEventListener('click', ()=>{ mNav.classList.add('hidden'); openModal('login'); });
    document.getElementById('mReg')    ?.addEventListener('click', ()=>{ mNav.classList.add('hidden'); openModal('register'); });
    document.getElementById('ctaStart')?.addEventListener('click', ()=>openModal('register'));
    document.getElementById('ctaSign') ?.addEventListener('click', ()=>openModal('login'));
    document.getElementById('ctaOpen') ?.addEventListener('click', openAppSmart);
    document.getElementById('phSignIn')?.addEventListener('click', ()=>openModal('login'));
    document.getElementById('phSignUp')?.addEventListener('click', ()=>openModal('register'));
    document.getElementById('authClose')?.addEventListener('click', closeModal);
    authModal?.addEventListener('click', e=>{ if(e.target===authModal) closeModal(); });

    // show/hide password helpers
    function attachToggle(inputId, btnId){
      const input=document.getElementById(inputId), btn=document.getElementById(btnId);
      btn?.addEventListener('click', (e)=>{ e.preventDefault(); const isPwd=input.type==='password'; input.type=isPwd?'text':'password'; btn.textContent=isPwd?'Hide':'Show'; });
    }
    attachToggle('loginPass','toggleLoginPass'); attachToggle('regPass','toggleRegPass'); attachToggle('newPass','toggleNewPass');

    // handle URL params (recovery / pre-open)
    const p = new URLSearchParams(location.search);
    if(p.get('type')==='recovery') openModal('update');
    if(p.get('auth')==='signin' || p.get('modal')==='login') openModal('login');
    if(p.get('auth')==='register' || p.get('modal')==='register') openModal('register');

    // ----- Auth actions -----
    const loginEmail=document.getElementById('loginEmail'), loginPass=document.getElementById('loginPass');
    const regName=document.getElementById('regName'), regEmail=document.getElementById('regEmail'), regPass=document.getElementById('regPass');
    const resetEmail=document.getElementById('resetEmail'); const newPass=document.getElementById('newPass'), newPass2=document.getElementById('newPass2');

    document.getElementById('doLogin')?.addEventListener('click', async ()=>{
      clearAlert();
      const { error } = await window.supabase.auth.signInWithPassword({ email:loginEmail.value.trim(), password:loginPass.value });
      if(error) return showAlert(error.message);
      window.location.replace('/dashboard.html');
    });

    document.getElementById('doRegister')?.addEventListener('click', async ()=>{
      clearAlert();
      if(regPass.value.length<6) return showAlert('Password must be at least 6 characters.');
      const { error } = await window.supabase.auth.signUp({ email:regEmail.value.trim(), password:regPass.value, options:{ data:{ full_name: regName.value.trim() } } });
      if(error) return showAlert(error.message);
      showAlert('Registration successful — check your email to confirm.', 'success');
      setTimeout(()=>openModal('login'), 1600);
    });

    document.getElementById('doReset')?.addEventListener('click', async ()=>{
      clearAlert();
      const { error } = await window.supabase.auth.resetPasswordForEmail(resetEmail.value.trim(), { redirectTo:`${location.origin}/?type=recovery` });
      if(error) return showAlert(error.message);
      showAlert('Password reset email sent.', 'success');
    });

    document.getElementById('doUpdate')?.addEventListener('click', async ()=>{
      clearAlert();
      if(!newPass.value || newPass.value.length<6) return showAlert('New password must be at least 6 characters.');
      if(newPass.value!==newPass2.value) return showAlert('Passwords do not match.');
      const { error } = await window.supabase.auth.updateUser({ password:newPass.value });
      if(error) return showAlert(error.message);
      showAlert('Password updated. Redirecting…', 'success'); setTimeout(()=>window.location.replace('/dashboard.html'), 1200);
    });
  </script>

  <!-- Optional: service worker -->
  <script> if('serviceWorker' in navigator){ navigator.serviceWorker.register('/myqer_service_worker.js').catch(()=>{}); } </script>
</body>
</html>
