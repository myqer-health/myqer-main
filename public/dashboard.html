<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MYQER Dashboard v3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .premium-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.92) 100%);
            backdrop-filter: blur(25px);
            border: 2px solid rgba(255, 255, 255, 0.4);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.12),
                0 8px 16px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }
        
        .medical-input {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(229, 231, 235, 0.6);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
        }
        
        .medical-input:focus {
            background: rgba(255, 255, 255, 1);
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.12);
            transform: translateY(-1px);
        }
        
        .medical-btn {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            letter-spacing: 0.025em;
        }
        
        .medical-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .medical-btn:active {
            transform: translateY(0);
        }
        
        .gradient-border {
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 3px;
            border-radius: 1rem;
        }
        
        .gradient-border-content {
            background: white;
            border-radius: calc(1rem - 3px);
        }
        
        .floating-header {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }
        
        .section-header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-bottom: 3px solid;
            position: relative;
            overflow: hidden;
        }
        
        .section-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }
        
        .section-header:hover::before {
            left: 100%;
        }
        
        .ice-contact-card {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(220, 38, 38, 0.05) 100%);
            border: 2px solid rgba(239, 68, 68, 0.2);
            transition: all 0.3s ease;
        }
        
        .ice-contact-card:hover {
            border-color: rgba(239, 68, 68, 0.4);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.15);
        }
        
        .completion-ring {
            filter: drop-shadow(0 4px 8px rgba(59, 130, 246, 0.3));
        }
        
        [dir="rtl"] {
            text-align: right;
        }
        [dir="rtl"] .flex {
            flex-direction: row-reverse;
        }
        
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }
        
        .card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 min-h-screen">
    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Language Selector -->
    <div class="fixed top-6 left-6 z-40">
        <select id="language-selector" class="medical-input px-4 py-3 rounded-xl text-sm outline-none shadow-lg">
            <option value="en">🇺🇸 English</option>
            <option value="es">🇪🇸 Español</option>
            <option value="fr">🇫🇷 Français</option>
            <option value="de">🇩🇪 Deutsch</option>
            <option value="it">🇮🇹 Italiano</option>
            <option value="hi">🇮🇳 हिन्दी</option>
            <option value="ar">🇸🇦 العربية</option>
            <option value="zh">🇨🇳 中文</option>
            <option value="hu">🇭🇺 Magyar</option>
            <option value="ro">🇷🇴 Română</option>
        </select>
    </div>

    <!-- Sleek Professional Header -->
    <header class="bg-white/95 backdrop-blur-sm border-b border-gray-100 sticky top-0 z-30">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-8">
                    <div class="flex items-center">
                        <h1 class="text-3xl font-black">
                            <span class="text-black">MYQ</span><span class="text-red-600">ER</span>
                        </h1>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-500 italic font-medium">pronounced "my care"</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <span class="block text-sm text-gray-700 font-semibold" data-translate="profile_completion">Profile Status</span>
                            <span class="text-xs text-red-600 font-medium" data-translate="complete_for_qr">Complete for emergency access</span>
                        </div>
                        <div class="relative w-12 h-12">
                            <svg class="w-12 h-12 transform -rotate-90" viewBox="0 0 36 36">
                                <path class="text-gray-200" stroke="currentColor" stroke-width="2" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                <path id="completion-circle" class="text-red-600" stroke="currentColor" stroke-width="2" fill="none" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span id="completion-text" class="text-xs font-bold text-red-600">0%</span>
                            </div>
                        </div>
                    </div>
                    <button onclick="signOut()" class="bg-gray-900 text-white px-6 py-2 rounded-lg hover:bg-gray-800 transition-colors font-medium text-sm">
                        <span data-translate="sign_out">Sign Out</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 sm:px-8 lg:px-12 py-12">
        <!-- 2x2 Premium Cards Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
            
            <!-- Identity & ICE Card - Enhanced -->
            <div class="premium-card rounded-3xl p-8 card-hover">
                <div class="section-header -mx-8 -mt-8 px-8 pt-8 pb-6 mb-8 rounded-t-3xl border-blue-500">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                        <div class="w-4 h-4 bg-blue-500 rounded-full mr-4 animate-pulse-slow"></div>
                        <span data-translate="identity_ice">Identity & Emergency Contacts</span>
                    </h2>
                    <p class="text-sm text-gray-600 mt-2 font-medium" data-translate="identity_desc">Personal information and emergency contacts</p>
                </div>
                
                <!-- Identity Section -->
                <div class="space-y-6 mb-8">
                    <div class="grid grid-cols-1 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="full_name">Full Name</label>
                            <input type="text" id="full_name" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg" data-translate-placeholder="enter_full_name">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="date_of_birth">Date of Birth</label>
                            <input type="text" id="date_of_birth" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg" placeholder="DD/MM/YYYY">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="country">Country</label>
                            <select id="country" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg">
                                <option value="" data-translate="select_country">Select Country</option>
                                <option value="US">United States</option>
                                <option value="CA">Canada</option>
                                <option value="GB">United Kingdom</option>
                                <option value="AU">Australia</option>
                                <option value="DE">Germany</option>
                                <option value="FR">France</option>
                                <option value="IT">Italy</option>
                                <option value="ES">Spain</option>
                                <option value="NL">Netherlands</option>
                                <option value="SE">Sweden</option>
                                <option value="NO">Norway</option>
                                <option value="DK">Denmark</option>
                                <option value="FI">Finland</option>
                                <option value="JP">Japan</option>
                                <option value="KR">South Korea</option>
                                <option value="SG">Singapore</option>
                                <option value="NZ">New Zealand</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="health_id">National Health ID</label>
                            <input type="text" id="national_health_id" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg" data-translate-placeholder="enter_health_id">
                        </div>
                    </div>
                </div>

                <!-- ICE Contacts Section -->
                <div class="border-t-2 border-gray-100 pt-8">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-xl font-bold text-red-700 flex items-center">
                                <span data-translate="ice_contacts">ICE Contacts</span>
                            </h3>
                            <p class="text-sm text-gray-600 font-medium mt-1" data-translate="ice_desc">In Case of Emergency</p>
                        </div>
                        <div class="flex flex-col items-end space-y-3">
                            <span id="contact-count" class="text-xs font-bold text-red-600 bg-red-50 px-3 py-2 rounded-full border border-red-200">0 of 3</span>
                            <button onclick="addContact()" id="add-contact-btn" class="medical-btn bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-xl hover:from-red-600 hover:to-red-700 font-semibold text-sm shadow-lg">
                                <span data-translate="add_contact">+ Add Contact</span>
                            </button>
                        </div>
                    </div>
                    <div id="contacts-list" class="space-y-4">
                        <!-- Contacts will be dynamically added here -->
                    </div>
                </div>
            </div>

            <!-- Health Information Card - Enhanced -->
            <div class="premium-card rounded-3xl p-8 card-hover">
                <div class="section-header -mx-8 -mt-8 px-8 pt-8 pb-6 mb-8 rounded-t-3xl border-green-500">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                        <div class="w-4 h-4 bg-green-500 rounded-full mr-4 animate-pulse-slow"></div>
                        <span data-translate="health_info">Health Information</span>
                    </h2>
                    <p class="text-sm text-gray-600 mt-2 font-medium" data-translate="health_desc">Medical details and conditions</p>
                </div>
                
                <div class="space-y-6">
                    <div class="grid grid-cols-1 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="blood_type">Blood Type</label>
                            <select id="blood_type" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg">
                                <option value="" data-translate="select_blood_type">Select Blood Type</option>
                                <option value="A+">A+</option>
                                <option value="A-">A-</option>
                                <option value="B+">B+</option>
                                <option value="B-">B-</option>
                                <option value="AB+">AB+</option>
                                <option value="AB-">AB-</option>
                                <option value="O+">O+</option>
                                <option value="O-">O-</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="organ_donor">Organ Donor</label>
                            <select id="organ_donor" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg">
                                <option value="" data-translate="unspecified">Unspecified</option>
                                <option value="Yes" data-translate="yes">Yes</option>
                                <option value="No" data-translate="no">No</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="life_support">Life Support Preference</label>
                            <select id="life_support_pref" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg">
                                <option value="" data-translate="select_preference">Select Preference</option>
                                <option value="Full" data-translate="full_support">Full Support</option>
                                <option value="Limited" data-translate="limited_support">Limited Support</option>
                                <option value="Comfort" data-translate="comfort_care">Comfort Care Only</option>
                                <option value="DNR" data-translate="dnr">Do Not Resuscitate</option>
                            </select>
                        </div>
                    </div>

                    <!-- Pills Inputs -->
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="allergies">Allergies</label>
                            <div class="flex flex-wrap gap-2 mb-3" id="allergies-pills"></div>
                            <input type="text" id="allergies-input" class="medical-input w-full px-4 py-3 rounded-xl outline-none" data-translate-placeholder="type_allergy">
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="conditions">Medical Conditions</label>
                            <div class="flex flex-wrap gap-2 mb-3" id="conditions-pills"></div>
                            <input type="text" id="conditions-input" class="medical-input w-full px-4 py-3 rounded-xl outline-none" data-translate-placeholder="type_condition">
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="medications">Medications</label>
                            <div class="flex flex-wrap gap-2 mb-3" id="medications-pills"></div>
                            <input type="text" id="medications-input" class="medical-input w-full px-4 py-3 rounded-xl outline-none" data-translate-placeholder="type_medication">
                        </div>
                    </div>

                    <!-- Triage Badge -->
                    <div class="border-t-2 border-gray-100 pt-6">
                        <div class="flex items-center justify-between mb-4">
                            <label class="block text-sm font-bold text-gray-700" data-translate="triage_priority">Triage Priority</label>
                            <select id="triage_override" class="medical-input px-4 py-2 rounded-lg text-sm outline-none">
                                <option value="Auto" data-translate="auto">Auto</option>
                                <option value="Green">Green</option>
                                <option value="Amber">Amber</option>
                                <option value="Red">Red</option>
                                <option value="Black">Black</option>
                            </select>
                        </div>
                        <div id="triage-badge" class="inline-flex items-center px-4 py-2 rounded-full text-sm font-bold bg-gray-100 text-gray-800 shadow-lg">
                            <span class="w-3 h-3 rounded-full mr-3 bg-gray-400"></span>
                            <span data-translate="not_assessed">Not Assessed</span>
                        </div>
                        <div class="mt-4 p-4 bg-amber-50 border border-amber-200 rounded-xl">
                            <p class="text-xs text-amber-800 leading-relaxed">
                                <strong data-translate="disclaimer">Disclaimer:</strong> <span data-translate="disclaimer_text">MYQER does not diagnose or provide medical advice. This triage label is user-provided and assistive only for responders.</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Professional Emergency QR Card -->
            <div class="premium-card rounded-3xl p-8 card-hover border border-gray-200">
                <div class="section-header -mx-8 -mt-8 px-8 pt-8 pb-6 mb-8 rounded-t-3xl border-gray-800 bg-gradient-to-r from-gray-50 to-white">
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 flex items-center">
                                <div class="w-4 h-4 bg-gray-800 rounded-full mr-4"></div>
                                <span data-translate="emergency_qr">Emergency Card & QR</span>
                            </h2>
                            <p class="text-sm text-gray-600 mt-2 font-medium" data-translate="qr_desc">Instant emergency access portal</p>
                        </div>
                        <div id="qr-status-badge" class="px-3 py-1 rounded-lg text-xs font-semibold bg-gray-100 text-gray-600">
                            <span data-translate="not_generated">Not Generated</span>
                        </div>
                    </div>
                </div>
                
                <!-- QR Display Area -->
                <div class="mb-8">
                    <div id="qr-placeholder" class="w-full aspect-square max-w-xs mx-auto bg-white rounded-2xl border-2 border-gray-200 flex items-center justify-center shadow-sm">
                        <div class="text-center">
                            <div class="w-12 h-12 mx-auto mb-3 bg-gray-100 rounded-xl flex items-center justify-center">
                                <div class="w-6 h-6 border-2 border-gray-400 rounded"></div>
                            </div>
                            <p class="text-gray-500 font-medium text-sm" data-translate="no_qr_yet">No QR code generated</p>
                        </div>
                    </div>
                    
                    <div id="qr-display-area" class="hidden w-full aspect-square max-w-xs mx-auto bg-white rounded-2xl border-2 border-red-200 flex items-center justify-center shadow-lg relative overflow-hidden">
                        <canvas id="qr-canvas" class="max-w-full max-h-full"></canvas>
                        <!-- MYQER Logo Overlay -->
                        <div id="qr-overlay" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <div class="bg-red-600 rounded-full w-12 h-12 flex items-center justify-center shadow-lg">
                                <span class="text-white font-black text-xs">ER</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- QR Code Info -->
                <div id="qr-info" class="hidden text-center mb-6">
                    <div class="bg-gray-50 rounded-xl p-4 mb-4">
                        <p class="text-xs text-gray-600 font-mono" id="short-code">MYQER-XXXXXX</p>
                        <p class="text-xs text-gray-500 mt-1 italic" data-translate="scan_access">Scan for emergency access</p>
                    </div>
                    
                    <!-- Share Link -->
                    <div class="flex rounded-lg overflow-hidden border border-gray-200">
                        <input type="text" id="share-link" readonly class="flex-1 px-3 py-2 bg-gray-50 text-xs font-mono text-gray-700 border-0 outline-none">
                        <button onclick="copyLink()" class="px-4 py-2 bg-gray-900 text-white hover:bg-gray-800 transition-colors text-xs font-medium">
                            <span data-translate="copy">Copy</span>
                        </button>
                    </div>
                </div>

                <!-- Primary Generate Button -->
                <div class="mb-6">
                    <button onclick="generateQRCode()" id="generate-qr-btn" class="w-full bg-red-600 text-white py-3 rounded-xl hover:bg-red-700 transition-colors font-semibold">
                        <span data-translate="generate_code">Generate Emergency Code</span>
                    </button>
                    
                    <div id="code-permanent" class="hidden text-center mt-3">
                        <p class="text-xs text-gray-600 font-medium" data-translate="code_permanent">Your code never changes — your profile updates behind it.</p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div id="action-buttons" class="hidden grid grid-cols-3 gap-3 mb-6">
                    <button onclick="exportPNG()" class="bg-white text-gray-700 py-2 px-3 rounded-lg hover:bg-gray-50 text-xs font-medium border border-gray-200">
                        <span data-translate="png_download">PNG</span>
                    </button>
                    <button onclick="exportSVG()" class="bg-white text-gray-700 py-2 px-3 rounded-lg hover:bg-gray-50 text-xs font-medium border border-gray-200">
                        <span data-translate="svg_download">SVG</span>
                    </button>
                    <button onclick="printQR()" class="bg-white text-gray-700 py-2 px-3 rounded-lg hover:bg-gray-50 text-xs font-medium border border-gray-200">
                        <span data-translate="print_card">Print</span>
                    </button>
                </div>

                <!-- Privacy Disclaimer -->
                <div class="text-center border-t border-gray-100 pt-4">
                    <p class="text-xs text-gray-500 leading-relaxed">
                        <span data-translate="privacy_disclaimer">This QR provides read-only, emergency information. Your data remains private unless you choose to share.</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Delete Account Card - Full Width Premium -->
        <div class="gradient-border card-hover">
            <div class="gradient-border-content p-12 text-center">
                <div class="max-w-2xl mx-auto">
                    <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-red-100 to-red-200 rounded-full flex items-center justify-center">
                        <div class="w-8 h-8 border-4 border-red-600 rounded-full"></div>
                    </div>
                    <h2 class="text-3xl font-bold text-red-900 mb-4" data-translate="danger_zone">Danger Zone</h2>
                    <p class="text-red-700 text-lg mb-8 leading-relaxed font-medium" data-translate="delete_warning">
                        This action cannot be undone. This will permanently delete your account and all associated data.
                    </p>
                    <button onclick="deleteAccount()" class="medical-btn bg-gradient-to-r from-red-600 to-red-700 text-white px-12 py-4 rounded-2xl hover:from-red-700 hover:to-red-800 font-bold text-lg shadow-lg">
                        <span data-translate="delete_account">Delete Account</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Professional Footer -->
    <footer class="bg-gray-50 border-t border-gray-200 mt-16">
        <div class="max-w-7xl mx-auto px-6 py-8">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-6">
                    <div class="flex items-center">
                        <h3 class="text-lg font-black">
                            <span class="text-black">MYQ</span><span class="text-red-600">ER</span>
                        </h3>
                        <span class="ml-3 text-xs text-gray-500 italic">pronounced "my care"</span>
                    </div>
                </div>
                <div class="flex items-center space-x-6 text-sm">
                    <a href="/privacy.html" class="text-gray-600 hover:text-gray-900 transition-colors font-medium">Privacy Policy</a>
                    <a href="/terms.html" class="text-gray-600 hover:text-gray-900 transition-colors font-medium">Terms of Service</a>
                    <span class="text-gray-400">© 2024 MYQER</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://tgddpmxpbgrzrbzpomou.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRnZGRwbXhwYmdyenJienBvbW91Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwNDgxMTMsImV4cCI6MjA3MTYyNDExM30.uXntx0rZISv927MQAG1LgGKA-lA08hSkzXMre7Bk2QM';
        
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let currentUser = null;
        let debounceTimers = {};
        let contacts = [];
        let allergies = [];
        let conditions = [];
        let medications = [];
        let currentLanguage = 'en';

        // Translations - Enhanced
        const translations = {
            en: {
                dashboard_title: "MYQER",
                profile_completion: "Profile Status",
                complete_for_qr: "Complete for emergency access",
                not_generated: "Not Generated",
                no_qr_yet: "No QR code generated",
                emergency_qr: "Emergency Card & QR",
                qr_desc: "Instant emergency access portal",
                generate_code: "Generate Emergency Code",
                code_permanent: "Your code never changes — your profile updates behind it.",
                scan_access: "Scan for emergency access",
                copy: "Copy",
                png_download: "PNG",
                svg_download: "SVG",
                print_card: "Print",
                privacy_disclaimer: "This QR provides read-only, emergency information. Your data remains private unless you choose to share.",
                sign_out: "Sign Out",
                identity_ice: "Identity & Emergency Contacts",
                identity_desc: "Personal information and emergency contacts",
                full_name: "Full Name",
                enter_full_name: "Enter your full name",
                date_of_birth: "Date of Birth",
                country: "Country",
                select_country: "Select Country",
                health_id: "National Health ID",
                enter_health_id: "Enter health ID number",
                ice_contacts: "ICE Contacts",
                ice_desc: "In Case of Emergency",
                add_contact: "+ Add Contact",
                health_info: "Health Information",
                health_desc: "Medical details and conditions",
                blood_type: "Blood Type",
                select_blood_type: "Select Blood Type",
                organ_donor: "Organ Donor",
                unspecified: "Unspecified",
                yes: "Yes",
                no: "No",
                life_support: "Life Support Preference",
                select_preference: "Select Preference",
                full_support: "Full Support",
                limited_support: "Limited Support",
                comfort_care: "Comfort Care Only",
                dnr: "Do Not Resuscitate",
                allergies: "Allergies",
                type_allergy: "Type allergy and press Enter",
                conditions: "Medical Conditions",
                type_condition: "Type condition and press Enter",
                medications: "Medications",
                type_medication: "Type medication and press Enter",
                triage_priority: "Triage Priority",
                auto: "Auto",
                not_assessed: "Not Assessed",
                disclaimer: "Disclaimer:",
                disclaimer_text: "MYQER does not diagnose or provide medical advice. This triage label is user-provided and assistive only for responders.",
                qr_code: "Your QR Code",
                qr_desc: "Emergency access portal",
                generate_qr: "Generate QR Code",
                qr_requirement: "Complete your profile to generate QR code",
                share_link: "Share Link",
                copy: "Copy",
                export_png: "Export PNG",
                print: "Print",
                danger_zone: "Danger Zone",
                delete_warning: "This action cannot be undone. This will permanently delete your account and all associated data.",
                delete_account: "Delete Account"
            },
            es: {
                dashboard_title: "Panel MYQER",
                version: "Versión 3.0 - Edición Premium",
                profile_completion: "Completado del Perfil",
                complete_for_qr: "Completa para acceso QR",
                sign_out: "Cerrar Sesión",
                identity_ice: "Identidad y Contactos de Emergencia",
                identity_desc: "Información personal y contactos de emergencia",
                full_name: "Nombre Completo",
                enter_full_name: "Ingrese su nombre completo",
                date_of_birth: "Fecha de Nacimiento",
                country: "País",
                select_country: "Seleccionar País",
                health_id: "ID de Salud Nacional",
                enter_health_id: "Ingrese número de ID de salud",
                ice_contacts: "Contactos ICE",
                ice_desc: "En Caso de Emergencia",
                add_contact: "+ Agregar Contacto",
                health_info: "Información de Salud",
                health_desc: "Detalles médicos y condiciones",
                blood_type: "Tipo de Sangre",
                select_blood_type: "Seleccionar Tipo de Sangre",
                organ_donor: "Donante de Órganos",
                unspecified: "No Especificado",
                yes: "Sí",
                no: "No",
                life_support: "Preferencia de Soporte Vital",
                select_preference: "Seleccionar Preferencia",
                full_support: "Soporte Completo",
                limited_support: "Soporte Limitado",
                comfort_care: "Solo Cuidados Paliativos",
                dnr: "No Resucitar",
                allergies: "Alergias",
                type_allergy: "Escriba alergia y presione Enter",
                conditions: "Condiciones Médicas",
                type_condition: "Escriba condición y presione Enter",
                medications: "Medicamentos",
                type_medication: "Escriba medicamento y presione Enter",
                triage_priority: "Prioridad de Triaje",
                auto: "Automático",
                not_assessed: "No Evaluado",
                disclaimer: "Descargo:",
                disclaimer_text: "MYQER no diagnostica ni proporciona consejos médicos. Esta etiqueta de triaje es proporcionada por el usuario y solo es de asistencia para los respondedores.",
                qr_code: "Su Código QR",
                qr_desc: "Portal de acceso de emergencia",
                generate_qr: "Generar Código QR",
                qr_requirement: "Complete su perfil para generar código QR",
                share_link: "Enlace para Compartir",
                copy: "Copiar",
                export_png: "Exportar PNG",
                print: "Imprimir",
                danger_zone: "Zona de Peligro",
                delete_warning: "Esta acción no se puede deshacer. Esto eliminará permanentemente su cuenta y todos los datos asociados.",
                delete_account: "Eliminar Cuenta"
            },
            fr: {
                dashboard_title: "Tableau de Bord MYQER",
                version: "Version 3.0 - Édition Premium",
                profile_completion: "Achèvement du Profil",
                complete_for_qr: "Complétez pour l'accès QR",
                sign_out: "Se Déconnecter",
                identity_ice: "Identité et Contacts d'Urgence",
                identity_desc: "Informations personnelles et contacts d'urgence",
                full_name: "Nom Complet",
                enter_full_name: "Entrez votre nom complet",
                date_of_birth: "Date de Naissance",
                country: "Pays",
                select_country: "Sélectionner le Pays",
                health_id: "ID de Santé National",
                enter_health_id: "Entrez le numéro d'ID de santé",
                ice_contacts: "Contacts ICE",
                ice_desc: "En Cas d'Urgence",
                add_contact: "+ Ajouter Contact",
                health_info: "Informations de Santé",
                health_desc: "Détails médicaux et conditions",
                blood_type: "Groupe Sanguin",
                select_blood_type: "Sélectionner le Groupe Sanguin",
                organ_donor: "Donneur d'Organes",
                unspecified: "Non Spécifié",
                yes: "Oui",
                no: "Non",
                life_support: "Préférence de Support Vital",
                select_preference: "Sélectionner la Préférence",
                full_support: "Support Complet",
                limited_support: "Support Limité",
                comfort_care: "Soins Palliatifs Seulement",
                dnr: "Ne Pas Réanimer",
                allergies: "Allergies",
                type_allergy: "Tapez allergie et appuyez sur Entrée",
                conditions: "Conditions Médicales",
                type_condition: "Tapez condition et appuyez sur Entrée",
                medications: "Médicaments",
                type_medication: "Tapez médicament et appuyez sur Entrée",
                triage_priority: "Priorité de Triage",
                auto: "Automatique",
                not_assessed: "Non Évalué",
                disclaimer: "Avertissement:",
                disclaimer_text: "MYQER ne diagnostique pas et ne fournit pas de conseils médicaux. Cette étiquette de triage est fournie par l'utilisateur et n'est qu'une aide pour les intervenants.",
                qr_code: "Votre Code QR",
                qr_desc: "Portail d'accès d'urgence",
                generate_qr: "Générer Code QR",
                qr_requirement: "Complétez votre profil pour générer le code QR",
                share_link: "Lien de Partage",
                copy: "Copier",
                export_png: "Exporter PNG",
                print: "Imprimer",
                danger_zone: "Zone de Danger",
                delete_warning: "Cette action ne peut pas être annulée. Cela supprimera définitivement votre compte et toutes les données associées.",
                delete_account: "Supprimer le Compte"
            },
            de: {
                dashboard_title: "MYQER Dashboard",
                version: "Version 3.0 - Premium Edition",
                profile_completion: "Profil-Vervollständigung",
                complete_for_qr: "Vervollständigen für QR-Zugang",
                sign_out: "Abmelden",
                identity_ice: "Identität & Notfallkontakte",
                identity_desc: "Persönliche Informationen und Notfallkontakte",
                full_name: "Vollständiger Name",
                enter_full_name: "Geben Sie Ihren vollständigen Namen ein",
                date_of_birth: "Geburtsdatum",
                country: "Land",
                select_country: "Land Auswählen",
                health_id: "Nationale Gesundheits-ID",
                enter_health_id: "Gesundheits-ID-Nummer eingeben",
                ice_contacts: "ICE-Kontakte",
                ice_desc: "Im Notfall",
                add_contact: "+ Kontakt Hinzufügen",
                health_info: "Gesundheitsinformationen",
                health_desc: "Medizinische Details und Bedingungen",
                blood_type: "Blutgruppe",
                select_blood_type: "Blutgruppe Auswählen",
                organ_donor: "Organspender",
                unspecified: "Nicht Angegeben",
                yes: "Ja",
                no: "Nein",
                life_support: "Lebenserhaltungs-Präferenz",
                select_preference: "Präferenz Auswählen",
                full_support: "Vollständige Unterstützung",
                limited_support: "Begrenzte Unterstützung",
                comfort_care: "Nur Palliativpflege",
                dnr: "Nicht Wiederbeleben",
                allergies: "Allergien",
                type_allergy: "Allergie eingeben und Enter drücken",
                conditions: "Medizinische Bedingungen",
                type_condition: "Bedingung eingeben und Enter drücken",
                medications: "Medikamente",
                type_medication: "Medikament eingeben und Enter drücken",
                triage_priority: "Triage-Priorität",
                auto: "Automatisch",
                not_assessed: "Nicht Bewertet",
                disclaimer: "Haftungsausschluss:",
                disclaimer_text: "MYQER diagnostiziert nicht und gibt keine medizinischen Ratschläge. Dieses Triage-Label wird vom Benutzer bereitgestellt und dient nur zur Unterstützung der Ersthelfer.",
                qr_code: "Ihr QR-Code",
                qr_desc: "Notfall-Zugangsportal",
                generate_qr: "QR-Code Generieren",
                qr_requirement: "Vervollständigen Sie Ihr Profil, um QR-Code zu generieren",
                share_link: "Freigabe-Link",
                copy: "Kopieren",
                export_png: "PNG Exportieren",
                print: "Drucken",
                danger_zone: "Gefahrenzone",
                delete_warning: "Diese Aktion kann nicht rückgängig gemacht werden. Dies wird Ihr Konto und alle zugehörigen Daten dauerhaft löschen.",
                delete_account: "Konto Löschen"
            },
            it: {
                dashboard_title: "Dashboard MYQER",
                version: "Versione 3.0 - Edizione Premium",
                profile_completion: "Completamento Profilo",
                complete_for_qr: "Completa per accesso QR",
                sign_out: "Disconnetti",
                identity_ice: "Identità e Contatti di Emergenza",
                identity_desc: "Informazioni personali e contatti di emergenza",
                full_name: "Nome Completo",
                enter_full_name: "Inserisci il tuo nome completo",
                date_of_birth: "Data di Nascita",
                country: "Paese",
                select_country: "Seleziona Paese",
                health_id: "ID Sanitario Nazionale",
                enter_health_id: "Inserisci numero ID sanitario",
                ice_contacts: "Contatti ICE",
                ice_desc: "In Caso di Emergenza",
                add_contact: "+ Aggiungi Contatto",
                health_info: "Informazioni Sanitarie",
                health_desc: "Dettagli medici e condizioni",
                blood_type: "Gruppo Sanguigno",
                select_blood_type: "Seleziona Gruppo Sanguigno",
                organ_donor: "Donatore di Organi",
                unspecified: "Non Specificato",
                yes: "Sì",
                no: "No",
                life_support: "Preferenza Supporto Vitale",
                select_preference: "Seleziona Preferenza",
                full_support: "Supporto Completo",
                limited_support: "Supporto Limitato",
                comfort_care: "Solo Cure Palliative",
                dnr: "Non Rianimare",
                allergies: "Allergie",
                type_allergy: "Digita allergia e premi Invio",
                conditions: "Condizioni Mediche",
                type_condition: "Digita condizione e premi Invio",
                medications: "Farmaci",
                type_medication: "Digita farmaco e premi Invio",
                triage_priority: "Priorità Triage",
                auto: "Automatico",
                not_assessed: "Non Valutato",
                disclaimer: "Disclaimer:",
                disclaimer_text: "MYQER non diagnostica né fornisce consigli medici. Questa etichetta di triage è fornita dall'utente ed è solo di assistenza per i soccorritori.",
                qr_code: "Il Tuo Codice QR",
                qr_desc: "Portale di accesso di emergenza",
                generate_qr: "Genera Codice QR",
                qr_requirement: "Completa il tuo profilo per generare il codice QR",
                share_link: "Link di Condivisione",
                copy: "Copia",
                export_png: "Esporta PNG",
                print: "Stampa",
                danger_zone: "Zona di Pericolo",
                delete_warning: "Questa azione non può essere annullata. Questo eliminerà permanentemente il tuo account e tutti i dati associati.",
                delete_account: "Elimina Account"
            },
            hi: {
                dashboard_title: "MYQER डैशबोर्ड",
                version: "संस्करण 3.0 - प्रीमियम संस्करण",
                profile_completion: "प्रोफ़ाइल पूर्णता",
                complete_for_qr: "QR पहुंच के लिए पूरा करें",
                sign_out: "साइन आउट",
                identity_ice: "पहचान और आपातकालीन संपर्क",
                identity_desc: "व्यक्तिगत जानकारी और आपातकालीन संपर्क",
                full_name: "पूरा नाम",
                enter_full_name: "अपना पूरा नाम दर्ज करें",
                date_of_birth: "जन्म तिथि",
                country: "देश",
                select_country: "देश चुनें",
                health_id: "राष्ट्रीय स्वास्थ्य आईडी",
                enter_health_id: "स्वास्थ्य आईडी नंबर दर्ज करें",
                ice_contacts: "ICE संपर्क",
                ice_desc: "आपातकाल की स्थिति में",
                add_contact: "+ संपर्क जोड़ें",
                health_info: "स्वास्थ्य जानकारी",
                health_desc: "चिकित्सा विवरण और स्थितियां",
                blood_type: "रक्त समूह",
                select_blood_type: "रक्त समूह चुनें",
                organ_donor: "अंग दाता",
                unspecified: "अनिर्दिष्ट",
                yes: "हाँ",
                no: "नहीं",
                life_support: "जीवन समर्थन प्राथमिकता",
                select_preference: "प्राथमिकता चुनें",
                full_support: "पूर्ण समर्थन",
                limited_support: "सीमित समर्थन",
                comfort_care: "केवल आराम की देखभाल",
                dnr: "पुनर्जीवित न करें",
                allergies: "एलर्जी",
                type_allergy: "एलर्जी टाइप करें और एंटर दबाएं",
                conditions: "चिकित्सा स्थितियां",
                type_condition: "स्थिति टाइप करें और एंटर दबाएं",
                medications: "दवाएं",
                type_medication: "दवा टाइप करें और एंटर दबाएं",
                triage_priority: "ट्राइएज प्राथमिकता",
                auto: "स्वचालित",
                not_assessed: "मूल्यांकन नहीं",
                disclaimer: "अस्वीकरण:",
                disclaimer_text: "MYQER निदान नहीं करता या चिकित्सा सलाह प्रदान नहीं करता। यह ट्राइएज लेबल उपयोगकर्ता द्वारा प्रदान किया गया है और केवल प्रतिक्रियाकर्ताओं के लिए सहायक है।",
                qr_code: "आपका QR कोड",
                qr_desc: "आपातकालीन पहुंच पोर्टल",
                generate_qr: "QR कोड जेनरेट करें",
                qr_requirement: "QR कोड जेनरेट करने के लिए अपनी प्रोफ़ाइल पूरी करें",
                share_link: "साझा लिंक",
                copy: "कॉपी",
                export_png: "PNG निर्यात",
                print: "प्रिंट",
                danger_zone: "खतरा क्षेत्र",
                delete_warning: "यह क्रिया पूर्ववत नहीं की जा सकती। यह आपके खाते और सभी संबंधित डेटा को स्थायी रूप से हटा देगा।",
                delete_account: "खाता हटाएं"
            },
            ar: {
                dashboard_title: "لوحة تحكم MYQER",
                version: "الإصدار 3.0 - الطبعة المميزة",
                profile_completion: "اكتمال الملف الشخصي",
                complete_for_qr: "أكمل للوصول إلى QR",
                sign_out: "تسجيل الخروج",
                identity_ice: "الهوية وجهات الاتصال الطارئة",
                identity_desc: "المعلومات الشخصية وجهات الاتصال الطارئة",
                full_name: "الاسم الكامل",
                enter_full_name: "أدخل اسمك الكامل",
                date_of_birth: "تاريخ الميلاد",
                country: "البلد",
                select_country: "اختر البلد",
                health_id: "الهوية الصحية الوطنية",
                enter_health_id: "أدخل رقم الهوية الصحية",
                ice_contacts: "جهات اتصال الطوارئ",
                ice_desc: "في حالة الطوارئ",
                add_contact: "+ إضافة جهة اتصال",
                health_info: "المعلومات الصحية",
                health_desc: "التفاصيل الطبية والحالات",
                blood_type: "فصيلة الدم",
                select_blood_type: "اختر فصيلة الدم",
                organ_donor: "متبرع بالأعضاء",
                unspecified: "غير محدد",
                yes: "نعم",
                no: "لا",
                life_support: "تفضيل دعم الحياة",
                select_preference: "اختر التفضيل",
                full_support: "دعم كامل",
                limited_support: "دعم محدود",
                comfort_care: "رعاية مريحة فقط",
                dnr: "عدم الإنعاش",
                allergies: "الحساسية",
                type_allergy: "اكتب الحساسية واضغط إدخال",
                conditions: "الحالات الطبية",
                type_condition: "اكتب الحالة واضغط إدخال",
                medications: "الأدوية",
                type_medication: "اكتب الدواء واضغط إدخال",
                triage_priority: "أولوية الفرز",
                auto: "تلقائي",
                not_assessed: "غير مقيم",
                disclaimer: "إخلاء المسؤولية:",
                disclaimer_text: "MYQER لا يشخص أو يقدم نصائح طبية. هذه التسمية للفرز مقدمة من المستخدم ومساعدة فقط للمستجيبين.",
                qr_code: "رمز QR الخاص بك",
                qr_desc: "بوابة الوصول الطارئ",
                generate_qr: "إنشاء رمز QR",
                qr_requirement: "أكمل ملفك الشخصي لإنشاء رمز QR",
                share_link: "رابط المشاركة",
                copy: "نسخ",
                export_png: "تصدير PNG",
                print: "طباعة",
                danger_zone: "منطقة الخطر",
                delete_warning: "لا يمكن التراجع عن هذا الإجراء. سيؤدي هذا إلى حذف حسابك وجميع البيانات المرتبطة نهائياً.",
                delete_account: "حذف الحساب"
            },
            zh: {
                dashboard_title: "MYQER 仪表板",
                version: "版本 3.0 - 高级版",
                profile_completion: "个人资料完成度",
                complete_for_qr: "完成以获取二维码访问",
                sign_out: "退出登录",
                identity_ice: "身份和紧急联系人",
                identity_desc: "个人信息和紧急联系人",
                full_name: "全名",
                enter_full_name: "输入您的全名",
                date_of_birth: "出生日期",
                country: "国家",
                select_country: "选择国家",
                health_id: "国民健康ID",
                enter_health_id: "输入健康ID号码",
                ice_contacts: "紧急联系人",
                ice_desc: "紧急情况下",
                add_contact: "+ 添加联系人",
                health_info: "健康信息",
                health_desc: "医疗详情和状况",
                blood_type: "血型",
                select_blood_type: "选择血型",
                organ_donor: "器官捐献者",
                unspecified: "未指定",
                yes: "是",
                no: "否",
                life_support: "生命支持偏好",
                select_preference: "选择偏好",
                full_support: "完全支持",
                limited_support: "有限支持",
                comfort_care: "仅舒适护理",
                dnr: "不要复苏",
                allergies: "过敏",
                type_allergy: "输入过敏并按回车",
                conditions: "疾病状况",
                type_condition: "输入状况并按回车",
                medications: "药物",
                type_medication: "输入药物并按回车",
                triage_priority: "分诊优先级",
                auto: "自动",
                not_assessed: "未评估",
                disclaimer: "免责声明：",
                disclaimer_text: "MYQER不进行诊断或提供医疗建议。此分诊标签由用户提供，仅供急救人员参考。",
                qr_code: "您的二维码",
                qr_desc: "紧急访问门户",
                generate_qr: "生成二维码",
                qr_requirement: "完成您的个人资料以生成二维码",
                share_link: "分享链接",
                copy: "复制",
                export_png: "导出PNG",
                print: "打印",
                danger_zone: "危险区域",
                delete_warning: "此操作无法撤销。这将永久删除您的账户和所有相关数据。",
                delete_account: "删除账户"
            },
            hu: {
                dashboard_title: "MYQER Irányítópult",
                version: "3.0 verzió - Prémium kiadás",
                profile_completion: "Profil Befejezés",
                complete_for_qr: "Fejezze be a QR hozzáféréshez",
                sign_out: "Kijelentkezés",
                identity_ice: "Személyazonosság és Vészhelyzeti Kapcsolatok",
                identity_desc: "Személyes információk és vészhelyzeti kapcsolatok",
                full_name: "Teljes Név",
                enter_full_name: "Adja meg teljes nevét",
                date_of_birth: "Születési Dátum",
                country: "Ország",
                select_country: "Válasszon Országot",
                health_id: "Nemzeti Egészségügyi Azonosító",
                enter_health_id: "Adja meg az egészségügyi azonosító számot",
                ice_contacts: "ICE Kapcsolatok",
                ice_desc: "Vészhelyzet Esetén",
                add_contact: "+ Kapcsolat Hozzáadása",
                health_info: "Egészségügyi Információk",
                health_desc: "Orvosi részletek és állapotok",
                blood_type: "Vércsoport",
                select_blood_type: "Válasszon Vércsoportot",
                organ_donor: "Szervdonor",
                unspecified: "Nem Meghatározott",
                yes: "Igen",
                no: "Nem",
                life_support: "Életfenntartó Preferencia",
                select_preference: "Válasszon Preferenciát",
                full_support: "Teljes Támogatás",
                limited_support: "Korlátozott Támogatás",
                comfort_care: "Csak Palliatív Gondozás",
                dnr: "Ne Éleszd Újra",
                allergies: "Allergiák",
                type_allergy: "Írja be az allergiát és nyomja meg az Entert",
                conditions: "Egészségügyi Állapotok",
                type_condition: "Írja be az állapotot és nyomja meg az Entert",
                medications: "Gyógyszerek",
                type_medication: "Írja be a gyógyszert és nyomja meg az Entert",
                triage_priority: "Triázs Prioritás",
                auto: "Automatikus",
                not_assessed: "Nem Értékelt",
                disclaimer: "Jogi Nyilatkozat:",
                disclaimer_text: "A MYQER nem diagnosztizál és nem nyújt orvosi tanácsot. Ez a triázs címke felhasználó által megadott és csak segítő a mentősöknek.",
                qr_code: "Az Ön QR Kódja",
                qr_desc: "Vészhelyzeti hozzáférési portál",
                generate_qr: "QR Kód Generálása",
                qr_requirement: "Fejezze be profilját a QR kód generálásához",
                share_link: "Megosztási Link",
                copy: "Másolás",
                export_png: "PNG Exportálás",
                print: "Nyomtatás",
                danger_zone: "Veszélyzóna",
                delete_warning: "Ez a művelet nem vonható vissza. Ez véglegesen törli fiókját és minden kapcsolódó adatot.",
                delete_account: "Fiók Törlése"
            },
            ro: {
                dashboard_title: "Tablou de Bord MYQER",
                version: "Versiunea 3.0 - Ediția Premium",
                profile_completion: "Completarea Profilului",
                complete_for_qr: "Completați pentru accesul QR",
                sign_out: "Deconectare",
                identity_ice: "Identitate și Contacte de Urgență",
                identity_desc: "Informații personale și contacte de urgență",
                full_name: "Nume Complet",
                enter_full_name: "Introduceți numele complet",
                date_of_birth: "Data Nașterii",
                country: "Țara",
                select_country: "Selectați Țara",
                health_id: "ID Sănătate Națională",
                enter_health_id: "Introduceți numărul ID sănătate",
                ice_contacts: "Contacte ICE",
                ice_desc: "În Caz de Urgență",
                add_contact: "+ Adăugați Contact",
                health_info: "Informații Sănătate",
                health_desc: "Detalii medicale și condiții",
                blood_type: "Grupa Sanguină",
                select_blood_type: "Selectați Grupa Sanguină",
                organ_donor: "Donator de Organe",
                unspecified: "Nespecificat",
                yes: "Da",
                no: "Nu",
                life_support: "Preferința Suport Vital",
                select_preference: "Selectați Preferința",
                full_support: "Suport Complet",
                limited_support: "Suport Limitat",
                comfort_care: "Doar Îngrijire Paliativă",
                dnr: "Nu Resuscita",
                allergies: "Alergii",
                type_allergy: "Tastați alergia și apăsați Enter",
                conditions: "Condiții Medicale",
                type_condition: "Tastați condiția și apăsați Enter",
                medications: "Medicamente",
                type_medication: "Tastați medicamentul și apăsați Enter",
                triage_priority: "Prioritate Triaj",
                auto: "Automat",
                not_assessed: "Neevaluat",
                disclaimer: "Declinarea Responsabilității:",
                disclaimer_text: "MYQER nu diagnostichează și nu oferă sfaturi medicale. Această etichetă de triaj este furnizată de utilizator și este doar de asistență pentru salvatori.",
                qr_code: "Codul Dvs. QR",
                qr_desc: "Portal de acces de urgență",
                generate_qr: "Generați Cod QR",
                qr_requirement: "Completați-vă profilul pentru a genera codul QR",
                share_link: "Link Partajare",
                copy: "Copiați",
                export_png: "Exportați PNG",
                print: "Imprimați",
                danger_zone: "Zona de Pericol",
                delete_warning: "Această acțiune nu poate fi anulată. Aceasta va șterge permanent contul dvs. și toate datele asociate.",
                delete_account: "Ștergeți Contul"
            }
        };

        // Language Management
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('myqer_language', lang);
            
            // Set RTL for Arabic
            if (lang === 'ar') {
                document.documentElement.setAttribute('dir', 'rtl');
                document.documentElement.setAttribute('lang', 'ar');
            } else {
                document.documentElement.setAttribute('dir', 'ltr');
                document.documentElement.setAttribute('lang', lang);
            }
            
            // Update all translatable elements
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // Update placeholders
            const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (translations[lang] && translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });
        }

        // Toast System
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const colors = {
                success: 'bg-gradient-to-r from-green-500 to-green-600',
                error: 'bg-gradient-to-r from-red-500 to-red-600',
                info: 'bg-gradient-to-r from-blue-500 to-blue-600',
                warning: 'bg-gradient-to-r from-amber-500 to-amber-600'
            };
            
            toast.className = `${colors[type]} text-white px-6 py-4 rounded-2xl shadow-2xl transform transition-all duration-500 translate-x-full opacity-0 font-semibold`;
            toast.textContent = message;
            
            document.getElementById('toast-container').appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
            }, 100);
            
            setTimeout(() => {
                toast.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => toast.remove(), 500);
            }, 4000);
        }

        // Session Management
        async function checkSession() {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                location.href = '/index.html';
                return;
            }
            currentUser = session.user;
            await loadUserData();
        }

        async function signOut() {
            await supabase.auth.signOut();
            location.href = '/index.html';
        }

        // Debounced Save
        function debouncedSave(field, value, table = 'profiles') {
            clearTimeout(debounceTimers[field]);
            debounceTimers[field] = setTimeout(async () => {
                await saveField(field, value, table);
            }, 700);
        }

        async function saveField(field, value, table) {
            try {
                if (table === 'profiles') {
                    const { error } = await supabase
                        .from('profiles')
                        .upsert({ 
                            id: currentUser.id, 
                            email: currentUser.email,
                            [field]: value,
                            updated_at: new Date().toISOString()
                        });
                    if (error) throw error;
                } else if (table === 'health_profiles') {
                    const { error } = await supabase
                        .from('health_profiles')
                        .upsert({ 
                            user_id: currentUser.id, 
                            [field]: value 
                        });
                    if (error) throw error;
                }
                updateCompletion();
                showToast('Saved successfully', 'success');
            } catch (error) {
                showToast('Save failed: ' + error.message, 'error');
            }
        }

        // Load User Data
        async function loadUserData() {
            try {
                // Load profile
                const { data: profile } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();

                if (profile) {
                    document.getElementById('full_name').value = profile.full_name || '';
                    document.getElementById('date_of_birth').value = profile.date_of_birth || '';
                    document.getElementById('country').value = profile.country || '';
                    document.getElementById('national_health_id').value = profile.national_health_id || '';
                    
                    if (profile.code) {
                        showQRCode(profile.code);
                    }
                }

                // Load health profile
                const { data: health } = await supabase
                    .from('health_profiles')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .single();

                if (health) {
                    document.getElementById('blood_type').value = health.blood_type || '';
                    document.getElementById('organ_donor').value = health.organ_donor || '';
                    document.getElementById('life_support_pref').value = health.life_support_pref || '';
                    document.getElementById('triage_override').value = health.triage_override || 'Auto';
                    
                    allergies = health.allergies ? health.allergies.split(',').filter(a => a.trim()) : [];
                    conditions = health.conditions ? health.conditions.split(',').filter(c => c.trim()) : [];
                    medications = health.medications ? health.medications.split(',').filter(m => m.trim()) : [];
                    
                    renderPills();
                    updateTriageBadge();
                }

                // Load ICE contacts
                const { data: contactsData } = await supabase
                    .from('ice_contacts')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at');

                contacts = contactsData || [];
                renderContacts();
                updateCompletion();
            } catch (error) {
                showToast('Failed to load data: ' + error.message, 'error');
            }
        }

        // Pills Management
        function renderPills() {
            renderPillGroup('allergies', allergies);
            renderPillGroup('conditions', conditions);
            renderPillGroup('medications', medications);
        }

        function renderPillGroup(type, items) {
            const container = document.getElementById(`${type}-pills`);
            const colors = {
                allergies: 'bg-red-100 text-red-800 border-red-200',
                conditions: 'bg-orange-100 text-orange-800 border-orange-200',
                medications: 'bg-blue-100 text-blue-800 border-blue-200'
            };
            
            container.innerHTML = items.map(item => 
                `<span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold border-2 ${colors[type]} shadow-sm">
                    ${item}
                    <button onclick="removePill('${type}', '${item}')" class="ml-3 text-current hover:text-red-600 font-bold text-lg transition-colors">×</button>
                </span>`
            ).join('');
        }

        function addPill(type, value) {
            if (!value.trim()) return;
            
            const items = type === 'allergies' ? allergies : 
                         type === 'conditions' ? conditions : medications;
            
            if (!items.includes(value.trim())) {
                items.push(value.trim());
                renderPills();
                savePills();
                updateTriageBadge();
            }
        }

        function removePill(type, value) {
            const items = type === 'allergies' ? allergies : 
                         type === 'conditions' ? conditions : medications;
            
            const index = items.indexOf(value);
            if (index > -1) {
                items.splice(index, 1);
                renderPills();
                savePills();
                updateTriageBadge();
            }
        }

        async function savePills() {
            try {
                const { error } = await supabase
                    .from('health_profiles')
                    .upsert({
                        user_id: currentUser.id,
                        allergies: allergies.join(','),
                        conditions: conditions.join(','),
                        medications: medications.join(',')
                    });
                if (error) throw error;
                updateCompletion();
            } catch (error) {
                showToast('Failed to save: ' + error.message, 'error');
            }
        }

        // Triage Badge
        function updateTriageBadge() {
            const override = document.getElementById('triage_override').value;
            let priority = 'Green';
            let color = 'bg-green-100 text-green-800 border-green-300';
            let dotColor = 'bg-green-500';

            if (override !== 'Auto') {
                priority = override;
            } else {
                // Auto calculation
                const lifeSupportPref = document.getElementById('life_support_pref').value;
                
                if (lifeSupportPref === 'DNR') {
                    priority = 'Black';
                } else {
                    const criticalAllergies = ['anaphylaxis', 'epipen', 'penicillin', 'peanut', 'shellfish'];
                    const criticalConditions = ['heart', 'stroke', 'seizure', 'cancer'];
                    
                    const hasCriticalAllergy = allergies.some(a => 
                        criticalAllergies.some(ca => a.toLowerCase().includes(ca))
                    );
                    const hasCriticalCondition = conditions.some(c => 
                        criticalConditions.some(cc => c.toLowerCase().includes(cc))
                    );
                    const hasMultipleIssues = (conditions.length + medications.length) >= 3;
                    
                    if (hasCriticalAllergy || hasCriticalCondition || hasMultipleIssues) {
                        priority = 'Red';
                    } else if (allergies.length > 0 || conditions.length > 0 || medications.length > 0) {
                        priority = 'Amber';
                    }
                }
            }

            // Set colors
            switch (priority) {
                case 'Black':
                    color = 'bg-gray-800 text-white border-gray-600';
                    dotColor = 'bg-gray-600';
                    break;
                case 'Red':
                    color = 'bg-red-100 text-red-800 border-red-300';
                    dotColor = 'bg-red-500';
                    break;
                case 'Amber':
                    color = 'bg-amber-100 text-amber-800 border-amber-300';
                    dotColor = 'bg-amber-500';
                    break;
                default:
                    color = 'bg-green-100 text-green-800 border-green-300';
                    dotColor = 'bg-green-500';
            }

            document.getElementById('triage-badge').className = 
                `inline-flex items-center px-4 py-2 rounded-full text-sm font-bold border-2 ${color} shadow-lg`;
            document.getElementById('triage-badge').innerHTML = 
                `<span class="w-3 h-3 rounded-full mr-3 ${dotColor}"></span>${priority}`;
        }

        // ICE Contacts - Enhanced
        function renderContacts() {
            const container = document.getElementById('contacts-list');
            const count = document.getElementById('contact-count');
            const addBtn = document.getElementById('add-contact-btn');
            
            count.textContent = `${contacts.length} of 3`;
            addBtn.disabled = contacts.length >= 3;
            addBtn.className = contacts.length >= 3 ? 
                'bg-gray-400 text-white px-4 py-2 rounded-xl cursor-not-allowed font-semibold text-sm' :
                'medical-btn bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-xl hover:from-red-600 hover:to-red-700 font-semibold text-sm shadow-lg';

            container.innerHTML = contacts.map((contact, index) => `
                <div class="ice-contact-card rounded-2xl p-6 space-y-4">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-bold text-red-700">Contact ${index + 1}</h4>
                        <button onclick="deleteContact('${contact.id}')" 
                                class="medical-btn bg-red-600 text-white px-3 py-1 rounded-lg text-xs hover:bg-red-700 font-semibold">
                            🗑️ Delete
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Name *</label>
                            <input type="text" value="${contact.name || ''}" 
                                   onblur="updateContact('${contact.id}', 'name', this.value)"
                                   class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg"
                                   placeholder="Full name">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Relationship</label>
                            <input type="text" value="${contact.relationship || ''}" 
                                   onblur="updateContact('${contact.id}', 'relationship', this.value)"
                                   class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg"
                                   placeholder="e.g., Spouse, Parent, Friend">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Phone *</label>
                            <input type="tel" value="${contact.phone || ''}" 
                                   onblur="updateContact('${contact.id}', 'phone', this.value)"
                                   class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg"
                                   placeholder="+1 (555) 123-4567">
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function addContact() {
            if (contacts.length >= 3) {
                showToast('Maximum 3 contacts allowed', 'warning');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('ice_contacts')
                    .insert({ user_id: currentUser.id })
                    .select()
                    .single();

                if (error) throw error;
                contacts.push(data);
                renderContacts();
                updateCompletion();
                showToast('Contact added successfully', 'success');
            } catch (error) {
                showToast('Failed to add contact: ' + error.message, 'error');
            }
        }

        async function updateContact(id, field, value) {
            try {
                const { error } = await supabase
                    .from('ice_contacts')
                    .update({ [field]: value })
                    .eq('id', id);

                if (error) throw error;
                
                const contact = contacts.find(c => c.id === id);
                if (contact) contact[field] = value;
                
                updateCompletion();
                showToast('Contact updated', 'success');
            } catch (error) {
                showToast('Failed to update contact: ' + error.message, 'error');
            }
        }

        async function deleteContact(id) {
            if (!confirm('Are you sure you want to delete this contact?')) return;
            
            try {
                const { error } = await supabase
                    .from('ice_contacts')
                    .delete()
                    .eq('id', id);

                if (error) throw error;
                
                contacts = contacts.filter(c => c.id !== id);
                renderContacts();
                updateCompletion();
                showToast('Contact deleted successfully', 'success');
            } catch (error) {
                showToast('Failed to delete contact: ' + error.message, 'error');
            }
        }

        // QR Code Generation
        async function generateQRCode() {
            try {
                // Check if user already has a code
                const { data: profile } = await supabase
                    .from('profiles')
                    .select('code')
                    .eq('id', currentUser.id)
                    .single();

                if (profile && profile.code) {
                    showToast('Code already assigned', 'info');
                    showQRCode(profile.code);
                    return;
                }

                // Generate unique 6-character code
                let code;
                let isUnique = false;
                
                while (!isUnique) {
                    code = Math.random().toString(36).substring(2, 8).toUpperCase();
                    const { data } = await supabase
                        .from('profiles')
                        .select('id')
                        .eq('code', code)
                        .single();
                    
                    isUnique = !data;
                }

                // Save code to profile
                const { error } = await supabase
                    .from('profiles')
                    .update({ 
                        code,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);

                if (error) throw error;

                showQRCode(code);
                updateCompletion();
                showToast('QR Code generated successfully! 🎉', 'success');
            } catch (error) {
                showToast('Failed to generate QR code: ' + error.message, 'error');
            }
        }

        function showQRCode(code) {
            const url = `${location.origin}/c/${code}`;
            const canvas = document.getElementById('qr-canvas');
            
            QRCode.toCanvas(canvas, url, { 
                width: 200,
                margin: 1,
                color: {
                    dark: '#000000',
                    light: '#ffffff'
                },
                errorCorrectionLevel: 'M'
            }, (error) => {
                if (error) {
                    showToast('Failed to generate QR code', 'error');
                    return;
                }
                
                // Cache QR code for offline use
                localStorage.setItem('myqer_qr_cache', canvas.toDataURL());
                localStorage.setItem('myqer_qr_code', code);
                localStorage.setItem('myqer_qr_url', url);
                
                // Update UI state
                document.getElementById('qr-placeholder').classList.add('hidden');
                document.getElementById('qr-display-area').classList.remove('hidden');
                document.getElementById('generate-qr-btn').classList.add('hidden');
                document.getElementById('code-permanent').classList.remove('hidden');
                document.getElementById('qr-info').classList.remove('hidden');
                document.getElementById('action-buttons').classList.remove('hidden');
                
                // Update status badge
                const badge = document.getElementById('qr-status-badge');
                badge.className = 'px-3 py-1 rounded-lg text-xs font-semibold bg-green-100 text-green-700';
                badge.innerHTML = '<span>Active</span>';
                
                // Update info
                document.getElementById('short-code').textContent = `MYQER-${code}`;
                document.getElementById('share-link').value = url;
            });
        }

        function copyLink() {
            const link = document.getElementById('share-link');
            link.select();
            document.execCommand('copy');
            showToast('Link copied to clipboard! 📋', 'success');
        }

        function exportPNG() {
            const canvas = document.getElementById('qr-canvas');
            const link = document.createElement('a');
            link.download = 'myqer-qr-code.png';
            link.href = canvas.toDataURL();
            link.click();
            showToast('QR Code exported successfully! 💾', 'success');
        }

        function printQR() {
            const canvas = document.getElementById('qr-canvas');
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>MYQER™ Emergency QR Card</title>
                        <style>
                            body { text-align: center; padding: 40px; font-family: 'Inter', sans-serif; background: #f8fafc; }
                            .card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 400px; margin: 0 auto; }
                            h1 { color: #dc2626; margin-bottom: 10px; font-weight: 900; font-size: 2.5rem; }
                            h2 { color: #374151; margin-bottom: 30px; font-weight: 600; }
                            img { max-width: 280px; border: 4px solid #dc2626; border-radius: 16px; margin: 20px 0; }
                            p { color: #6b7280; margin-top: 20px; font-size: 0.9rem; }
                            .emergency { background: #fef2f2; padding: 15px; border-radius: 10px; margin-top: 20px; border: 2px solid #fecaca; }
                        </style>
                    </head>
                    <body>
                        <div class="card">
                            <h1>MYQER™</h1>
                            <h2>🚨 Emergency Medical Profile</h2>
                            <img src="${canvas.toDataURL()}" alt="MYQER Emergency QR Code">
                            <div class="emergency">
                                <p><strong>📱 Scan for instant emergency access</strong></p>
                                <p>This QR code provides immediate access to critical medical information</p>
                            </div>
                        </div>
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
            showToast('Medical QR card ready to print! 🖨️', 'success');
        }

        async function deleteQRCode() {
            if (!confirm('Are you sure you want to delete your QR code? This action cannot be undone.')) return;
            
            try {
                const { error } = await supabase
                    .from('profiles')
                    .update({ 
                        code: null,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);

                if (error) throw error;

                // Reset UI to initial state
                document.getElementById('qr-placeholder').classList.remove('hidden');
                document.getElementById('qr-display-area').classList.add('hidden');
                document.getElementById('generate-qr-btn').classList.remove('hidden');
                document.getElementById('regenerate-qr-btn').classList.add('hidden');
                document.getElementById('share-section').classList.add('hidden');
                document.getElementById('action-buttons').classList.add('hidden');
                document.getElementById('delete-section').classList.add('hidden');
                
                // Reset status badge
                const badge = document.getElementById('qr-status-badge');
                badge.className = 'px-4 py-2 rounded-full text-xs font-bold bg-gray-100 text-gray-600 border-2 border-gray-300';
                badge.innerHTML = '<span data-translate="not_generated">Not Generated</span>';
                
                updateCompletion();
                showToast('QR code deleted successfully', 'success');
            } catch (error) {
                showToast('Failed to delete QR code: ' + error.message, 'error');
            }
        }

        function regenerateQRCode() {
            showToast('QR regeneration is disabled for security. Delete and create new if needed.', 'warning');
        }

        // Profile Completion
        function updateCompletion() {
            let completed = 0;
            
            // Identity check (25%)
            const fullName = document.getElementById('full_name').value;
            const dob = document.getElementById('date_of_birth').value;
            if (fullName && dob) completed++;
            
            // Health check (25%)
            const bloodType = document.getElementById('blood_type').value;
            if (bloodType || allergies.length > 0 || conditions.length > 0 || medications.length > 0) completed++;
            
            // Contacts check (25%)
            if (contacts.length > 0) completed++;
            
            // QR Code check (25%)
            if (!document.getElementById('qr-display-area').classList.contains('hidden')) completed++;
            
            const percentage = (completed / 4) * 100;
            const circle = document.getElementById('completion-circle');
            const text = document.getElementById('completion-text');
            
            circle.style.strokeDasharray = `${percentage}, 100`;
            text.textContent = `${Math.round(percentage)}%`;
            
            // Change color based on completion
            if (percentage === 100) {
                circle.classList.remove('text-blue-500');
                circle.classList.add('text-green-500');
            } else {
                circle.classList.remove('text-green-500');
                circle.classList.add('text-blue-500');
            }
        }

        // Delete Account
        async function deleteAccount() {
            const confirmation = prompt('Type "DELETE" to confirm account deletion:');
            if (confirmation !== 'DELETE') {
                showToast('Account deletion cancelled', 'info');
                return;
            }

            try {
                // Delete in order: contacts, health_profiles, profiles
                await supabase.from('ice_contacts').delete().eq('user_id', currentUser.id);
                await supabase.from('health_profiles').delete().eq('user_id', currentUser.id);
                await supabase.from('profiles').delete().eq('id', currentUser.id);
                
                await supabase.auth.signOut();
                showToast('Account deleted successfully', 'success');
                setTimeout(() => location.href = '/index.html', 2000);
            } catch (error) {
                showToast('Failed to delete account: ' + error.message, 'error');
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved language
            const savedLanguage = localStorage.getItem('myqer_language') || 'en';
            document.getElementById('language-selector').value = savedLanguage;
            changeLanguage(savedLanguage);
            
            checkSession();

            // Language selector
            document.getElementById('language-selector').addEventListener('change', (e) => {
                changeLanguage(e.target.value);
            });

            // Identity fields
            ['full_name', 'date_of_birth', 'country', 'national_health_id'].forEach(field => {
                document.getElementById(field).addEventListener('input', (e) => {
                    debouncedSave(field, e.target.value);
                });
            });

            // Health fields
            ['blood_type', 'organ_donor', 'life_support_pref'].forEach(field => {
                document.getElementById(field).addEventListener('change', (e) => {
                    debouncedSave(field, e.target.value, 'health_profiles');
                    if (field === 'life_support_pref') updateTriageBadge();
                });
            });

            // Triage override
            document.getElementById('triage_override').addEventListener('change', (e) => {
                debouncedSave('triage_override', e.target.value, 'health_profiles');
                updateTriageBadge();
            });

            // Pills inputs
            ['allergies', 'conditions', 'medications'].forEach(type => {
                document.getElementById(`${type}-input`).addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        addPill(type, e.target.value);
                        e.target.value = '';
                    }
                });
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97885178f0c9ef4e',t:'MTc1Njc2NjkzOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
