<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MYQER™ - Emergency Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            font-size: 14px;
            font-weight: 500;
            line-height: 1.5;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.86);
            backdrop-filter: blur(18px);
            border-radius: 24px;
            box-shadow: 0 18px 40px rgba(16, 24, 40, 0.08);
            border: 1px solid rgba(148, 163, 184, 0.25);
            position: relative;
            padding: 28px;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 24px 48px rgba(16, 24, 40, 0.12);
        }
        
        @media (max-width: 768px) {
            .card {
                border-radius: 16px;
                padding: 20px;
            }
        }
        
        .ribbon {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            border-radius: 24px 24px 0 0;
        }
        
        @media (max-width: 768px) {
            .ribbon {
                border-radius: 16px 16px 0 0;
            }
        }
        
        .ribbon-identity { background: #16a34a; }
        .ribbon-critical { background: #dc2626; }
        .ribbon-ice { background: #ea580c; }
        .ribbon-triage { background: #0ea5e9; }
        .ribbon-vault { background: #7c3aed; }
        .ribbon-qr { background: #f59e0b; }
        .ribbon-danger { background: #dc2626; }
        
        .input-field {
            padding: 12px;
            border-radius: 10px;
            border: 1.5px solid #cbd5e1;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            width: 100%;
            background: white;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.15);
        }
        
        @media (max-width: 768px) {
            .input-field {
                border-radius: 8px;
            }
        }
        
        .field-pair {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        @media (max-width: 640px) {
            .field-pair {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }
        
        .label {
            font-size: 12px;
            font-weight: 700;
            color: #475569;
            margin-bottom: 6px;
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .helper-text {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
        }
        
        .btn-primary {
            background: #dc2626;
            color: white;
            font-weight: 700;
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .btn-primary:hover {
            background: #b91c1c;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: white;
            color: #475569;
            font-weight: 600;
            padding: 12px 24px;
            border-radius: 10px;
            border: 1.5px solid #cbd5e1;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .btn-secondary:hover {
            border-color: #94a3b8;
            transform: translateY(-1px);
        }
        
        .btn-danger {
            background: #dc2626;
            color: white;
            font-weight: 700;
            padding: 16px 32px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
        }
        
        .btn-danger:hover:not(:disabled) {
            background: #b91c1c;
            transform: translateY(-1px);
        }
        
        .btn-danger:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .triage-pill {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .triage-green { background: #22c55e; color: white; }
        .triage-yellow { background: #f59e0b; color: white; }
        .triage-red { background: #ef4444; color: white; }
        .triage-black { background: #1f2937; color: white; }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-online { background: #22c55e; }
        .status-offline { background: #ef4444; }
        .status-hybrid { background: #f59e0b; }
        
        .saved-indicator {
            color: #22c55e;
            font-size: 12px;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .saved-indicator.show {
            opacity: 1;
        }
        
        .qr-container {
            width: 200px;
            height: 200px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            border: 2px solid #f1f5f9;
        }
        
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 32px;
            max-width: 500px;
            margin: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal.show .modal-content {
            transform: scale(1);
        }
        
        .warning-box {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
        }
        
        .warning-box p {
            color: #991b1b;
            font-weight: 600;
            margin: 0;
        }
        
        .grid-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 28px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        @media (max-width: 1024px) {
            .grid-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
        
        .left-column {
            display: flex;
            flex-direction: column;
            gap: 28px;
        }
        
        .right-column {
            display: flex;
            flex-direction: column;
            gap: 28px;
        }
        
        @media (max-width: 1024px) {
            .left-column, .right-column {
                gap: 20px;
            }
        }
        
        .footer-info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 24px;
        }
        
        @media (max-width: 768px) {
            .footer-info-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }
        
        .info-box {
            padding: 20px;
            border-radius: 12px;
            border: 1px solid;
        }
        
        .info-box-privacy {
            background: #eff6ff;
            border-color: #bfdbfe;
        }
        
        .info-box-medical {
            background: #fef2f2;
            border-color: #fecaca;
        }
        
        .info-box-support {
            background: #f0fdf4;
            border-color: #bbf7d0;
        }
        
        .info-box h4 {
            font-weight: 700;
            font-size: 14px;
            margin: 0 0 8px 0;
        }
        
        .info-box p {
            font-size: 12px;
            margin: 0;
            line-height: 1.4;
        }
        
        .info-box-privacy h4 { color: #1e40af; }
        .info-box-privacy p { color: #1e3a8a; }
        .info-box-medical h4 { color: #991b1b; }
        .info-box-medical p { color: #7f1d1d; }
        .info-box-support h4 { color: #166534; }
        .info-box-support p { color: #14532d; }
        
        /* RTL Support */
        [dir="rtl"] {
            text-align: right;
        }
        
        [dir="rtl"] .status-dot {
            margin-right: 0;
            margin-left: 8px;
        }
        
        /* Typography Scale */
        h1 { font-size: 28px; font-weight: 800; }
        h2 { font-size: 20px; font-weight: 700; }
        h3 { font-size: 18px; font-weight: 700; }
        h4 { font-size: 16px; font-weight: 700; }
        
        @media (max-width: 768px) {
            h1 { font-size: 24px; }
            h2 { font-size: 18px; }
            h3 { font-size: 16px; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-lg border-b border-slate-200">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Left: Brand -->
                <div class="flex items-center space-x-4">
                    <h1 class="text-slate-900">
                        MYQ<span class="text-red-600">ER</span><span class="text-xs align-top text-slate-500">™</span>
                    </h1>
                    <div class="hidden md:block text-slate-600 font-medium" data-i18n="header.dashboard">Emergency Dashboard</div>
                </div>
                
                <!-- Center: Status -->
                <div class="flex items-center">
                    <div class="status-dot status-online" id="statusDot"></div>
                    <span class="text-sm text-slate-600" id="statusText" data-i18n="status.online">Online</span>
                </div>
                
                <!-- Right: Controls -->
                <div class="flex items-center space-x-4">
                    <select id="languageSelect" class="input-field text-sm py-2 px-3 w-auto" onchange="handleLanguageChange()">
                        <option value="en">🇺🇸 English</option>
                        <option value="es">🇪🇸 Español</option>
                        <option value="fr">🇫🇷 Français</option>
                        <option value="de">🇩🇪 Deutsch</option>
                        <option value="it">🇮🇹 Italiano</option>
                        <option value="pt">🇵🇹 Português</option>
                        <option value="ro">🇷🇴 Română</option>
                        <option value="ar">🇸🇦 العربية</option>
                        <option value="hi">🇮🇳 हिन्दी</option>
                        <option value="zh">🇨🇳 中文</option>
                    </select>
                    
                    <div class="hidden md:block text-sm text-slate-600" id="userEmail">user@example.com</div>
                    
                    <button onclick="logout()" class="btn-primary">
                        <span data-i18n="auth.logout">Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <div class="grid-layout">
            <!-- Left Column -->
            <div class="left-column">
                <!-- Identity Card -->
                <div class="card">
                    <div class="ribbon ribbon-identity"></div>
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 data-i18n="identity.title">Identity Profile</h2>
                            <div class="text-sm text-slate-500 mt-1" id="identityLastUpdated" data-i18n="identity.lastUpdated">Last updated: Never</div>
                        </div>
                        <div class="saved-indicator" id="identitySaved">✓ <span data-i18n="common.saved">Saved</span></div>
                    </div>
                    
                    <div class="space-y-5">
                        <div>
                            <label class="label" data-i18n="identity.fullName">Full Name</label>
                            <input type="text" id="fullName" class="input-field" data-i18n-placeholder="identity.fullNamePlaceholder" placeholder="Enter your full name" onblur="saveIdentity()">
                        </div>
                        
                        <div class="field-pair">
                            <div>
                                <label class="label" data-i18n="identity.dob">Date of Birth</label>
                                <input type="date" id="dob" class="input-field" onblur="saveIdentity()">
                            </div>
                            <div>
                                <label class="label" data-i18n="identity.country">Country</label>
                                <select id="country" class="input-field" onblur="saveIdentity()">
                                    <option value="" data-i18n="identity.selectCountry">Select Country</option>
                                    <option value="US">🇺🇸 United States</option>
                                    <option value="CA">🇨🇦 Canada</option>
                                    <option value="GB">🇬🇧 United Kingdom</option>
                                    <option value="AU">🇦🇺 Australia</option>
                                    <option value="NZ">🇳🇿 New Zealand</option>
                                    <option value="IE">🇮🇪 Ireland</option>
                                    <option value="FR">🇫🇷 France</option>
                                    <option value="DE">🇩🇪 Germany</option>
                                    <option value="IT">🇮🇹 Italy</option>
                                    <option value="ES">🇪🇸 Spain</option>
                                    <option value="PT">🇵🇹 Portugal</option>
                                    <option value="RO">🇷🇴 Romania</option>
                                    <option value="NL">🇳🇱 Netherlands</option>
                                    <option value="SE">🇸🇪 Sweden</option>
                                    <option value="NO">🇳🇴 Norway</option>
                                    <option value="DK">🇩🇰 Denmark</option>
                                    <option value="CH">🇨🇭 Switzerland</option>
                                    <option value="BE">🇧🇪 Belgium</option>
                                    <option value="PL">🇵🇱 Poland</option>
                                    <option value="CZ">🇨🇿 Czech Republic</option>
                                    <option value="JP">🇯🇵 Japan</option>
                                    <option value="KR">🇰🇷 South Korea</option>
                                    <option value="SG">🇸🇬 Singapore</option>
                                    <option value="AE">🇦🇪 UAE</option>
                                    <option value="SA">🇸🇦 Saudi Arabia</option>
                                    <option value="IN">🇮🇳 India</option>
                                    <option value="PK">🇵🇰 Pakistan</option>
                                    <option value="CN">🇨🇳 China</option>
                                    <option value="HK">🇭🇰 Hong Kong</option>
                                    <option value="TW">🇹🇼 Taiwan</option>
                                    <option value="BR">🇧🇷 Brazil</option>
                                    <option value="MX">🇲🇽 Mexico</option>
                                    <option value="AR">🇦🇷 Argentina</option>
                                    <option value="CO">🇨🇴 Colombia</option>
                                    <option value="CL">🇨🇱 Chile</option>
                                    <option value="ZA">🇿🇦 South Africa</option>
                                    <option value="NG">🇳🇬 Nigeria</option>
                                    <option value="KE">🇰🇪 Kenya</option>
                                    <option value="GH">🇬🇭 Ghana</option>
                                    <option value="EG">🇪🇬 Egypt</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="label" data-i18n="identity.healthId">Health ID</label>
                            <input type="text" id="healthId" class="input-field" data-i18n-placeholder="identity.healthIdPlaceholder" placeholder="NHS, EHIC, national health number" onblur="saveIdentity()">
                            <div class="helper-text" data-i18n="identity.helper">Used to confirm identity for responders.</div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button onclick="saveIdentity()" class="btn-primary">
                            <span data-i18n="identity.save">Save Identity</span>
                        </button>
                    </div>
                </div>

                <!-- Critical Card -->
                <div class="card">
                    <div class="ribbon ribbon-critical"></div>
                    <div class="flex justify-between items-start mb-2">
                        <h2 data-i18n="critical.title">Critical Medical Info</h2>
                        <div class="saved-indicator" id="criticalSaved">✓ <span data-i18n="common.saved">Saved</span></div>
                    </div>
                    <div class="text-sm text-slate-500 mb-6" data-i18n="critical.subtitle">Informational only. Clinicians must verify.</div>
                    
                    <div class="space-y-5">
                        <div class="field-pair">
                            <div>
                                <label class="label" data-i18n="critical.bloodType">Blood Type</label>
                                <select id="bloodType" class="input-field" onblur="saveCritical()">
                                    <option value="" data-i18n="critical.selectBloodType">Select Blood Type</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                </select>
                            </div>
                            <div>
                                <label class="label" data-i18n="critical.organDonor">Organ Donor</label>
                                <select id="organDonor" class="input-field" onblur="saveCritical()">
                                    <option value="" data-i18n="common.select">Select</option>
                                    <option value="yes" data-i18n="common.yes">Yes</option>
                                    <option value="no" data-i18n="common.no">No</option>
                                    <option value="unknown" data-i18n="common.unknown">Unknown</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="label" data-i18n="critical.allergies">Allergies</label>
                            <textarea id="allergies" rows="3" class="input-field resize-none" data-i18n-placeholder="critical.allergiesPlaceholder" placeholder="List any allergies (e.g., Penicillin, Peanuts, Latex)" onblur="saveCritical()"></textarea>
                        </div>
                        
                        <div>
                            <label class="label" data-i18n="critical.conditions">Conditions</label>
                            <textarea id="conditions" rows="3" class="input-field resize-none" data-i18n-placeholder="critical.conditionsPlaceholder" placeholder="List medical conditions (e.g., Diabetes, Hypertension, Asthma)" onblur="saveCritical()"></textarea>
                        </div>
                        
                        <div>
                            <label class="label" data-i18n="critical.medications">Medications</label>
                            <textarea id="medications" rows="3" class="input-field resize-none" data-i18n-placeholder="critical.medicationsPlaceholder" placeholder="List current medications and dosages" onblur="saveCritical()"></textarea>
                        </div>
                        
                        <div>
                            <label class="label" data-i18n="critical.resuscitation">Resuscitation Preferences</label>
                            <select id="resuscitationPref" class="input-field" onblur="saveCritical()">
                                <option value="" data-i18n="critical.selectResuscitation">Select Preference</option>
                                <option value="full" data-i18n="critical.fullLifeSupport">Full life support (all resuscitation)</option>
                                <option value="comfort" data-i18n="critical.comfortCare">Comfort care only (no escalation)</option>
                                <option value="dnr" data-i18n="critical.dnr">Do Not Resuscitate (DNR)</option>
                            </select>
                            <div class="helper-text" data-i18n="critical.resuscitationHelper">This is guidance, not a legal order.</div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button onclick="saveCritical()" class="btn-primary">
                            <span data-i18n="critical.save">Save Critical Info</span>
                        </button>
                    </div>
                </div>

                <!-- ICE Card -->
                <div class="card">
                    <div class="ribbon ribbon-ice"></div>
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 data-i18n="ice.title">In Case of Emergency (ICE)</h2>
                            <div class="text-sm text-slate-500 mt-1" data-i18n="ice.subtitle">Phone numbers are formatted for emergency calling.</div>
                        </div>
                        <div class="saved-indicator" id="iceSaved">✓ <span data-i18n="common.saved">Saved</span></div>
                    </div>
                    
                    <div id="iceContacts" class="space-y-4">
                        <!-- ICE contacts will be dynamically added here -->
                    </div>
                    
                    <div class="flex justify-between items-center mt-6">
                        <button onclick="addICEContact()" id="addICEBtn" class="btn-secondary">
                            <span data-i18n="ice.addContact">Add ICE Contact</span>
                        </button>
                        <span class="text-sm text-slate-500" id="iceCounter">0/3 <span data-i18n="ice.contacts">contacts</span></span>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="right-column">
                <!-- Triage Card -->
                <div class="card">
                    <div class="ribbon ribbon-triage"></div>
                    <h2 class="mb-6" data-i18n="triage.title">Triage Assessment</h2>
                    
                    <div class="text-center mb-6">
                        <div class="triage-pill triage-green mb-3" id="triagePill">
                            <span data-i18n="triage.green">GREEN</span>
                        </div>
                        <p class="text-sm text-slate-600" id="triageDescription" data-i18n="triage.greenDesc">
                            Standard emergency protocols apply.
                        </p>
                    </div>
                    
                    <div class="mb-5">
                        <label class="label" data-i18n="triage.override">Override (Optional)</label>
                        <select class="input-field" id="triageOverride" onchange="handleTriageOverride()">
                            <option value="auto" data-i18n="triage.auto">Auto (Recommended)</option>
                            <option value="green" data-i18n="triage.greenOption">Green - Standard</option>
                            <option value="yellow" data-i18n="triage.yellowOption">Yellow - Urgent</option>
                            <option value="red" data-i18n="triage.redOption">Red - Emergency</option>
                            <option value="black" data-i18n="triage.blackOption">Black - Expectant</option>
                        </select>
                        <div class="helper-text" data-i18n="triage.helper">Triage color is an aid from patient-provided info. Use clinical judgment.</div>
                    </div>
                    
                    <div class="flex gap-3">
                        <button class="flex-1 btn-secondary" onclick="speakTriage()">
                            🔊 <span data-i18n="triage.speak">Speak</span>
                        </button>
                        <button class="flex-1 btn-secondary" onclick="stopSpeaking()">
                            ⏹️ <span data-i18n="triage.stop">Stop</span>
                        </button>
                    </div>
                </div>

                <!-- QR & Tags Card -->
                <div class="card">
                    <div class="ribbon ribbon-qr"></div>
                    <h2 class="mb-6" data-i18n="qr.title">QR Code & Tags</h2>
                    
                    <div id="qrSection">
                        <div id="noCodeState" class="text-center py-8">
                            <div class="text-6xl mb-4">📱</div>
                            <p class="text-slate-600 mb-6" data-i18n="qr.noCode">No emergency code generated yet</p>
                            <button onclick="generateEmergencyCode()" class="btn-primary">
                                🚨 <span data-i18n="qr.generate">Generate Emergency Code</span>
                            </button>
                        </div>
                        
                        <div id="hasCodeState" class="hidden">
                            <div class="qr-container">
                                <canvas id="qrCanvas" width="200" height="200"></canvas>
                            </div>
                            
                            <div class="helper-text text-center mb-4" data-i18n="qr.helper">QR contains essential medical info + online link.</div>
                            
                            <div class="mb-4">
                                <label class="label" data-i18n="qr.payload">QR Payload</label>
                                <textarea id="qrPayloadDisplay" class="input-field resize-none bg-gray-50" rows="6" readonly></textarea>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-2 mb-4">
                                <button onclick="copyPayload()" class="btn-secondary text-sm py-2">
                                    📋 <span data-i18n="qr.copy">Copy</span>
                                </button>
                                <button onclick="downloadQR('png', 1024)" class="btn-secondary text-sm py-2">
                                    📥 1024px
                                </button>
                                <button onclick="downloadQR('png', 512)" class="btn-secondary text-sm py-2">
                                    📥 512px
                                </button>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-2 mb-4">
                                <button onclick="rotateCode()" class="btn-secondary text-sm py-2">
                                    🔄 <span data-i18n="qr.rotate">Rotate</span>
                                </button>
                                <button onclick="revokeCode()" class="btn-primary text-sm py-2">
                                    🚫 <span data-i18n="qr.revoke">Revoke</span>
                                </button>
                                <button onclick="printCard()" class="btn-secondary text-sm py-2">
                                    🖨️ <span data-i18n="qr.print">Print</span>
                                </button>
                            </div>
                            
                            <div class="text-center text-sm text-slate-500">
                                <div><span data-i18n="qr.status">Status:</span> <span id="qrStatus" class="font-semibold text-green-600" data-i18n="qr.active">Active</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vault Card -->
                <div class="card">
                    <div class="ribbon ribbon-vault"></div>
                    <h2 class="mb-6" data-i18n="vault.title">Vault</h2>
                    
                    <div class="space-y-4">
                        <div class="p-4 bg-gray-50 rounded-lg opacity-60">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="text-2xl mr-3">📄</div>
                                    <div>
                                        <h4 class="font-semibold text-gray-700" data-i18n="vault.dnr">DNR Directive</h4>
                                        <p class="text-sm text-gray-500" data-i18n="vault.dnrDesc">Do Not Resuscitate orders</p>
                                    </div>
                                </div>
                                <span class="text-xs bg-gray-300 text-gray-600 px-2 py-1 rounded" data-i18n="vault.comingSoon">Coming Soon</span>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-gray-50 rounded-lg opacity-60">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="text-2xl mr-3">📋</div>
                                    <div>
                                        <h4 class="font-semibold text-gray-700" data-i18n="vault.livingWill">Living Will</h4>
                                        <p class="text-sm text-gray-500" data-i18n="vault.livingWillDesc">Advanced healthcare directives</p>
                                    </div>
                                </div>
                                <span class="text-xs bg-gray-300 text-gray-600 px-2 py-1 rounded" data-i18n="vault.comingSoon">Coming Soon</span>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-gray-50 rounded-lg opacity-60">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="text-2xl mr-3">🏥</div>
                                    <div>
                                        <h4 class="font-semibold text-gray-700" data-i18n="vault.insurance">Insurance Cards</h4>
                                        <p class="text-sm text-gray-500" data-i18n="vault.insuranceDesc">Health insurance information</p>
                                    </div>
                                </div>
                                <span class="text-xs bg-gray-300 text-gray-600 px-2 py-1 rounded" data-i18n="vault.comingSoon">Coming Soon</span>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-gray-50 rounded-lg opacity-60">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="text-2xl mr-3">🔒</div>
                                    <div>
                                        <h4 class="font-semibold text-gray-700" data-i18n="vault.secureStorage">Secure Document Storage</h4>
                                        <p class="text-sm text-gray-500" data-i18n="vault.secureStorageDesc">Encrypted document vault</p>
                                    </div>
                                </div>
                                <span class="text-xs bg-gray-300 text-gray-600 px-2 py-1 rounded" data-i18n="vault.comingSoon">Coming Soon</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Danger Zone -->
        <div class="card mt-8 max-w-4xl mx-auto">
            <div class="ribbon ribbon-danger"></div>
            <h2 class="text-red-600 mb-6">⚠️ <span data-i18n="danger.title">Danger Zone</span></h2>
            
            <div class="warning-box">
                <p data-i18n="danger.warning">This action cannot be undone. All your medical data, QR codes, and contacts will be permanently deleted.</p>
            </div>
            
            <div class="mb-6">
                <label class="label" data-i18n="danger.confirmLabel">Type DELETE MY ACCOUNT to confirm</label>
                <input type="text" id="deleteConfirmInput" class="input-field" data-i18n-placeholder="danger.confirmPlaceholder" placeholder="DELETE MY ACCOUNT" oninput="checkDeleteConfirmation()">
            </div>
            
            <div class="flex gap-4">
                <button onclick="cancelDelete()" class="btn-secondary">
                    <span data-i18n="common.cancel">Cancel</span>
                </button>
                <button onclick="deleteAccountForever()" id="deleteConfirmBtn" class="btn-danger" disabled>
                    <span data-i18n="danger.deleteForever">Delete Account Forever</span>
                </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-16 bg-white/50 backdrop-blur-sm border-t border-slate-200">
        <div class="container mx-auto px-6 py-8">
            <div class="footer-info-grid">
                <div class="info-box info-box-privacy">
                    <h4>🔒 <span data-i18n="footer.privacy">Privacy & Security</span></h4>
                    <p data-i18n="footer.privacyDesc">Your medical data is encrypted and stored securely. Only you control access.</p>
                </div>
                
                <div class="info-box info-box-medical">
                    <h4>⚕️ <span data-i18n="footer.medical">Medical Disclaimer</span></h4>
                    <p data-i18n="footer.medicalDesc">Informational only. Emergency responders must verify all medical information.</p>
                </div>
                
                <div class="info-box info-box-support">
                    <h4>📞 <span data-i18n="footer.support">Support</span></h4>
                    <p data-i18n="footer.supportDesc">Contact support 24/7 for assistance with your emergency codes.</p>
                </div>
            </div>
            
            <div class="text-center text-xs text-slate-500 border-t border-slate-200 pt-4">
                <p>© 2024 MYQER™ • <a href="#" class="text-blue-600 hover:underline" data-i18n="footer.privacy">Privacy Policy</a> • <a href="#" class="text-blue-600 hover:underline" data-i18n="footer.terms">Terms of Service</a> • <a href="#" class="text-blue-600 hover:underline" data-i18n="footer.supportLink">Support</a></p>
            </div>
        </div>
    </footer>

    <script>
        // Internationalization
        const translations = {
            en: {
                "header.dashboard": "Emergency Dashboard",
                "status.online": "Online",
                "status.offline": "No signal",
                "status.hybrid": "Hybrid-ready",
                "auth.logout": "Logout",
                "common.saved": "Saved",
                "common.select": "Select",
                "common.yes": "Yes",
                "common.no": "No",
                "common.unknown": "Unknown",
                "common.cancel": "Cancel",
                "identity.title": "Identity Profile",
                "identity.lastUpdated": "Last updated: Never",
                "identity.fullName": "Full Name",
                "identity.fullNamePlaceholder": "Enter your full name",
                "identity.dob": "Date of Birth",
                "identity.country": "Country",
                "identity.selectCountry": "Select Country",
                "identity.healthId": "Health ID",
                "identity.healthIdPlaceholder": "NHS, EHIC, national health number",
                "identity.helper": "Used to confirm identity for responders.",
                "identity.save": "Save Identity",
                "critical.title": "Critical Medical Info",
                "critical.subtitle": "Informational only. Clinicians must verify.",
                "critical.bloodType": "Blood Type",
                "critical.selectBloodType": "Select Blood Type",
                "critical.organDonor": "Organ Donor",
                "critical.allergies": "Allergies",
                "critical.allergiesPlaceholder": "List any allergies (e.g., Penicillin, Peanuts, Latex)",
                "critical.conditions": "Conditions",
                "critical.conditionsPlaceholder": "List medical conditions (e.g., Diabetes, Hypertension, Asthma)",
                "critical.medications": "Medications",
                "critical.medicationsPlaceholder": "List current medications and dosages",
                "critical.resuscitation": "Resuscitation Preferences",
                "critical.selectResuscitation": "Select Preference",
                "critical.fullLifeSupport": "Full life support (all resuscitation)",
                "critical.comfortCare": "Comfort care only (no escalation)",
                "critical.dnr": "Do Not Resuscitate (DNR)",
                "critical.resuscitationHelper": "This is guidance, not a legal order.",
                "critical.save": "Save Critical Info",
                "ice.title": "In Case of Emergency (ICE)",
                "ice.subtitle": "Phone numbers are formatted for emergency calling.",
                "ice.addContact": "Add ICE Contact",
                "ice.contacts": "contacts",
                "ice.name": "Name",
                "ice.relation": "Relation",
                "ice.phone": "Phone",
                "triage.title": "Triage Assessment",
                "triage.green": "GREEN",
                "triage.yellow": "YELLOW",
                "triage.red": "RED",
                "triage.black": "BLACK",
                "triage.greenDesc": "Standard emergency protocols apply.",
                "triage.yellowDesc": "Medical conditions present - monitor closely.",
                "triage.redDesc": "Critical conditions requiring immediate attention.",
                "triage.blackDesc": "Expectant - comfort care priority.",
                "triage.override": "Override (Optional)",
                "triage.auto": "Auto (Recommended)",
                "triage.greenOption": "Green - Standard",
                "triage.yellowOption": "Yellow - Urgent",
                "triage.redOption": "Red - Emergency",
                "triage.blackOption": "Black - Expectant",
                "triage.helper": "Triage color is an aid from patient-provided info. Use clinical judgment.",
                "triage.speak": "Speak",
                "triage.stop": "Stop",
                "qr.title": "QR Code & Tags",
                "qr.noCode": "No emergency code generated yet",
                "qr.generate": "Generate Emergency Code",
                "qr.helper": "QR contains essential medical info + online link.",
                "qr.payload": "QR Payload",
                "qr.copy": "Copy",
                "qr.rotate": "Rotate",
                "qr.revoke": "Revoke",
                "qr.print": "Print",
                "qr.status": "Status:",
                "qr.active": "Active",
                "vault.title": "Vault",
                "vault.dnr": "DNR Directive",
                "vault.dnrDesc": "Do Not Resuscitate orders",
                "vault.livingWill": "Living Will",
                "vault.livingWillDesc": "Advanced healthcare directives",
                "vault.insurance": "Insurance Cards",
                "vault.insuranceDesc": "Health insurance information",
                "vault.secureStorage": "Secure Document Storage",
                "vault.secureStorageDesc": "Encrypted document vault",
                "vault.comingSoon": "Coming Soon",
                "danger.title": "Danger Zone",
                "danger.warning": "This action cannot be undone. All your medical data, QR codes, and contacts will be permanently deleted.",
                "danger.confirmLabel": "Type DELETE MY ACCOUNT to confirm",
                "danger.confirmPlaceholder": "DELETE MY ACCOUNT",
                "danger.deleteForever": "Delete Account Forever",
                "footer.privacy": "Privacy & Security",
                "footer.privacyDesc": "Your medical data is encrypted and stored securely. Only you control access.",
                "footer.medical": "Medical Disclaimer",
                "footer.medicalDesc": "Informational only. Emergency responders must verify all medical information.",
                "footer.support": "Support",
                "footer.supportDesc": "Contact support 24/7 for assistance with your emergency codes.",
                "footer.terms": "Terms of Service",
                "footer.supportLink": "Support"
            }
        };

        let currentLanguage = 'en';
        let iceContactCount = 0;
        let currentQRCode = null;
        let speechSynthesis = window.speechSynthesis;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            updateTriageAssessment();
            updateICECounter();
            applyTranslations();
        });

        // Language handling
        function handleLanguageChange() {
            const select = document.getElementById('languageSelect');
            currentLanguage = select.value;
            
            // Handle RTL for Arabic
            if (currentLanguage === 'ar') {
                document.documentElement.setAttribute('dir', 'rtl');
            } else {
                document.documentElement.setAttribute('dir', 'ltr');
            }
            
            applyTranslations();
            localStorage.setItem('myqer_language', currentLanguage);
        }

        function applyTranslations() {
            const elements = document.querySelectorAll('[data-i18n]');
            elements.forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });

            // Handle placeholders
            const placeholderElements = document.querySelectorAll('[data-i18n-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.placeholder = translations[currentLanguage][key];
                }
            });
        }

        // Data persistence
        function saveIdentity() {
            const data = {
                fullName: document.getElementById('fullName').value,
                dob: document.getElementById('dob').value,
                country: document.getElementById('country').value,
                healthId: document.getElementById('healthId').value,
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('myqer_identity', JSON.stringify(data));
            showSavedIndicator('identitySaved');
            updateLastUpdated('identityLastUpdated', data.lastUpdated);
            updateTriageAssessment();
        }

        function saveCritical() {
            const data = {
                bloodType: document.getElementById('bloodType').value,
                organDonor: document.getElementById('organDonor').value,
                allergies: document.getElementById('allergies').value,
                conditions: document.getElementById('conditions').value,
                medications: document.getElementById('medications').value,
                resuscitationPref: document.getElementById('resuscitationPref').value
            };
            
            localStorage.setItem('myqer_critical', JSON.stringify(data));
            showSavedIndicator('criticalSaved');
            updateTriageAssessment();
        }

        function saveICE() {
            showSavedIndicator('iceSaved');
        }

        function loadUserData() {
            // Load identity data
            const identityData = localStorage.getItem('myqer_identity');
            if (identityData) {
                const data = JSON.parse(identityData);
                document.getElementById('fullName').value = data.fullName || '';
                document.getElementById('dob').value = data.dob || '';
                document.getElementById('country').value = data.country || '';
                document.getElementById('healthId').value = data.healthId || '';
                if (data.lastUpdated) {
                    updateLastUpdated('identityLastUpdated', data.lastUpdated);
                }
            }

            // Load critical data
            const criticalData = localStorage.getItem('myqer_critical');
            if (criticalData) {
                const data = JSON.parse(criticalData);
                document.getElementById('bloodType').value = data.bloodType || '';
                document.getElementById('organDonor').value = data.organDonor || '';
                document.getElementById('allergies').value = data.allergies || '';
                document.getElementById('conditions').value = data.conditions || '';
                document.getElementById('medications').value = data.medications || '';
                document.getElementById('resuscitationPref').value = data.resuscitationPref || '';
            }

            // Load language preference
            const savedLanguage = localStorage.getItem('myqer_language');
            if (savedLanguage) {
                currentLanguage = savedLanguage;
                document.getElementById('languageSelect').value = savedLanguage;
                if (savedLanguage === 'ar') {
                    document.documentElement.setAttribute('dir', 'rtl');
                }
            }
        }

        function showSavedIndicator(elementId) {
            const indicator = document.getElementById(elementId);
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        function updateLastUpdated(elementId, timestamp) {
            const element = document.getElementById(elementId);
            const date = new Date(timestamp);
            element.textContent = `Last updated: ${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
        }

        // ICE Contacts
        function addICEContact() {
            if (iceContactCount >= 3) return;
            
            iceContactCount++;
            const container = document.getElementById('iceContacts');
            const contactDiv = document.createElement('div');
            contactDiv.className = 'space-y-3 p-4 border border-slate-200 rounded-lg';
            contactDiv.id = `iceContact${iceContactCount}`;
            
            contactDiv.innerHTML = `
                <div class="flex justify-between items-center">
                    <h4 class="font-semibold">Contact ${iceContactCount}</h4>
                    <button onclick="removeICEContact(${iceContactCount})" class="text-red-600 hover:text-red-700 text-sm">Remove</button>
                </div>
                <div class="field-pair">
                    <div>
                        <label class="label" data-i18n="ice.name">Name</label>
                        <input type="text" class="input-field" onblur="saveICE()">
                    </div>
                    <div>
                        <label class="label" data-i18n="ice.relation">Relation</label>
                        <input type="text" class="input-field" onblur="saveICE()">
                    </div>
                </div>
                <div>
                    <label class="label" data-i18n="ice.phone">Phone</label>
                    <input type="tel" class="input-field" onblur="saveICE()">
                </div>
            `;
            
            container.appendChild(contactDiv);
            updateICECounter();
            applyTranslations();
        }

        function removeICEContact(contactId) {
            const contact = document.getElementById(`iceContact${contactId}`);
            if (contact) {
                contact.remove();
                iceContactCount--;
                updateICECounter();
                saveICE();
            }
        }

        function updateICECounter() {
            const counter = document.getElementById('iceCounter');
            const addBtn = document.getElementById('addICEBtn');
            
            counter.innerHTML = `${iceContactCount}/3 <span data-i18n="ice.contacts">contacts</span>`;
            
            if (iceContactCount >= 3) {
                addBtn.disabled = true;
                addBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                addBtn.disabled = false;
                addBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
            
            applyTranslations();
        }

        // Triage Assessment
        function updateTriageAssessment() {
            const criticalData = localStorage.getItem('myqer_critical');
            let triageLevel = 'green';
            
            if (criticalData) {
                const data = JSON.parse(criticalData);
                
                // Simple triage logic
                if (data.conditions && data.conditions.toLowerCase().includes('heart')) {
                    triageLevel = 'red';
                } else if (data.allergies || data.conditions || data.medications) {
                    triageLevel = 'yellow';
                }
            }
            
            const override = document.getElementById('triageOverride').value;
            if (override !== 'auto') {
                triageLevel = override;
            }
            
            updateTriageDisplay(triageLevel);
        }

        function updateTriageDisplay(level) {
            const pill = document.getElementById('triagePill');
            const description = document.getElementById('triageDescription');
            
            pill.className = `triage-pill triage-${level} mb-3`;
            
            const levelText = {
                green: 'GREEN',
                yellow: 'YELLOW',
                red: 'RED',
                black: 'BLACK'
            };
            
            const descText = {
                green: 'Standard emergency protocols apply.',
                yellow: 'Medical conditions present - monitor closely.',
                red: 'Critical conditions requiring immediate attention.',
                black: 'Expectant - comfort care priority.'
            };
            
            pill.querySelector('span').textContent = levelText[level];
            description.textContent = descText[level];
        }

        function handleTriageOverride() {
            updateTriageAssessment();
        }

        function speakTriage() {
            if (speechSynthesis) {
                const text = document.getElementById('triageDescription').textContent;
                const utterance = new SpeechSynthesisUtterance(text);
                speechSynthesis.speak(utterance);
            }
        }

        function stopSpeaking() {
            if (speechSynthesis) {
                speechSynthesis.cancel();
            }
        }

        // QR Code functionality
        function generateEmergencyCode() {
            const identityData = JSON.parse(localStorage.getItem('myqer_identity') || '{}');
            const criticalData = JSON.parse(localStorage.getItem('myqer_critical') || '{}');
            
            const hybridPayload = {
                name: identityData.fullName || 'Unknown',
                dob: identityData.dob || '',
                bloodType: criticalData.bloodType || '',
                allergies: criticalData.allergies || '',
                conditions: criticalData.conditions || '',
                medications: criticalData.medications || '',
                url: `https://myqer.com/e/${generateRandomCode()}`
            };
            
            const payloadText = `MYQER Emergency Profile
Name: ${hybridPayload.name}
DOB: ${hybridPayload.dob}
Blood: ${hybridPayload.bloodType}
Allergies: ${hybridPayload.allergies}
Conditions: ${hybridPayload.conditions}
Medications: ${hybridPayload.medications}
Online: ${hybridPayload.url}`;
            
            currentQRCode = {
                payload: payloadText,
                url: hybridPayload.url,
                generated: new Date().toISOString(),
                status: 'active'
            };
            
            localStorage.setItem('myqer_qr', JSON.stringify(currentQRCode));
            
            // Generate QR code
            const canvas = document.getElementById('qrCanvas');
            QRCode.toCanvas(canvas, payloadText, {
                width: 200,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            });
            
            // Update display
            document.getElementById('qrPayloadDisplay').value = payloadText;
            document.getElementById('noCodeState').classList.add('hidden');
            document.getElementById('hasCodeState').classList.remove('hidden');
        }

        function generateRandomCode() {
            return Math.random().toString(36).substring(2, 15);
        }

        function copyPayload() {
            const textarea = document.getElementById('qrPayloadDisplay');
            textarea.select();
            document.execCommand('copy');
            
            // Show feedback
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '✓ Copied';
            setTimeout(() => {
                btn.innerHTML = originalText;
            }, 1000);
        }

        function downloadQR(format, size) {
            const canvas = document.getElementById('qrCanvas');
            const link = document.createElement('a');
            
            if (format === 'png') {
                // Create high-res canvas
                const highResCanvas = document.createElement('canvas');
                const ctx = highResCanvas.getContext('2d');
                highResCanvas.width = size;
                highResCanvas.height = size;
                
                // Draw QR code at high resolution
                QRCode.toCanvas(highResCanvas, currentQRCode.payload, {
                    width: size,
                    margin: 4,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                });
                
                link.download = `myqer-emergency-${size}px.png`;
                link.href = highResCanvas.toDataURL();
            }
            
            link.click();
        }

        function rotateCode() {
            if (currentQRCode) {
                // Mark old code as expiring in 24h
                currentQRCode.status = 'rotating';
                generateEmergencyCode();
            }
        }

        function revokeCode() {
            if (currentQRCode) {
                currentQRCode.status = 'revoked';
                localStorage.setItem('myqer_qr', JSON.stringify(currentQRCode));
                document.getElementById('qrStatus').textContent = 'Revoked';
                document.getElementById('qrStatus').className = 'font-semibold text-red-600';
            }
        }

        function printCard() {
            window.print();
        }

        // Danger Zone
        function checkDeleteConfirmation() {
            const input = document.getElementById('deleteConfirmInput');
            const btn = document.getElementById('deleteConfirmBtn');
            
            if (input.value === 'DELETE MY ACCOUNT') {
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                btn.disabled = true;
                btn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        function cancelDelete() {
            document.getElementById('deleteConfirmInput').value = '';
            checkDeleteConfirmation();
        }

        function deleteAccountForever() {
            if (confirm('Are you absolutely sure? This cannot be undone.')) {
                // Clear all data
                localStorage.clear();
                
                // Show success message
                alert('Account deleted successfully.');
                
                // Redirect to login
                window.location.href = '/';
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear session but keep data if "Remember me" was checked
                const rememberMe = localStorage.getItem('myqer_remember_me');
                if (!rememberMe) {
                    localStorage.clear();
                }
                window.location.href = '/';
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'976b5829d76daf0c',t:'MTc1NjQ2MzEyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
