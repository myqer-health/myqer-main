<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MYQER Dashboard v6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .premium-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.92) 100%);
            backdrop-filter: blur(25px);
            border: 2px solid rgba(255, 255, 255, 0.4);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.12),
                0 8px 16px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }
        
        .medical-input {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(229, 231, 235, 0.6);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
        }
        
        .medical-input:focus {
            background: rgba(255, 255, 255, 1);
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.12);
            transform: translateY(-1px);
        }
        
        .medical-btn {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            letter-spacing: 0.025em;
        }
        
        .medical-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .medical-btn:active {
            transform: translateY(0);
        }
        
        .gradient-border {
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 3px;
            border-radius: 1rem;
        }
        
        .gradient-border-content {
            background: white;
            border-radius: calc(1rem - 3px);
        }
        
        .floating-header {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }
        
        .section-header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-bottom: 3px solid;
            position: relative;
            overflow: hidden;
        }
        
        .section-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }
        
        .section-header:hover::before {
            left: 100%;
        }
        
        .ice-contact-card {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(220, 38, 38, 0.05) 100%);
            border: 2px solid rgba(239, 68, 68, 0.2);
            transition: all 0.3s ease;
        }
        
        .ice-contact-card:hover {
            border-color: rgba(239, 68, 68, 0.4);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.15);
        }
        
        .completion-ring {
            filter: drop-shadow(0 4px 8px rgba(59, 130, 246, 0.3));
        }
        
        [dir="rtl"] {
            text-align: right;
        }
        [dir="rtl"] .flex {
            flex-direction: row-reverse;
        }
        
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }
        
        .card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .qr-glow {
            animation: qrPulse 2s ease-in-out 3;
        }

        @keyframes qrPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4); }
            50% { box-shadow: 0 0 0 20px rgba(220, 38, 38, 0); }
        }

        .offline-indicator {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 min-h-screen">
    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Sleek Professional Header -->
    <header class="bg-white/95 backdrop-blur-sm border-b border-gray-100 sticky top-0 z-30">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-8">
                    <div class="flex items-center">
                        <h1 class="text-3xl font-black">
                            <span class="text-black">MYQ</span><span class="text-red-600">ER</span>
                        </h1>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-500 italic font-medium">pronounced "my care"</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <!-- Language Selector - Moved to Header Right -->
                    <select id="language-selector" class="medical-input px-4 py-2 rounded-xl text-sm outline-none shadow-lg">
                        <option value="en">üá∫üá∏ English</option>
                        <option value="es">üá™üá∏ Espa√±ol</option>
                        <option value="fr">üá´üá∑ Fran√ßais</option>
                        <option value="de">üá©üá™ Deutsch</option>
                        <option value="it">üáÆüáπ Italiano</option>
                        <option value="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                        <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                        <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                        <option value="hu">üá≠üá∫ Magyar</option>
                        <option value="ro">üá∑üá¥ Rom√¢nƒÉ</option>
                    </select>
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <span class="block text-sm text-gray-700 font-semibold" data-translate="profile_completion">Profile Status</span>
                            <span class="text-xs text-red-600 font-medium" data-translate="complete_for_qr">Complete for emergency access</span>
                        </div>
                        <div class="relative w-12 h-12">
                            <svg class="w-12 h-12 transform -rotate-90" viewBox="0 0 36 36">
                                <path class="text-gray-200" stroke="currentColor" stroke-width="2" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                <path id="completion-circle" class="text-red-600" stroke="currentColor" stroke-width="2" fill="none" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span id="completion-text" class="text-xs font-bold text-red-600">0%</span>
                            </div>
                        </div>
                    </div>
                    <button onclick="signOut()" class="bg-gray-900 text-white px-6 py-2 rounded-lg hover:bg-gray-800 transition-colors font-medium text-sm">
                        <span data-translate="sign_out">Sign Out</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-6 sm:px-8 lg:px-12 py-12">
        <!-- 2x2 Grid Cards Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Identity & ICE Card - Enhanced -->
            <div class="premium-card rounded-3xl p-8 card-hover">
                <div class="section-header -mx-8 -mt-8 px-8 pt-8 pb-6 mb-8 rounded-t-3xl border-blue-500">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                        <div class="w-4 h-4 bg-blue-500 rounded-full mr-4 animate-pulse-slow"></div>
                        <span data-translate="identity_ice">Identity & Emergency Contacts</span>
                    </h2>
                    <p class="text-sm text-gray-600 mt-2 font-medium" data-translate="identity_desc">Personal information and emergency contacts</p>
                </div>
                
                <!-- Identity Section -->
                <div class="space-y-6 mb-8">
                    <div class="grid grid-cols-1 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="full_name">Full Name</label>
                            <input type="text" id="full_name" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg" data-translate-placeholder="enter_full_name">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="date_of_birth">Date of Birth</label>
                            <input type="text" id="date_of_birth" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg" placeholder="DD/MM/YYYY">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="country">Country</label>
                            <select id="country" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg">
                                <option value="" data-translate="select_country">Select Country</option>
                                <option value="US">United States</option>
                                <option value="CA">Canada</option>
                                <option value="GB">United Kingdom</option>
                                <option value="AU">Australia</option>
                                <option value="DE">Germany</option>
                                <option value="FR">France</option>
                                <option value="IT">Italy</option>
                                <option value="ES">Spain</option>
                                <option value="NL">Netherlands</option>
                                <option value="SE">Sweden</option>
                                <option value="NO">Norway</option>
                                <option value="DK">Denmark</option>
                                <option value="FI">Finland</option>
                                <option value="JP">Japan</option>
                                <option value="KR">South Korea</option>
                                <option value="SG">Singapore</option>
                                <option value="NZ">New Zealand</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="health_id">National Health ID</label>
                            <input type="text" id="national_health_id" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg" data-translate-placeholder="enter_health_id">
                        </div>
                    </div>
                </div>

                <!-- ICE Contacts Section -->
                <div class="border-t-2 border-gray-100 pt-8">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-xl font-bold text-red-700 flex items-center">
                                <span data-translate="ice_contacts">ICE Contacts</span>
                            </h3>
                            <p class="text-sm text-gray-600 font-medium mt-1" data-translate="ice_desc">In Case of Emergency</p>
                        </div>
                        <div class="flex flex-col items-end space-y-3">
                            <span id="contact-count" class="text-xs font-bold text-red-600 bg-red-50 px-3 py-2 rounded-full border border-red-200">0 of 3</span>
                            <button onclick="addContact()" id="add-contact-btn" class="medical-btn bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-xl hover:from-red-600 hover:to-red-700 font-semibold text-sm shadow-lg">
                                <span data-translate="add_contact">+ Add Contact</span>
                            </button>
                        </div>
                    </div>
                    <div id="contacts-list" class="space-y-4">
                        <!-- Contacts will be dynamically added here -->
                    </div>
                </div>
            </div>

            <!-- Health Information Card - Enhanced -->
            <div class="premium-card rounded-3xl p-8 card-hover">
                <div class="section-header -mx-8 -mt-8 px-8 pt-8 pb-6 mb-8 rounded-t-3xl border-green-500">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                        <div class="w-4 h-4 bg-green-500 rounded-full mr-4 animate-pulse-slow"></div>
                        <span data-translate="health_info">Health Information</span>
                    </h2>
                    <p class="text-sm text-gray-600 mt-2 font-medium" data-translate="health_desc">Medical details and conditions</p>
                </div>
                
                <div class="space-y-6">
                    <div class="grid grid-cols-1 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="blood_type">Blood Type</label>
                            <select id="blood_type" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg">
                                <option value="" data-translate="select_blood_type">Select Blood Type</option>
                                <option value="A+">A+</option>
                                <option value="A-">A-</option>
                                <option value="B+">B+</option>
                                <option value="B-">B-</option>
                                <option value="AB+">AB+</option>
                                <option value="AB-">AB-</option>
                                <option value="O+">O+</option>
                                <option value="O-">O-</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="organ_donor">Organ Donor</label>
                            <select id="organ_donor" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg">
                                <option value="" data-translate="unspecified">Unspecified</option>
                                <option value="Yes" data-translate="yes">Yes</option>
                                <option value="No" data-translate="no">No</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="life_support">Life Support Preference</label>
                            <select id="life_support_pref" class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg">
                                <option value="" data-translate="select_preference">Select Preference</option>
                                <option value="Full" data-translate="full_support">Full Support</option>
                                <option value="Limited" data-translate="limited_support">Limited Support</option>
                                <option value="Comfort" data-translate="comfort_care">Comfort Care Only</option>
                                <option value="DNR" data-translate="dnr">Do Not Resuscitate</option>
                            </select>
                        </div>
                    </div>

                    <!-- Pills Inputs -->
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="allergies">Allergies</label>
                            <div class="flex flex-wrap gap-2 mb-3" id="allergies-pills"></div>
                            <input type="text" id="allergies-input" class="medical-input w-full px-4 py-3 rounded-xl outline-none" data-translate-placeholder="type_allergy">
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="conditions">Medical Conditions</label>
                            <div class="flex flex-wrap gap-2 mb-3" id="conditions-pills"></div>
                            <input type="text" id="conditions-input" class="medical-input w-full px-4 py-3 rounded-xl outline-none" data-translate-placeholder="type_condition">
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3" data-translate="medications">Medications</label>
                            <div class="flex flex-wrap gap-2 mb-3" id="medications-pills"></div>
                            <input type="text" id="medications-input" class="medical-input w-full px-4 py-3 rounded-xl outline-none" data-translate-placeholder="type_medication">
                        </div>
                    </div>

                    <!-- Triage Badge -->
                    <div class="border-t-2 border-gray-100 pt-6">
                        <div class="flex items-center justify-between mb-4">
                            <label class="block text-sm font-bold text-gray-700" data-translate="triage_priority">Triage Priority</label>
                            <select id="triage_override" class="medical-input px-4 py-2 rounded-lg text-sm outline-none">
                                <option value="Auto" data-translate="auto">Auto</option>
                                <option value="Green">Green</option>
                                <option value="Amber">Amber</option>
                                <option value="Red">Red</option>
                                <option value="Black">Black</option>
                            </select>
                        </div>
                        <div id="triage-badge" class="inline-flex items-center px-4 py-2 rounded-full text-sm font-bold bg-gray-100 text-gray-800 shadow-lg">
                            <span class="w-3 h-3 rounded-full mr-3 bg-gray-400"></span>
                            <span data-translate="not_assessed">Not Assessed</span>
                        </div>
                        <div class="mt-4 p-4 bg-amber-50 border border-amber-200 rounded-xl">
                            <p class="text-xs text-amber-800 leading-relaxed">
                                <strong data-translate="disclaimer">Disclaimer:</strong> <span data-translate="disclaimer_text">MYQER does not diagnose or provide medical advice. This triage label is user-provided and assistive only for responders.</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Professional Emergency QR Card - Enhanced with Full Functionality -->
            <div class="premium-card rounded-3xl p-8 card-hover border border-gray-200">
                <div class="section-header -mx-8 -mt-8 px-8 pt-8 pb-6 mb-8 rounded-t-3xl border-gray-800 bg-gradient-to-r from-gray-50 to-white">
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 flex items-center">
                                <div class="w-4 h-4 bg-gray-800 rounded-full mr-4"></div>
                                <span data-translate="emergency_qr">Emergency Card & QR</span>
                            </h2>
                            <p class="text-sm text-gray-600 mt-2 font-medium" data-translate="qr_desc">Instant emergency access portal</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div id="offline-indicator" class="hidden offline-indicator">
                                <span data-translate="offline_mode">Offline Mode</span>
                            </div>
                            <div id="qr-status-badge" class="px-3 py-1 rounded-lg text-xs font-semibold bg-gray-100 text-gray-600">
                                <span data-translate="not_generated">Not Generated</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- QR Display Area - Enhanced -->
                <div class="mb-8">
                    <div id="qr-placeholder" class="w-full aspect-square max-w-xs mx-auto bg-white rounded-2xl border-2 border-gray-200 flex items-center justify-center shadow-sm">
                        <div class="text-center">
                            <div class="w-12 h-12 mx-auto mb-3 bg-gray-100 rounded-xl flex items-center justify-center">
                                <div class="w-6 h-6 border-2 border-gray-400 rounded"></div>
                            </div>
                            <p class="text-gray-500 font-medium text-sm" data-translate="no_qr_yet">No QR code generated</p>
                        </div>
                    </div>
                    
                    <div id="qr-display-area" class="hidden w-full aspect-square max-w-xs mx-auto bg-white rounded-2xl border-2 border-red-200 flex items-center justify-center shadow-lg relative overflow-hidden">
                        <canvas id="qr-canvas" class="max-w-full max-h-full" alt="Emergency QR Code for MYQER profile"></canvas>
                        <!-- MYQER Logo Overlay -->
                        <div id="qr-overlay" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <div class="bg-red-600 rounded-full w-12 h-12 flex items-center justify-center shadow-lg">
                                <span class="text-white font-black text-xs">ER</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- QR Code Info - Enhanced -->
                <div id="qr-info" class="hidden text-center mb-6">
                    <div class="bg-gray-50 rounded-xl p-4 mb-4">
                        <p class="text-sm text-gray-800 font-mono font-bold" id="short-code">MYQER-XXXXXX</p>
                        <p class="text-xs text-gray-500 mt-1 italic" data-translate="scan_access">Scan for emergency access</p>
                    </div>
                    
                    <!-- Share Link with Copy Button -->
                    <div class="flex rounded-lg overflow-hidden border border-gray-200 mb-4">
                        <input type="text" id="share-link" readonly class="flex-1 px-3 py-2 bg-gray-50 text-xs font-mono text-gray-700 border-0 outline-none">
                        <button onclick="copyLink()" class="px-4 py-2 bg-gray-900 text-white hover:bg-gray-800 transition-colors text-xs font-medium">
                            <span data-translate="copy">Copy</span>
                        </button>
                    </div>

                    <!-- Text Fallback for Accessibility -->
                    <div class="text-xs text-gray-500 mb-4">
                        <p data-translate="manual_entry">Manual entry: Type the URL above if QR scan fails</p>
                    </div>
                </div>

                <!-- Primary Generate Button -->
                <div class="mb-6">
                    <button onclick="generateQRCode()" id="generate-qr-btn" class="w-full bg-red-600 text-white py-3 rounded-xl hover:bg-red-700 transition-colors font-semibold">
                        <span data-translate="generate_code">Generate Emergency Code</span>
                    </button>
                    
                    <div id="code-permanent" class="hidden text-center mt-3">
                        <p class="text-xs text-gray-600 font-medium" data-translate="code_permanent">Your code never changes ‚Äî your profile updates behind it.</p>
                    </div>
                </div>

                <!-- Action Buttons - Enhanced -->
                <div id="action-buttons" class="hidden grid grid-cols-3 gap-3 mb-6">
                    <button onclick="exportPNG()" class="bg-white text-gray-700 py-2 px-3 rounded-lg hover:bg-gray-50 text-xs font-medium border border-gray-200">
                        <span data-translate="png_download">PNG</span>
                    </button>
                    <button onclick="exportSVG()" class="bg-white text-gray-700 py-2 px-3 rounded-lg hover:bg-gray-50 text-xs font-medium border border-gray-200">
                        <span data-translate="svg_download">SVG</span>
                    </button>
                    <button onclick="printQR()" class="bg-white text-gray-700 py-2 px-3 rounded-lg hover:bg-gray-50 text-xs font-medium border border-gray-200">
                        <span data-translate="print_card">Print</span>
                    </button>
                </div>

                <!-- Voice Summary Button for Responders -->
                <div id="voice-summary" class="hidden mb-6 text-center">
                    <button onclick="playVoiceSummary()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">
                        üîä <span data-translate="voice_summary">Voice Summary</span>
                    </button>
                </div>

                <!-- Privacy Disclaimer - Enhanced -->
                <div class="text-center border-t border-gray-100 pt-4">
                    <p class="text-xs text-gray-500 leading-relaxed mb-2">
                        <span data-translate="privacy_disclaimer">This QR provides read-only, emergency information. Your data remains private unless you choose to share.</span>
                    </p>
                    <p class="text-xs text-gray-400">
                        <span data-translate="gdpr_hipaa">GDPR & HIPAA compliant. Emergency access only.</span>
                    </p>
                </div>
            </div>

            <!-- Delete Account Card - Full Width Premium -->
            <div class="gradient-border card-hover">
                <div class="gradient-border-content p-12 text-center">
                    <div class="max-w-2xl mx-auto">
                        <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-red-100 to-red-200 rounded-full flex items-center justify-center">
                            <div class="w-8 h-8 border-4 border-red-600 rounded-full"></div>
                        </div>
                        <h2 class="text-3xl font-bold text-red-900 mb-4" data-translate="danger_zone">Danger Zone</h2>
                        <p class="text-red-700 text-lg mb-8 leading-relaxed font-medium" data-translate="delete_warning">
                            This action cannot be undone. This will permanently delete your account and all associated data.
                        </p>
                        <button onclick="deleteAccount()" class="medical-btn bg-gradient-to-r from-red-600 to-red-700 text-white px-12 py-4 rounded-2xl hover:from-red-700 hover:to-red-800 font-bold text-lg shadow-lg">
                            <span data-translate="delete_account">Delete Account</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Professional Footer -->
    <footer class="bg-gray-50 border-t border-gray-200 mt-16">
        <div class="max-w-7xl mx-auto px-6 py-8">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-6">
                    <div class="flex items-center">
                        <h3 class="text-lg font-black">
                            <span class="text-black">MYQ</span><span class="text-red-600">ER</span>
                        </h3>
                        <span class="ml-3 text-xs text-gray-500 italic">pronounced "my care"</span>
                    </div>
                </div>
                <div class="flex items-center space-x-6 text-sm">
                    <a href="/privacy.html" class="text-gray-600 hover:text-gray-900 transition-colors font-medium">Privacy Policy</a>
                    <a href="/terms.html" class="text-gray-600 hover:text-gray-900 transition-colors font-medium">Terms of Service</a>
                    <span class="text-gray-400">¬© 2024 MYQER</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://tgddpmxpbgrzrbzpomou.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRnZGRwbXhwYmdyenJienBvbW91Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwNDgxMTMsImV4cCI6MjA3MTYyNDExM30.uXntx0rZISv927MQAG1LgGKA-lA08hSkzXMre7Bk2QM';
        
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Global Supabase client and profile cache
        const sb = window.sb || supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Cache of profile/health
        let profile = null, health = null;
        
        let currentUser = null;
        let debounceTimers = {};
        let contacts = [];
        let allergies = [];
        let conditions = [];
        let medications = [];
        let currentLanguage = 'en';
        let isOffline = false;

        // Load both records once at startup (and anytime after save)
        async function loadAll() {
            try {
                const { data: p } = await sb.from('profiles').select('*').eq('id', currentUser.id).single();
                const { data: h } = await sb.from('health_profiles').select('*').eq('user_id', currentUser.id).single();
                profile = p || {};
                health = h || {};
            } catch (error) {
                console.error('Error loading profile data:', error);
                profile = {};
                health = {};
            }
        }

        // Generate or reuse a code, then save & render QR
        async function ensureCode() {
            if (profile?.code && profile.code.length > 10) return profile.code;
            const code = (crypto.randomUUID().replace(/-/g,'') + crypto.randomUUID().replace(/-/g,'')).slice(0,32);
            const { data, error } = await sb.from('profiles').upsert({ 
                id: currentUser.id, 
                email: currentUser.email,
                code,
                updated_at: new Date().toISOString()
            }).select().single();
            if (error) throw error;
            profile = data;
            return code;
        }

        async function renderQR() {
            const cardBox = document.getElementById('qr-canvas');
            const linkEl = document.getElementById('share-link');
            if (!cardBox || !linkEl) return;

            // Guard against library not ready
            if (typeof QRCode === 'undefined' || !QRCode.toCanvas) {
                cardBox.innerHTML = '<div style="opacity:.6">QR library not loaded</div>';
                return;
            }

            const code = await ensureCode();
            const cardUrl = `https://www.myqer.com/c/${code}`;
            linkEl.value = cardUrl;

            // Clear previous canvas and create new one
            cardBox.innerHTML = '';
            const canvas = document.createElement('canvas');
            canvas.id = 'qr-canvas';
            canvas.width = 200;
            canvas.height = 200;
            cardBox.appendChild(canvas);

            // Generate branded QR
            await QRCode.toCanvas(canvas, cardUrl, {
                margin: 1,
                width: 200,
                color: {
                    dark: '#C62828',    // MYQER red modules
                    light: '#FFFFFF00', // transparent background
                },
                errorCorrectionLevel: 'H'
            });

            // Draw tiny center badge
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#fff'; 
            ctx.strokeStyle = '#C62828';
            ctx.lineWidth = 2;
            ctx.beginPath(); 
            ctx.roundRect(85, 85, 30, 30, 8); 
            ctx.fill(); 
            ctx.stroke();
            ctx.fillStyle = '#C62828';
            ctx.font = '700 8px system-ui, -apple-system, Segoe UI';
            ctx.textAlign = 'center'; 
            ctx.textBaseline = 'middle';
            ctx.fillText('ER', 100, 100);

            // Cache QR code for offline use
            localStorage.setItem('myqer_qr_cache', canvas.toDataURL());
            localStorage.setItem('myqer_qr_code', code);
            localStorage.setItem('myqer_qr_url', cardUrl);
            
            // Update UI state
            document.getElementById('qr-placeholder').classList.add('hidden');
            document.getElementById('qr-display-area').classList.remove('hidden');
            document.getElementById('generate-qr-btn').classList.add('hidden');
            document.getElementById('code-permanent').classList.remove('hidden');
            document.getElementById('qr-info').classList.remove('hidden');
            document.getElementById('action-buttons').classList.remove('hidden');
            document.getElementById('voice-summary').classList.remove('hidden');
            
            // Add gentle pulse animation
            document.getElementById('qr-display-area').classList.add('qr-glow');
            setTimeout(() => {
                document.getElementById('qr-display-area').classList.remove('qr-glow');
            }, 6000);
            
            // Update status badge
            const badge = document.getElementById('qr-status-badge');
            badge.className = 'px-3 py-1 rounded-lg text-xs font-semibold bg-green-100 text-green-700';
            badge.innerHTML = '<span>Active</span>';
            
            // Update info
            document.getElementById('short-code').textContent = `MYQER-${code.slice(0,8)}`;
        }

        // Enhanced Translations with QR-specific terms
        const translations = {
            en: {
                dashboard_title: "MYQER",
                profile_completion: "Profile Status",
                complete_for_qr: "Complete for emergency access",
                not_generated: "Not Generated",
                no_qr_yet: "No QR code generated",
                emergency_qr: "Emergency Card & QR",
                qr_desc: "Instant emergency access portal",
                generate_code: "Generate Emergency Code",
                code_permanent: "Your code never changes ‚Äî your profile updates behind it.",
                scan_access: "Scan for emergency access",
                manual_entry: "Manual entry: Type the URL above if QR scan fails",
                copy: "Copy",
                png_download: "PNG",
                svg_download: "SVG",
                print_card: "Print",
                voice_summary: "Voice Summary",
                offline_mode: "Offline Mode",
                privacy_disclaimer: "This QR provides read-only, emergency information. Your data remains private unless you choose to share.",
                gdpr_hipaa: "GDPR & HIPAA compliant. Emergency access only.",
                sign_out: "Sign Out",
                identity_ice: "Identity & Emergency Contacts",
                identity_desc: "Personal information and emergency contacts",
                full_name: "Full Name",
                enter_full_name: "Enter your full name",
                date_of_birth: "Date of Birth",
                country: "Country",
                select_country: "Select Country",
                health_id: "National Health ID",
                enter_health_id: "Enter health ID number",
                ice_contacts: "ICE Contacts",
                ice_desc: "In Case of Emergency",
                add_contact: "+ Add Contact",
                health_info: "Health Information",
                health_desc: "Medical details and conditions",
                blood_type: "Blood Type",
                select_blood_type: "Select Blood Type",
                organ_donor: "Organ Donor",
                unspecified: "Unspecified",
                yes: "Yes",
                no: "No",
                life_support: "Life Support Preference",
                select_preference: "Select Preference",
                full_support: "Full Support",
                limited_support: "Limited Support",
                comfort_care: "Comfort Care Only",
                dnr: "Do Not Resuscitate",
                allergies: "Allergies",
                type_allergy: "Type allergy and press Enter",
                conditions: "Medical Conditions",
                type_condition: "Type condition and press Enter",
                medications: "Medications",
                type_medication: "Type medication and press Enter",
                triage_priority: "Triage Priority",
                auto: "Auto",
                not_assessed: "Not Assessed",
                disclaimer: "Disclaimer:",
                disclaimer_text: "MYQER does not diagnose or provide medical advice. This triage label is user-provided and assistive only for responders.",
                danger_zone: "Danger Zone",
                delete_warning: "This action cannot be undone. This will permanently delete your account and all associated data.",
                delete_account: "Delete Account"
            },
            es: {
                dashboard_title: "Panel MYQER",
                profile_completion: "Estado del Perfil",
                complete_for_qr: "Completa para acceso QR",
                not_generated: "No Generado",
                no_qr_yet: "No hay c√≥digo QR generado",
                emergency_qr: "Tarjeta de Emergencia y QR",
                qr_desc: "Portal de acceso de emergencia instant√°neo",
                generate_code: "Generar C√≥digo de Emergencia",
                code_permanent: "Tu c√≥digo nunca cambia ‚Äî tu perfil se actualiza detr√°s de √©l.",
                scan_access: "Escanea para acceso de emergencia",
                manual_entry: "Entrada manual: Escribe la URL arriba si falla el escaneo QR",
                copy: "Copiar",
                png_download: "PNG",
                svg_download: "SVG",
                print_card: "Imprimir",
                voice_summary: "Resumen de Voz",
                offline_mode: "Modo Sin Conexi√≥n",
                privacy_disclaimer: "Este QR proporciona informaci√≥n de emergencia de solo lectura. Tus datos permanecen privados a menos que elijas compartir.",
                gdpr_hipaa: "Cumple con GDPR y HIPAA. Solo acceso de emergencia.",
                sign_out: "Cerrar Sesi√≥n",
                identity_ice: "Identidad y Contactos de Emergencia",
                identity_desc: "Informaci√≥n personal y contactos de emergencia",
                full_name: "Nombre Completo",
                enter_full_name: "Ingrese su nombre completo",
                date_of_birth: "Fecha de Nacimiento",
                country: "Pa√≠s",
                select_country: "Seleccionar Pa√≠s",
                health_id: "ID de Salud Nacional",
                enter_health_id: "Ingrese n√∫mero de ID de salud",
                ice_contacts: "Contactos ICE",
                ice_desc: "En Caso de Emergencia",
                add_contact: "+ Agregar Contacto",
                health_info: "Informaci√≥n de Salud",
                health_desc: "Detalles m√©dicos y condiciones",
                blood_type: "Tipo de Sangre",
                select_blood_type: "Seleccionar Tipo de Sangre",
                organ_donor: "Donante de √ìrganos",
                unspecified: "No Especificado",
                yes: "S√≠",
                no: "No",
                life_support: "Preferencia de Soporte Vital",
                select_preference: "Seleccionar Preferencia",
                full_support: "Soporte Completo",
                limited_support: "Soporte Limitado",
                comfort_care: "Solo Cuidados Paliativos",
                dnr: "No Resucitar",
                allergies: "Alergias",
                type_allergy: "Escriba alergia y presione Enter",
                conditions: "Condiciones M√©dicas",
                type_condition: "Escriba condici√≥n y presione Enter",
                medications: "Medicamentos",
                type_medication: "Escriba medicamento y presione Enter",
                triage_priority: "Prioridad de Triaje",
                auto: "Autom√°tico",
                not_assessed: "No Evaluado",
                disclaimer: "Descargo:",
                disclaimer_text: "MYQER no diagnostica ni proporciona consejos m√©dicos. Esta etiqueta de triaje es proporcionada por el usuario y solo es de asistencia para los respondedores.",
                danger_zone: "Zona de Peligro",
                delete_warning: "Esta acci√≥n no se puede deshacer. Esto eliminar√° permanentemente su cuenta y todos los datos asociados.",
                delete_account: "Eliminar Cuenta"
            },
            fr: {
                dashboard_title: "Tableau de Bord MYQER",
                profile_completion: "√âtat du Profil",
                complete_for_qr: "Compl√©tez pour l'acc√®s QR",
                not_generated: "Non G√©n√©r√©",
                no_qr_yet: "Aucun code QR g√©n√©r√©",
                emergency_qr: "Carte d'Urgence et QR",
                qr_desc: "Portail d'acc√®s d'urgence instantan√©",
                generate_code: "G√©n√©rer Code d'Urgence",
                code_permanent: "Votre code ne change jamais ‚Äî votre profil se met √† jour derri√®re.",
                scan_access: "Scannez pour acc√®s d'urgence",
                manual_entry: "Saisie manuelle: Tapez l'URL ci-dessus si le scan QR √©choue",
                copy: "Copier",
                png_download: "PNG",
                svg_download: "SVG",
                print_card: "Imprimer",
                voice_summary: "R√©sum√© Vocal",
                offline_mode: "Mode Hors Ligne",
                privacy_disclaimer: "Ce QR fournit des informations d'urgence en lecture seule. Vos donn√©es restent priv√©es sauf si vous choisissez de partager.",
                gdpr_hipaa: "Conforme RGPD et HIPAA. Acc√®s d'urgence uniquement.",
                sign_out: "Se D√©connecter",
                identity_ice: "Identit√© et Contacts d'Urgence",
                identity_desc: "Informations personnelles et contacts d'urgence",
                full_name: "Nom Complet",
                enter_full_name: "Entrez votre nom complet",
                date_of_birth: "Date de Naissance",
                country: "Pays",
                select_country: "S√©lectionner le Pays",
                health_id: "ID de Sant√© National",
                enter_health_id: "Entrez le num√©ro d'ID de sant√©",
                ice_contacts: "Contacts ICE",
                ice_desc: "En Cas d'Urgence",
                add_contact: "+ Ajouter Contact",
                health_info: "Informations de Sant√©",
                health_desc: "D√©tails m√©dicaux et conditions",
                blood_type: "Groupe Sanguin",
                select_blood_type: "S√©lectionner le Groupe Sanguin",
                organ_donor: "Donneur d'Organes",
                unspecified: "Non Sp√©cifi√©",
                yes: "Oui",
                no: "Non",
                life_support: "Pr√©f√©rence de Support Vital",
                select_preference: "S√©lectionner la Pr√©f√©rence",
                full_support: "Support Complet",
                limited_support: "Support Limit√©",
                comfort_care: "Soins Palliatifs Seulement",
                dnr: "Ne Pas R√©animer",
                allergies: "Allergies",
                type_allergy: "Tapez allergie et appuyez sur Entr√©e",
                conditions: "Conditions M√©dicales",
                type_condition: "Tapez condition et appuyez sur Entr√©e",
                medications: "M√©dicaments",
                type_medication: "Tapez m√©dicament et appuyez sur Entr√©e",
                triage_priority: "Priorit√© de Triage",
                auto: "Automatique",
                not_assessed: "Non √âvalu√©",
                disclaimer: "Avertissement:",
                disclaimer_text: "MYQER ne diagnostique pas et ne fournit pas de conseils m√©dicaux. Cette √©tiquette de triage est fournie par l'utilisateur et n'est qu'une aide pour les intervenants.",
                danger_zone: "Zone de Danger",
                delete_warning: "Cette action ne peut pas √™tre annul√©e. Cela supprimera d√©finitivement votre compte et toutes les donn√©es associ√©es.",
                delete_account: "Supprimer le Compte"
            },
            de: {
                dashboard_title: "MYQER Dashboard",
                profile_completion: "Profil-Status",
                complete_for_qr: "Vervollst√§ndigen f√ºr QR-Zugang",
                not_generated: "Nicht Generiert",
                no_qr_yet: "Kein QR-Code generiert",
                emergency_qr: "Notfall-Karte & QR",
                qr_desc: "Sofortiger Notfall-Zugangsportal",
                generate_code: "Notfall-Code Generieren",
                code_permanent: "Ihr Code √§ndert sich nie ‚Äî Ihr Profil aktualisiert sich dahinter.",
                scan_access: "Scannen f√ºr Notfall-Zugang",
                manual_entry: "Manuelle Eingabe: Geben Sie die URL oben ein, wenn QR-Scan fehlschl√§gt",
                copy: "Kopieren",
                png_download: "PNG",
                svg_download: "SVG",
                print_card: "Drucken",
                voice_summary: "Sprach-Zusammenfassung",
                offline_mode: "Offline-Modus",
                privacy_disclaimer: "Dieser QR bietet schreibgesch√ºtzte Notfallinformationen. Ihre Daten bleiben privat, es sei denn, Sie w√§hlen zu teilen.",
                gdpr_hipaa: "DSGVO & HIPAA konform. Nur Notfall-Zugang.",
                sign_out: "Abmelden",
                identity_ice: "Identit√§t & Notfallkontakte",
                identity_desc: "Pers√∂nliche Informationen und Notfallkontakte",
                full_name: "Vollst√§ndiger Name",
                enter_full_name: "Geben Sie Ihren vollst√§ndigen Namen ein",
                date_of_birth: "Geburtsdatum",
                country: "Land",
                select_country: "Land Ausw√§hlen",
                health_id: "Nationale Gesundheits-ID",
                enter_health_id: "Gesundheits-ID-Nummer eingeben",
                ice_contacts: "ICE-Kontakte",
                ice_desc: "Im Notfall",
                add_contact: "+ Kontakt Hinzuf√ºgen",
                health_info: "Gesundheitsinformationen",
                health_desc: "Medizinische Details und Bedingungen",
                blood_type: "Blutgruppe",
                select_blood_type: "Blutgruppe Ausw√§hlen",
                organ_donor: "Organspender",
                unspecified: "Nicht Angegeben",
                yes: "Ja",
                no: "Nein",
                life_support: "Lebenserhaltungs-Pr√§ferenz",
                select_preference: "Pr√§ferenz Ausw√§hlen",
                full_support: "Vollst√§ndige Unterst√ºtzung",
                limited_support: "Begrenzte Unterst√ºtzung",
                comfort_care: "Nur Palliativpflege",
                dnr: "Nicht Wiederbeleben",
                allergies: "Allergien",
                type_allergy: "Allergie eingeben und Enter dr√ºcken",
                conditions: "Medizinische Bedingungen",
                type_condition: "Bedingung eingeben und Enter dr√ºcken",
                medications: "Medikamente",
                type_medication: "Medikament eingeben und Enter dr√ºcken",
                triage_priority: "Triage-Priorit√§t",
                auto: "Automatisch",
                not_assessed: "Nicht Bewertet",
                disclaimer: "Haftungsausschluss:",
                disclaimer_text: "MYQER diagnostiziert nicht und gibt keine medizinischen Ratschl√§ge. Dieses Triage-Label wird vom Benutzer bereitgestellt und dient nur zur Unterst√ºtzung der Ersthelfer.",
                danger_zone: "Gefahrenzone",
                delete_warning: "Diese Aktion kann nicht r√ºckg√§ngig gemacht werden. Dies wird Ihr Konto und alle zugeh√∂rigen Daten dauerhaft l√∂schen.",
                delete_account: "Konto L√∂schen"
            },
            it: {
                dashboard_title: "Dashboard MYQER",
                profile_completion: "Stato Profilo",
                complete_for_qr: "Completa per accesso QR",
                not_generated: "Non Generato",
                no_qr_yet: "Nessun codice QR generato",
                emergency_qr: "Carta di Emergenza & QR",
                qr_desc: "Portale di accesso di emergenza istantaneo",
                generate_code: "Genera Codice di Emergenza",
                code_permanent: "Il tuo codice non cambia mai ‚Äî il tuo profilo si aggiorna dietro di esso.",
                scan_access: "Scansiona per accesso di emergenza",
                manual_entry: "Inserimento manuale: Digita l'URL sopra se la scansione QR fallisce",
                copy: "Copia",
                png_download: "PNG",
                svg_download: "SVG",
                print_card: "Stampa",
                voice_summary: "Riassunto Vocale",
                offline_mode: "Modalit√† Offline",
                privacy_disclaimer: "Questo QR fornisce informazioni di emergenza di sola lettura. I tuoi dati rimangono privati a meno che tu non scelga di condividere.",
                gdpr_hipaa: "Conforme GDPR e HIPAA. Solo accesso di emergenza.",
                sign_out: "Disconnetti",
                identity_ice: "Identit√† e Contatti di Emergenza",
                identity_desc: "Informazioni personali e contatti di emergenza",
                full_name: "Nome Completo",
                enter_full_name: "Inserisci il tuo nome completo",
                date_of_birth: "Data di Nascita",
                country: "Paese",
                select_country: "Seleziona Paese",
                health_id: "ID Sanitario Nazionale",
                enter_health_id: "Inserisci numero ID sanitario",
                ice_contacts: "Contatti ICE",
                ice_desc: "In Caso di Emergenza",
                add_contact: "+ Aggiungi Contatto",
                health_info: "Informazioni Sanitarie",
                health_desc: "Dettagli medici e condizioni",
                blood_type: "Gruppo Sanguigno",
                select_blood_type: "Seleziona Gruppo Sanguigno",
                organ_donor: "Donatore di Organi",
                unspecified: "Non Specificato",
                yes: "S√¨",
                no: "No",
                life_support: "Preferenza Supporto Vitale",
                select_preference: "Seleziona Preferenza",
                full_support: "Supporto Completo",
                limited_support: "Supporto Limitato",
                comfort_care: "Solo Cure Palliative",
                dnr: "Non Rianimare",
                allergies: "Allergie",
                type_allergy: "Digita allergia e premi Invio",
                conditions: "Condizioni Mediche",
                type_condition: "Digita condizione e premi Invio",
                medications: "Farmaci",
                type_medication: "Digita farmaco e premi Invio",
                triage_priority: "Priorit√† Triage",
                auto: "Automatico",
                not_assessed: "Non Valutato",
                disclaimer: "Disclaimer:",
                disclaimer_text: "MYQER non diagnostica n√© fornisce consigli medici. Questa etichetta di triage √® fornita dall'utente ed √® solo di assistenza per i soccorritori.",
                danger_zone: "Zona di Pericolo",
                delete_warning: "Questa azione non pu√≤ essere annullata. Questo eliminer√† permanentemente il tuo account e tutti i dati associati.",
                delete_account: "Elimina Account"
            },
            hi: {
                dashboard_title: "MYQER ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°",
                profile_completion: "‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø",
                complete_for_qr: "QR ‡§™‡§π‡•Å‡§Ç‡§ö ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞‡•á‡§Ç",
                not_generated: "‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç",
                no_qr_yet: "‡§ï‡•ã‡§à QR ‡§ï‡•ã‡§° ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç",
                emergency_qr: "‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§ï‡§æ‡§∞‡•ç‡§° ‡§î‡§∞ QR",
                qr_desc: "‡§§‡§§‡•ç‡§ï‡§æ‡§≤ ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§™‡§π‡•Å‡§Ç‡§ö ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤",
                generate_code: "‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§ï‡•ã‡§° ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡•á‡§Ç",
                code_permanent: "‡§Ü‡§™‡§ï‡§æ ‡§ï‡•ã‡§° ‡§ï‡§≠‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§¨‡§¶‡§≤‡§§‡§æ ‚Äî ‡§Ü‡§™‡§ï‡•Ä ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§á‡§∏‡§ï‡•á ‡§™‡•Ä‡§õ‡•á ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§",
                scan_access: "‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§™‡§π‡•Å‡§Ç‡§ö ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç",
                manual_entry: "‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø: ‡§Ø‡§¶‡§ø QR ‡§∏‡•ç‡§ï‡•à‡§® ‡§µ‡§ø‡§´‡§≤ ‡§π‡•ã ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§§‡•ã ‡§ä‡§™‡§∞ URL ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç",
                copy: "‡§ï‡•â‡§™‡•Ä",
                png_download: "PNG",
                svg_download: "SVG",
                print_card: "‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü",
                voice_summary: "‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂",
                offline_mode: "‡§ë‡§´‡§º‡§≤‡§æ‡§á‡§® ‡§Æ‡•ã‡§°",
                privacy_disclaimer: "‡§Ø‡§π QR ‡§ï‡•á‡§µ‡§≤ ‡§™‡§¢‡§º‡§®‡•á ‡§Ø‡•ã‡§ó‡•ç‡§Ø, ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ü‡§™‡§ï‡§æ ‡§°‡•á‡§ü‡§æ ‡§§‡§¨ ‡§§‡§ï ‡§®‡§ø‡§ú‡•Ä ‡§∞‡§π‡§§‡§æ ‡§π‡•à ‡§ú‡§¨ ‡§§‡§ï ‡§Ü‡§™ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡§®‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ö‡•Å‡§®‡§§‡•á‡•§",
                gdpr_hipaa: "GDPR ‡§î‡§∞ HIPAA ‡§Ö‡§®‡•Å‡§™‡§æ‡§≤‡§ø‡§§‡•§ ‡§ï‡•á‡§µ‡§≤ ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§™‡§π‡•Å‡§Ç‡§ö‡•§",
                sign_out: "‡§∏‡§æ‡§á‡§® ‡§Ü‡§â‡§ü",
                identity_ice: "‡§™‡§π‡§ö‡§æ‡§® ‡§î‡§∞ ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï",
                identity_desc: "‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§î‡§∞ ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï",
                full_name: "‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ",
                enter_full_name: "‡§Ö‡§™‡§®‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
                date_of_birth: "‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø",
                country: "‡§¶‡•á‡§∂",
                select_country: "‡§¶‡•á‡§∂ ‡§ö‡•Å‡§®‡•á‡§Ç",
                health_id: "‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§Ü‡§à‡§°‡•Ä",
                enter_health_id: "‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§Ü‡§à‡§°‡•Ä ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
                ice_contacts: "ICE ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï",
                ice_desc: "‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤ ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Æ‡•á‡§Ç",
                add_contact: "+ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç",
                health_info: "‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
                health_desc: "‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§î‡§∞ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø‡§Ø‡§æ‡§Ç",
                blood_type: "‡§∞‡§ï‡•ç‡§§ ‡§∏‡§Æ‡•Ç‡§π",
                select_blood_type: "‡§∞‡§ï‡•ç‡§§ ‡§∏‡§Æ‡•Ç‡§π ‡§ö‡•Å‡§®‡•á‡§Ç",
                organ_donor: "‡§Ö‡§Ç‡§ó ‡§¶‡§æ‡§§‡§æ",
                unspecified: "‡§Ö‡§®‡§ø‡§∞‡•ç‡§¶‡§ø‡§∑‡•ç‡§ü",
                yes: "‡§π‡§æ‡§Å",
                no: "‡§®‡§π‡•Ä‡§Ç",
                life_support: "‡§ú‡•Ä‡§µ‡§® ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ",
                select_preference: "‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç",
                full_support: "‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§®",
                limited_support: "‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§®",
                comfort_care: "‡§ï‡•á‡§µ‡§≤ ‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡•Ä ‡§¶‡•á‡§ñ‡§≠‡§æ‡§≤",
                dnr: "‡§™‡•Å‡§®‡§∞‡•ç‡§ú‡•Ä‡§µ‡§ø‡§§ ‡§® ‡§ï‡§∞‡•á‡§Ç",
                allergies: "‡§è‡§≤‡§∞‡•ç‡§ú‡•Ä",
                type_allergy: "‡§è‡§≤‡§∞‡•ç‡§ú‡•Ä ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§è‡§Ç‡§ü‡§∞ ‡§¶‡§¨‡§æ‡§è‡§Ç",
                conditions: "‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø‡§Ø‡§æ‡§Ç",
                type_condition: "‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§è‡§Ç‡§ü‡§∞ ‡§¶‡§¨‡§æ‡§è‡§Ç",
                medications: "‡§¶‡§µ‡§æ‡§è‡§Ç",
                type_medication: "‡§¶‡§µ‡§æ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§è‡§Ç‡§ü‡§∞ ‡§¶‡§¨‡§æ‡§è‡§Ç",
                triage_priority: "‡§ü‡•ç‡§∞‡§æ‡§á‡§è‡§ú ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ",
                auto: "‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§",
                not_assessed: "‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§® ‡§®‡§π‡•Ä‡§Ç",
                disclaimer: "‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§∞‡§£:",
                disclaimer_text: "MYQER ‡§®‡§ø‡§¶‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ ‡§Ø‡§æ ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§∏‡§≤‡§æ‡§π ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§ ‡§Ø‡§π ‡§ü‡•ç‡§∞‡§æ‡§á‡§è‡§ú ‡§≤‡•á‡§¨‡§≤ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§î‡§∞ ‡§ï‡•á‡§µ‡§≤ ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ï‡§∞‡•ç‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•à‡•§",
                danger_zone: "‡§ñ‡§§‡§∞‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞",
                delete_warning: "‡§Ø‡§π ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡•Ä ‡§ú‡§æ ‡§∏‡§ï‡§§‡•Ä‡•§ ‡§Ø‡§π ‡§Ü‡§™‡§ï‡•á ‡§ñ‡§æ‡§§‡•á ‡§î‡§∞ ‡§∏‡§≠‡•Ä ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§°‡•á‡§ü‡§æ ‡§ï‡•ã ‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§π‡§ü‡§æ ‡§¶‡•á‡§ó‡§æ‡•§",
                delete_account: "‡§ñ‡§æ‡§§‡§æ ‡§π‡§ü‡§æ‡§è‡§Ç"
            },
            ar: {
                dashboard_title: "ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ MYQER",
                profile_completion: "ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä",
                complete_for_qr: "ÿ£ŸÉŸÖŸÑ ŸÑŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ QR",
                not_generated: "ÿ∫Ÿäÿ± ŸÖŸèŸÜÿ¥ÿ£",
                no_qr_yet: "ŸÑŸÖ Ÿäÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿ±ŸÖÿ≤ QR",
                emergency_qr: "ÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ Ÿà QR",
                qr_desc: "ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑŸàÿµŸàŸÑ ÿßŸÑÿ∑ÿßÿ±ÿ¶ ÿßŸÑŸÅŸàÿ±Ÿä",
                generate_code: "ÿ•ŸÜÿ¥ÿßÿ° ÿ±ŸÖÿ≤ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶",
                code_permanent: "ÿ±ŸÖÿ≤ŸÉ ŸÑÿß Ÿäÿ™ÿ∫Ÿäÿ± ÿ£ÿ®ÿØÿßŸã ‚Äî ŸÖŸÑŸÅŸÉ ÿßŸÑÿ¥ÿÆÿµŸä Ÿäÿ™ÿ≠ÿØÿ´ ÿÆŸÑŸÅŸá.",
                scan_access: "ÿßŸÖÿ≥ÿ≠ ŸÑŸÑŸàÿµŸàŸÑ ÿßŸÑÿ∑ÿßÿ±ÿ¶",
                manual_entry: "ÿßŸÑÿ•ÿØÿÆÿßŸÑ ÿßŸÑŸäÿØŸàŸä: ÿßŸÉÿ™ÿ® ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿ£ÿπŸÑÿßŸá ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑ ŸÖÿ≥ÿ≠ QR",
                copy: "ŸÜÿ≥ÿÆ",
                png_download: "PNG",
                svg_download: "SVG",
                print_card: "ÿ∑ÿ®ÿßÿπÿ©",
                voice_summary: "ŸÖŸÑÿÆÿµ ÿµŸàÿ™Ÿä",
                offline_mode: "Ÿàÿ∂ÿπ ÿπÿØŸÖ ÿßŸÑÿßÿ™ÿµÿßŸÑ",
                privacy_disclaimer: "ŸäŸàŸÅÿ± Ÿáÿ∞ÿß ÿßŸÑŸÄ QR ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ∑Ÿàÿßÿ±ÿ¶ ŸÑŸÑŸÇÿ±ÿßÿ°ÿ© ŸÅŸÇÿ∑. ÿ™ÿ®ŸÇŸâ ÿ®ŸäÿßŸÜÿßÿ™ŸÉ ÿÆÿßÿµÿ© ŸÖÿß ŸÑŸÖ ÿ™ÿÆÿ™ÿ± ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©.",
                gdpr_hipaa: "ŸÖÿ™ŸàÿßŸÅŸÇ ŸÖÿπ GDPR Ÿà HIPAA. ÿßŸÑŸàÿµŸàŸÑ ÿßŸÑÿ∑ÿßÿ±ÿ¶ ŸÅŸÇÿ∑.",
                sign_out: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
                identity_ice: "ÿßŸÑŸáŸàŸäÿ© Ÿàÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿßŸÑÿ∑ÿßÿ±ÿ¶ÿ©",
                identity_desc: "ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ¥ÿÆÿµŸäÿ© Ÿàÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿßŸÑÿ∑ÿßÿ±ÿ¶ÿ©",
                full_name: "ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ",
                enter_full_name: "ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖŸÉ ÿßŸÑŸÉÿßŸÖŸÑ",
                date_of_birth: "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÖŸäŸÑÿßÿØ",
                country: "ÿßŸÑÿ®ŸÑÿØ",
                select_country: "ÿßÿÆÿ™ÿ± ÿßŸÑÿ®ŸÑÿØ",
                health_id: "ÿßŸÑŸáŸàŸäÿ© ÿßŸÑÿµÿ≠Ÿäÿ© ÿßŸÑŸàÿ∑ŸÜŸäÿ©",
                enter_health_id: "ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑŸáŸàŸäÿ© ÿßŸÑÿµÿ≠Ÿäÿ©",
                ice_contacts: "ÿ¨Ÿáÿßÿ™ ÿßÿ™ÿµÿßŸÑ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶",
                ice_desc: "ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶",
                add_contact: "+ ÿ•ÿ∂ÿßŸÅÿ© ÿ¨Ÿáÿ© ÿßÿ™ÿµÿßŸÑ",
                health_info: "ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿµÿ≠Ÿäÿ©",
                health_desc: "ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ÿ®Ÿäÿ© ŸàÿßŸÑÿ≠ÿßŸÑÿßÿ™",
                blood_type: "ŸÅÿµŸäŸÑÿ© ÿßŸÑÿØŸÖ",
                select_blood_type: "ÿßÿÆÿ™ÿ± ŸÅÿµŸäŸÑÿ© ÿßŸÑÿØŸÖ",
                organ_donor: "ŸÖÿ™ÿ®ÿ±ÿπ ÿ®ÿßŸÑÿ£ÿπÿ∂ÿßÿ°",
                unspecified: "ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ",
                yes: "ŸÜÿπŸÖ",
                no: "ŸÑÿß",
                life_support: "ÿ™ŸÅÿ∂ŸäŸÑ ÿØÿπŸÖ ÿßŸÑÿ≠Ÿäÿßÿ©",
                select_preference: "ÿßÿÆÿ™ÿ± ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑ",
                full_support: "ÿØÿπŸÖ ŸÉÿßŸÖŸÑ",
                limited_support: "ÿØÿπŸÖ ŸÖÿ≠ÿØŸàÿØ",
                comfort_care: "ÿ±ÿπÿßŸäÿ© ŸÖÿ±Ÿäÿ≠ÿ© ŸÅŸÇÿ∑",
                dnr: "ÿπÿØŸÖ ÿßŸÑÿ•ŸÜÿπÿßÿ¥",
                allergies: "ÿßŸÑÿ≠ÿ≥ÿßÿ≥Ÿäÿ©",
                type_allergy: "ÿßŸÉÿ™ÿ® ÿßŸÑÿ≠ÿ≥ÿßÿ≥Ÿäÿ© Ÿàÿßÿ∂ÿ∫ÿ∑ ÿ•ÿØÿÆÿßŸÑ",
                conditions: "ÿßŸÑÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿ∑ÿ®Ÿäÿ©",
                type_condition: "ÿßŸÉÿ™ÿ® ÿßŸÑÿ≠ÿßŸÑÿ© Ÿàÿßÿ∂ÿ∫ÿ∑ ÿ•ÿØÿÆÿßŸÑ",
                medications: "ÿßŸÑÿ£ÿØŸàŸäÿ©",
                type_medication: "ÿßŸÉÿ™ÿ® ÿßŸÑÿØŸàÿßÿ° Ÿàÿßÿ∂ÿ∫ÿ∑ ÿ•ÿØÿÆÿßŸÑ",
                triage_priority: "ÿ£ŸàŸÑŸàŸäÿ© ÿßŸÑŸÅÿ±ÿ≤",
                auto: "ÿ™ŸÑŸÇÿßÿ¶Ÿä",
                not_assessed: "ÿ∫Ÿäÿ± ŸÖŸÇŸäŸÖ",
                disclaimer: "ÿ•ÿÆŸÑÿßÿ° ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäÿ©:",
                disclaimer_text: "MYQER ŸÑÿß Ÿäÿ¥ÿÆÿµ ÿ£Ÿà ŸäŸÇÿØŸÖ ŸÜÿµÿßÿ¶ÿ≠ ÿ∑ÿ®Ÿäÿ©. Ÿáÿ∞Ÿá ÿßŸÑÿ™ÿ≥ŸÖŸäÿ© ŸÑŸÑŸÅÿ±ÿ≤ ŸÖŸÇÿØŸÖÿ© ŸÖŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸàŸÖÿ≥ÿßÿπÿØÿ© ŸÅŸÇÿ∑ ŸÑŸÑŸÖÿ≥ÿ™ÿ¨Ÿäÿ®ŸäŸÜ.",
                danger_zone: "ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿÆÿ∑ÿ±",
                delete_warning: "ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°. ÿ≥Ÿäÿ§ÿØŸä Ÿáÿ∞ÿß ÿ•ŸÑŸâ ÿ≠ÿ∞ŸÅ ÿ≠ÿ≥ÿßÿ®ŸÉ Ÿàÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ© ŸÜŸáÿßÿ¶ŸäÿßŸã.",
                delete_account: "ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≠ÿ≥ÿßÿ®"
            },
            zh: {
                dashboard_title: "MYQER ‰ª™Ë°®Êùø",
                profile_completion: "‰∏™‰∫∫ËµÑÊñôÁä∂ÊÄÅ",
                complete_for_qr: "ÂÆåÊàê‰ª•Ëé∑Âèñ‰∫åÁª¥Á†ÅËÆøÈóÆ",
                not_generated: "Êú™ÁîüÊàê",
                no_qr_yet: "Êú™ÁîüÊàê‰∫åÁª¥Á†Å",
                emergency_qr: "Á¥ßÊÄ•Âç°ÁâáÂíå‰∫åÁª¥Á†Å",
                qr_desc: "Âç≥Êó∂Á¥ßÊÄ•ËÆøÈóÆÈó®Êà∑",
                generate_code: "ÁîüÊàêÁ¥ßÊÄ•‰ª£Á†Å",
                code_permanent: "ÊÇ®ÁöÑ‰ª£Á†ÅÊ∞∏‰∏çÊõ¥Êîπ ‚Äî ÊÇ®ÁöÑ‰∏™‰∫∫ËµÑÊñôÂú®ÂÖ∂ÂêéÊõ¥Êñ∞„ÄÇ",
                scan_access: "Êâ´Êèè‰ª•Ëé∑ÂèñÁ¥ßÊÄ•ËÆøÈóÆ",
                manual_entry: "ÊâãÂä®ËæìÂÖ•ÔºöÂ¶ÇÊûú‰∫åÁª¥Á†ÅÊâ´ÊèèÂ§±Ë¥•ÔºåËØ∑Âú®‰∏äÊñπËæìÂÖ•ÁΩëÂùÄ",
                copy: "Â§çÂà∂",
                png_download: "PNG",
                svg_download: "SVG",
                print_card: "ÊâìÂç∞",
                voice_summary: "ËØ≠Èü≥ÊëòË¶Å",
                offline_mode: "Á¶ªÁ∫øÊ®°Âºè",
                privacy_disclaimer: "Ê≠§‰∫åÁª¥Á†ÅÊèê‰æõÂè™ËØªÁöÑÁ¥ßÊÄ•‰ø°ÊÅØ„ÄÇÈô§ÈùûÊÇ®ÈÄâÊã©ÂàÜ‰∫´ÔºåÂê¶ÂàôÊÇ®ÁöÑÊï∞ÊçÆ‰øùÊåÅÁßÅÂØÜ„ÄÇ",
                gdpr_hipaa: "Á¨¶ÂêàGDPRÂíåHIPAA„ÄÇ‰ªÖÈôêÁ¥ßÊÄ•ËÆøÈóÆ„ÄÇ",
                sign_out: "ÈÄÄÂá∫ÁôªÂΩï",
                identity_ice: "Ë∫´‰ªΩÂíåÁ¥ßÊÄ•ËÅîÁ≥ª‰∫∫",
                identity_desc: "‰∏™‰∫∫‰ø°ÊÅØÂíåÁ¥ßÊÄ•ËÅîÁ≥ª‰∫∫",
                full_name: "ÂÖ®Âêç",
                enter_full_name: "ËæìÂÖ•ÊÇ®ÁöÑÂÖ®Âêç",
                date_of_birth: "Âá∫ÁîüÊó•Êúü",
                country: "ÂõΩÂÆ∂",
                select_country: "ÈÄâÊã©ÂõΩÂÆ∂",
                health_id: "ÂõΩÊ∞ëÂÅ•Â∫∑ID",
                enter_health_id: "ËæìÂÖ•ÂÅ•Â∫∑IDÂè∑Á†Å",
                ice_contacts: "Á¥ßÊÄ•ËÅîÁ≥ª‰∫∫",
                ice_desc: "Á¥ßÊÄ•ÊÉÖÂÜµ‰∏ã",
                add_contact: "+ Ê∑ªÂä†ËÅîÁ≥ª‰∫∫",
                health_info: "ÂÅ•Â∫∑‰ø°ÊÅØ",
                health_desc: "ÂåªÁñóËØ¶ÊÉÖÂíåÁä∂ÂÜµ",
                blood_type: "Ë°ÄÂûã",
                select_blood_type: "ÈÄâÊã©Ë°ÄÂûã",
                organ_donor: "Âô®ÂÆòÊçêÁåÆËÄÖ",
                unspecified: "Êú™ÊåáÂÆö",
                yes: "ÊòØ",
                no: "Âê¶",
                life_support: "ÁîüÂëΩÊîØÊåÅÂÅèÂ•Ω",
                select_preference: "ÈÄâÊã©ÂÅèÂ•Ω",
                full_support: "ÂÆåÂÖ®ÊîØÊåÅ",
                limited_support: "ÊúâÈôêÊîØÊåÅ",
                comfort_care: "‰ªÖËàíÈÄÇÊä§ÁêÜ",
                dnr: "‰∏çË¶ÅÂ§çËãè",
                allergies: "ËøáÊïè",
                type_allergy: "ËæìÂÖ•ËøáÊïèÂπ∂ÊåâÂõûËΩ¶",
                conditions: "ÁñæÁóÖÁä∂ÂÜµ",
                type_condition: "ËæìÂÖ•Áä∂ÂÜµÂπ∂ÊåâÂõûËΩ¶",
                medications: "ËçØÁâ©",
                type_medication: "ËæìÂÖ•ËçØÁâ©Âπ∂ÊåâÂõûËΩ¶",
                triage_priority: "ÂàÜËØä‰ºòÂÖàÁ∫ß",
                auto: "Ëá™Âä®",
                not_assessed: "Êú™ËØÑ‰º∞",
                disclaimer: "ÂÖçË¥£Â£∞ÊòéÔºö",
                disclaimer_text: "MYQER‰∏çËøõË°åËØäÊñ≠ÊàñÊèê‰æõÂåªÁñóÂª∫ËÆÆ„ÄÇÊ≠§ÂàÜËØäÊ†áÁ≠æÁî±Áî®Êà∑Êèê‰æõÔºå‰ªÖ‰æõÊÄ•Êïë‰∫∫ÂëòÂèÇËÄÉ„ÄÇ",
                danger_zone: "Âç±Èô©Âå∫Âüü",
                delete_warning: "Ê≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇËøôÂ∞ÜÊ∞∏‰πÖÂà†Èô§ÊÇ®ÁöÑË¥¶Êà∑ÂíåÊâÄÊúâÁõ∏ÂÖ≥Êï∞ÊçÆ„ÄÇ",
                delete_account: "Âà†Èô§Ë¥¶Êà∑"
            },
            hu: {
                dashboard_title: "MYQER Ir√°ny√≠t√≥pult",
                profile_completion: "Profil √Ållapot",
                complete_for_qr: "Fejezze be a QR hozz√°f√©r√©shez",
                not_generated: "Nem Gener√°lt",
                no_qr_yet: "Nincs QR k√≥d gener√°lva",
                emergency_qr: "V√©szhelyzeti K√°rtya √©s QR",
                qr_desc: "Azonnali v√©szhelyzeti hozz√°f√©r√©si port√°l",
                generate_code: "V√©szhelyzeti K√≥d Gener√°l√°sa",
                code_permanent: "A k√≥dja soha nem v√°ltozik ‚Äî a profilja m√∂g√∂tte friss√ºl.",
                scan_access: "Szkennel√©s v√©szhelyzeti hozz√°f√©r√©shez",
                manual_entry: "K√©zi bevitel: √çrja be a fenti URL-t, ha a QR szkennel√©s sikertelen",
                copy: "M√°sol√°s",
                png_download: "PNG",
                svg_download: "SVG",
                print_card: "Nyomtat√°s",
                voice_summary: "Hang √ñsszefoglal√≥",
                offline_mode: "Offline M√≥d",
                privacy_disclaimer: "Ez a QR csak olvashat√≥, v√©szhelyzeti inform√°ci√≥kat biztos√≠t. Az adatai priv√°tak maradnak, hacsak nem v√°lasztja a megoszt√°st.",
                gdpr_hipaa: "GDPR √©s HIPAA megfelel≈ë. Csak v√©szhelyzeti hozz√°f√©r√©s.",
                sign_out: "Kijelentkez√©s",
                identity_ice: "Szem√©lyazonoss√°g √©s V√©szhelyzeti Kapcsolatok",
                identity_desc: "Szem√©lyes inform√°ci√≥k √©s v√©szhelyzeti kapcsolatok",
                full_name: "Teljes N√©v",
                enter_full_name: "Adja meg teljes nev√©t",
                date_of_birth: "Sz√ºlet√©si D√°tum",
                country: "Orsz√°g",
                select_country: "V√°lasszon Orsz√°got",
                health_id: "Nemzeti Eg√©szs√©g√ºgyi Azonos√≠t√≥",
                enter_health_id: "Adja meg az eg√©szs√©g√ºgyi azonos√≠t√≥ sz√°mot",
                ice_contacts: "ICE Kapcsolatok",
                ice_desc: "V√©szhelyzet Eset√©n",
                add_contact: "+ Kapcsolat Hozz√°ad√°sa",
                health_info: "Eg√©szs√©g√ºgyi Inform√°ci√≥k",
                health_desc: "Orvosi r√©szletek √©s √°llapotok",
                blood_type: "V√©rcsoport",
                select_blood_type: "V√°lasszon V√©rcsoportot",
                organ_donor: "Szervdonor",
                unspecified: "Nem Meghat√°rozott",
                yes: "Igen",
                no: "Nem",
                life_support: "√âletfenntart√≥ Preferencia",
                select_preference: "V√°lasszon Preferenci√°t",
                full_support: "Teljes T√°mogat√°s",
                limited_support: "Korl√°tozott T√°mogat√°s",
                comfort_care: "Csak Palliat√≠v Gondoz√°s",
                dnr: "Ne √âleszd √öjra",
                allergies: "Allergi√°k",
                type_allergy: "√çrja be az allergi√°t √©s nyomja meg az Entert",
                conditions: "Eg√©szs√©g√ºgyi √Ållapotok",
                type_condition: "√çrja be az √°llapotot √©s nyomja meg az Entert",
                medications: "Gy√≥gyszerek",
                type_medication: "√çrja be a gy√≥gyszert √©s nyomja meg az Entert",
                triage_priority: "Tri√°zs Priorit√°s",
                auto: "Automatikus",
                not_assessed: "Nem √ârt√©kelt",
                disclaimer: "Jogi Nyilatkozat:",
                disclaimer_text: "A MYQER nem diagnosztiz√°l √©s nem ny√∫jt orvosi tan√°csot. Ez a tri√°zs c√≠mke felhaszn√°l√≥ √°ltal megadott √©s csak seg√≠t≈ë a ment≈ës√∂knek.",
                danger_zone: "Vesz√©lyz√≥na",
                delete_warning: "Ez a m≈±velet nem vonhat√≥ vissza. Ez v√©glegesen t√∂rli fi√≥kj√°t √©s minden kapcsol√≥d√≥ adatot.",
                delete_account: "Fi√≥k T√∂rl√©se"
            },
            ro: {
                dashboard_title: "Tablou de Bord MYQER",
                profile_completion: "Starea Profilului",
                complete_for_qr: "Completa»õi pentru accesul QR",
                not_generated: "Negenerat",
                no_qr_yet: "Niciun cod QR generat",
                emergency_qr: "Cardul de Urgen»õƒÉ »ôi QR",
                qr_desc: "Portal de acces de urgen»õƒÉ instantaneu",
                generate_code: "Genera»õi Cod de Urgen»õƒÉ",
                code_permanent: "Codul dvs. nu se schimbƒÉ niciodatƒÉ ‚Äî profilul se actualizeazƒÉ √Æn spatele lui.",
                scan_access: "Scana»õi pentru acces de urgen»õƒÉ",
                manual_entry: "Introducere manualƒÉ: Tasta»õi URL-ul de mai sus dacƒÉ scanarea QR e»ôueazƒÉ",
                copy: "Copia»õi",
                png_download: "PNG",
                svg_download: "SVG",
                print_card: "Imprima»õi",
                voice_summary: "Rezumat Vocal",
                offline_mode: "Mod Offline",
                privacy_disclaimer: "Acest QR oferƒÉ informa»õii de urgen»õƒÉ doar pentru citire. Datele dvs. rƒÉm√¢n private dec√¢t dacƒÉ alege»õi sƒÉ le partaja»õi.",
                gdpr_hipaa: "Conform GDPR »ôi HIPAA. Doar acces de urgen»õƒÉ.",
                sign_out: "Deconectare",
                identity_ice: "Identitate »ôi Contacte de Urgen»õƒÉ",
                identity_desc: "Informa»õii personale »ôi contacte de urgen»õƒÉ",
                full_name: "Nume Complet",
                enter_full_name: "Introduce»õi numele complet",
                date_of_birth: "Data Na»ôterii",
                country: "»öara",
                select_country: "Selecta»õi »öara",
                health_id: "ID SƒÉnƒÉtate Na»õionalƒÉ",
                enter_health_id: "Introduce»õi numƒÉrul ID sƒÉnƒÉtate",
                ice_contacts: "Contacte ICE",
                ice_desc: "√én Caz de Urgen»õƒÉ",
                add_contact: "+ AdƒÉuga»õi Contact",
                health_info: "Informa»õii SƒÉnƒÉtate",
                health_desc: "Detalii medicale »ôi condi»õii",
                blood_type: "Grupa SanguinƒÉ",
                select_blood_type: "Selecta»õi Grupa SanguinƒÉ",
                organ_donor: "Donator de Organe",
                unspecified: "Nespecificat",
                yes: "Da",
                no: "Nu",
                life_support: "Preferin»õa Suport Vital",
                select_preference: "Selecta»õi Preferin»õa",
                full_support: "Suport Complet",
                limited_support: "Suport Limitat",
                comfort_care: "Doar √éngrijire PaliativƒÉ",
                dnr: "Nu Resuscita",
                allergies: "Alergii",
                type_allergy: "Tasta»õi alergia »ôi apƒÉsa»õi Enter",
                conditions: "Condi»õii Medicale",
                type_condition: "Tasta»õi condi»õia »ôi apƒÉsa»õi Enter",
                medications: "Medicamente",
                type_medication: "Tasta»õi medicamentul »ôi apƒÉsa»õi Enter",
                triage_priority: "Prioritate Triaj",
                auto: "Automat",
                not_assessed: "Neevaluat",
                disclaimer: "Declinarea ResponsabilitƒÉ»õii:",
                disclaimer_text: "MYQER nu diagnosticheazƒÉ »ôi nu oferƒÉ sfaturi medicale. AceastƒÉ etichetƒÉ de triaj este furnizatƒÉ de utilizator »ôi este doar de asisten»õƒÉ pentru salvatori.",
                danger_zone: "Zona de Pericol",
                delete_warning: "AceastƒÉ ac»õiune nu poate fi anulatƒÉ. Aceasta va »ôterge permanent contul dvs. »ôi toate datele asociate.",
                delete_account: "»òterge»õi Contul"
            }
        };

        // Language Management
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('myqer_language', lang);
            
            // Set RTL for Arabic
            if (lang === 'ar') {
                document.documentElement.setAttribute('dir', 'rtl');
                document.documentElement.setAttribute('lang', 'ar');
            } else {
                document.documentElement.setAttribute('dir', 'ltr');
                document.documentElement.setAttribute('lang', lang);
            }
            
            // Update all translatable elements
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // Update placeholders
            const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (translations[lang] && translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });
        }

        // Toast System
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const colors = {
                success: 'bg-gradient-to-r from-green-500 to-green-600',
                error: 'bg-gradient-to-r from-red-500 to-red-600',
                info: 'bg-gradient-to-r from-blue-500 to-blue-600',
                warning: 'bg-gradient-to-r from-amber-500 to-amber-600'
            };
            
            toast.className = `${colors[type]} text-white px-6 py-4 rounded-2xl shadow-2xl transform transition-all duration-500 translate-x-full opacity-0 font-semibold`;
            toast.textContent = message;
            
            document.getElementById('toast-container').appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
            }, 100);
            
            setTimeout(() => {
                toast.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => toast.remove(), 500);
            }, 4000);
        }

        // Offline Detection
        function checkOnlineStatus() {
            isOffline = !navigator.onLine;
            const indicator = document.getElementById('offline-indicator');
            
            if (isOffline) {
                indicator.classList.remove('hidden');
                loadCachedQR();
            } else {
                indicator.classList.add('hidden');
            }
        }

        function loadCachedQR() {
            const cachedQR = localStorage.getItem('myqer_qr_cache');
            const cachedCode = localStorage.getItem('myqer_qr_code');
            const cachedURL = localStorage.getItem('myqer_qr_url');
            
            if (cachedQR && cachedCode && cachedURL) {
                const canvas = document.getElementById('qr-canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    // Show cached QR
                    document.getElementById('qr-placeholder').classList.add('hidden');
                    document.getElementById('qr-display-area').classList.remove('hidden');
                    document.getElementById('generate-qr-btn').classList.add('hidden');
                    document.getElementById('code-permanent').classList.remove('hidden');
                    document.getElementById('qr-info').classList.remove('hidden');
                    document.getElementById('action-buttons').classList.remove('hidden');
                    document.getElementById('voice-summary').classList.remove('hidden');
                    
                    // Update info
                    document.getElementById('short-code').textContent = `MYQER-${cachedCode}`;
                    document.getElementById('share-link').value = cachedURL;
                    
                    // Update status badge
                    const badge = document.getElementById('qr-status-badge');
                    badge.className = 'px-3 py-1 rounded-lg text-xs font-semibold bg-amber-100 text-amber-700';
                    badge.innerHTML = '<span>Cached</span>';
                };
                
                img.src = cachedQR;
            }
        }

        // Session Management
        async function checkSession() {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                location.href = '/index.html';
                return;
            }
            currentUser = session.user;
            await loadUserData();
            await loadAll();
        }

        async function signOut() {
            try { 
                await sb.auth.signOut(); 
                location.replace('/'); 
            } catch(_) {
                location.href = '/index.html';
            }
        }

        // Enhanced ICE Contact Management
        function debounce(func, wait = 500) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Auto-save ICE on blur with debouncing
        function setupICEAutoSave() {
            const iceWrap = document.getElementById('contacts-list');
            if (!iceWrap) return;

            iceWrap.addEventListener('focusout', debounce(async () => {
                const rows = [...iceWrap.querySelectorAll('.ice-contact-card')].map(card => {
                    const inputs = card.querySelectorAll('input');
                    return {
                        name: inputs[0]?.value?.trim() || '',
                        relationship: inputs[1]?.value?.trim() || '',
                        phone: inputs[2]?.value?.trim() || ''
                    };
                }).filter(contact => contact.name || contact.phone);

                try {
                    // Clear existing contacts
                    await sb.from('ice_contacts').delete().eq('user_id', currentUser.id);
                    
                    // Insert new contacts
                    if (rows.length > 0) {
                        const contactsToInsert = rows.map(contact => ({
                            user_id: currentUser.id,
                            ...contact
                        }));
                        await sb.from('ice_contacts').insert(contactsToInsert);
                    }
                    
                    showToast('ICE contacts saved', 'success');
                } catch (error) {
                    showToast('Failed to save ICE contacts', 'error');
                    console.error('ICE save error:', error);
                }
            }, 1000));
        }

        // Debounced Save
        function debouncedSave(field, value, table = 'profiles') {
            clearTimeout(debounceTimers[field]);
            debounceTimers[field] = setTimeout(async () => {
                await saveField(field, value, table);
            }, 700);
        }

        async function saveField(field, value, table) {
            try {
                if (table === 'profiles') {
                    const { error } = await supabase
                        .from('profiles')
                        .upsert({ 
                            id: currentUser.id, 
                            email: currentUser.email,
                            [field]: value,
                            updated_at: new Date().toISOString()
                        });
                    if (error) throw error;
                } else if (table === 'health_profiles') {
                    const { error } = await supabase
                        .from('health_profiles')
                        .upsert({ 
                            user_id: currentUser.id, 
                            [field]: value 
                        });
                    if (error) throw error;
                }
                updateCompletion();
                
                // Re-render QR if profile changes and QR exists
                const { data: profile } = await supabase
                    .from('profiles')
                    .select('code')
                    .eq('id', currentUser.id)
                    .single();
                
                if (profile && profile.code && !document.getElementById('qr-display-area').classList.contains('hidden')) {
                    showQRCode(profile.code);
                }
                
                showToast('Saved successfully', 'success');
            } catch (error) {
                showToast('Save failed: ' + error.message, 'error');
            }
        }

        // Load User Data
        async function loadUserData() {
            try {
                // Load profile
                const { data: profile } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();

                if (profile) {
                    document.getElementById('full_name').value = profile.full_name || '';
                    document.getElementById('date_of_birth').value = profile.date_of_birth || '';
                    document.getElementById('country').value = profile.country || '';
                    document.getElementById('national_health_id').value = profile.national_health_id || '';
                    
                    if (profile.code) {
                        showQRCode(profile.code);
                    }
                }

                // Load health profile
                const { data: health } = await supabase
                    .from('health_profiles')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .single();

                if (health) {
                    document.getElementById('blood_type').value = health.blood_type || '';
                    document.getElementById('organ_donor').value = health.organ_donor || '';
                    document.getElementById('life_support_pref').value = health.life_support_pref || '';
                    document.getElementById('triage_override').value = health.triage_override || 'Auto';
                    
                    allergies = health.allergies ? health.allergies.split(',').filter(a => a.trim()) : [];
                    conditions = health.conditions ? health.conditions.split(',').filter(c => c.trim()) : [];
                    medications = health.medications ? health.medications.split(',').filter(m => m.trim()) : [];
                    
                    renderPills();
                    updateTriageBadge();
                }

                // Load ICE contacts
                const { data: contactsData } = await supabase
                    .from('ice_contacts')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at');

                contacts = contactsData || [];
                renderContacts();
                updateCompletion();
            } catch (error) {
                showToast('Failed to load data: ' + error.message, 'error');
            }
        }

        // Pills Management
        function renderPills() {
            renderPillGroup('allergies', allergies);
            renderPillGroup('conditions', conditions);
            renderPillGroup('medications', medications);
        }

        function renderPillGroup(type, items) {
            const container = document.getElementById(`${type}-pills`);
            const colors = {
                allergies: 'bg-red-100 text-red-800 border-red-200',
                conditions: 'bg-orange-100 text-orange-800 border-orange-200',
                medications: 'bg-blue-100 text-blue-800 border-blue-200'
            };
            
            container.innerHTML = items.map(item => 
                `<span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold border-2 ${colors[type]} shadow-sm">
                    ${item}
                    <button onclick="removePill('${type}', '${item}')" class="ml-3 text-current hover:text-red-600 font-bold text-lg transition-colors">√ó</button>
                </span>`
            ).join('');
        }

        function addPill(type, value) {
            if (!value.trim()) return;
            
            const items = type === 'allergies' ? allergies : 
                         type === 'conditions' ? conditions : medications;
            
            if (!items.includes(value.trim())) {
                items.push(value.trim());
                renderPills();
                savePills();
                updateTriageBadge();
            }
        }

        function removePill(type, value) {
            const items = type === 'allergies' ? allergies : 
                         type === 'conditions' ? conditions : medications;
            
            const index = items.indexOf(value);
            if (index > -1) {
                items.splice(index, 1);
                renderPills();
                savePills();
                updateTriageBadge();
            }
        }

        async function savePills() {
            try {
                const { error } = await supabase
                    .from('health_profiles')
                    .upsert({
                        user_id: currentUser.id,
                        allergies: allergies.join(','),
                        conditions: conditions.join(','),
                        medications: medications.join(',')
                    });
                if (error) throw error;
                updateCompletion();
            } catch (error) {
                showToast('Failed to save: ' + error.message, 'error');
            }
        }

        // Triage Badge
        function updateTriageBadge() {
            const override = document.getElementById('triage_override').value;
            let priority = 'Green';
            let color = 'bg-green-100 text-green-800 border-green-300';
            let dotColor = 'bg-green-500';

            if (override !== 'Auto') {
                priority = override;
            } else {
                // Auto calculation
                const lifeSupportPref = document.getElementById('life_support_pref').value;
                
                if (lifeSupportPref === 'DNR') {
                    priority = 'Black';
                } else {
                    const criticalAllergies = ['anaphylaxis', 'epipen', 'penicillin', 'peanut', 'shellfish'];
                    const criticalConditions = ['heart', 'stroke', 'seizure', 'cancer'];
                    
                    const hasCriticalAllergy = allergies.some(a => 
                        criticalAllergies.some(ca => a.toLowerCase().includes(ca))
                    );
                    const hasCriticalCondition = conditions.some(c => 
                        criticalConditions.some(cc => c.toLowerCase().includes(cc))
                    );
                    const hasMultipleIssues = (conditions.length + medications.length) >= 3;
                    
                    if (hasCriticalAllergy || hasCriticalCondition || hasMultipleIssues) {
                        priority = 'Red';
                    } else if (allergies.length > 0 || conditions.length > 0 || medications.length > 0) {
                        priority = 'Amber';
                    }
                }
            }

            // Set colors
            switch (priority) {
                case 'Black':
                    color = 'bg-gray-800 text-white border-gray-600';
                    dotColor = 'bg-gray-600';
                    break;
                case 'Red':
                    color = 'bg-red-100 text-red-800 border-red-300';
                    dotColor = 'bg-red-500';
                    break;
                case 'Amber':
                    color = 'bg-amber-100 text-amber-800 border-amber-300';
                    dotColor = 'bg-amber-500';
                    break;
                default:
                    color = 'bg-green-100 text-green-800 border-green-300';
                    dotColor = 'bg-green-500';
            }

            document.getElementById('triage-badge').className = 
                `inline-flex items-center px-4 py-2 rounded-full text-sm font-bold border-2 ${color} shadow-lg`;
            document.getElementById('triage-badge').innerHTML = 
                `<span class="w-3 h-3 rounded-full mr-3 ${dotColor}"></span>${priority}`;
        }

        // ICE Contacts - Enhanced
        function renderContacts() {
            const container = document.getElementById('contacts-list');
            const count = document.getElementById('contact-count');
            const addBtn = document.getElementById('add-contact-btn');
            
            count.textContent = `${contacts.length} of 3`;
            addBtn.disabled = contacts.length >= 3;
            addBtn.className = contacts.length >= 3 ? 
                'bg-gray-400 text-white px-4 py-2 rounded-xl cursor-not-allowed font-semibold text-sm' :
                'medical-btn bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-xl hover:from-red-600 hover:to-red-700 font-semibold text-sm shadow-lg';

            container.innerHTML = contacts.map((contact, index) => `
                <div class="ice-contact-card rounded-2xl p-6 space-y-4">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-bold text-red-700">Contact ${index + 1}</h4>
                        <button onclick="deleteContact('${contact.id}')" 
                                class="medical-btn bg-red-600 text-white px-3 py-1 rounded-lg text-xs hover:bg-red-700 font-semibold">
                            Delete
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Name *</label>
                            <input type="text" value="${contact.name || ''}" 
                                   onblur="updateContact('${contact.id}', 'name', this.value)"
                                   class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg"
                                   placeholder="Full name">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Relationship</label>
                            <input type="text" value="${contact.relationship || ''}" 
                                   onblur="updateContact('${contact.id}', 'relationship', this.value)"
                                   class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg"
                                   placeholder="e.g., Spouse, Parent, Friend">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Phone *</label>
                            <input type="tel" value="${contact.phone || ''}" 
                                   onblur="updateContact('${contact.id}', 'phone', this.value)"
                                   class="medical-input w-full px-4 py-3 rounded-xl outline-none text-lg"
                                   placeholder="+1 (555) 123-4567">
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function addContact() {
            if (contacts.length >= 3) {
                showToast('Maximum 3 contacts allowed', 'warning');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('ice_contacts')
                    .insert({ user_id: currentUser.id })
                    .select()
                    .single();

                if (error) throw error;
                contacts.push(data);
                renderContacts();
                updateCompletion();
                showToast('Contact added successfully', 'success');
            } catch (error) {
                showToast('Failed to add contact: ' + error.message, 'error');
            }
        }

        async function updateContact(id, field, value) {
            try {
                const { error } = await supabase
                    .from('ice_contacts')
                    .update({ [field]: value })
                    .eq('id', id);

                if (error) throw error;
                
                const contact = contacts.find(c => c.id === id);
                if (contact) contact[field] = value;
                
                updateCompletion();
                showToast('Contact updated', 'success');
            } catch (error) {
                showToast('Failed to update contact: ' + error.message, 'error');
            }
        }

        async function deleteContact(id) {
            if (!confirm('Are you sure you want to delete this contact?')) return;
            
            try {
                const { error } = await supabase
                    .from('ice_contacts')
                    .delete()
                    .eq('id', id);

                if (error) throw error;
                
                contacts = contacts.filter(c => c.id !== id);
                renderContacts();
                updateCompletion();
                showToast('Contact deleted successfully', 'success');
            } catch (error) {
                showToast('Failed to delete contact: ' + error.message, 'error');
            }
        }

        // Enhanced QR Code Generation with Full Functionality
        async function generateQRCode() {
            try {
                await loadAll();
                await renderQR();
                updateCompletion();
                showToast('Emergency QR Code generated successfully!', 'success');
            } catch (error) {
                showToast('Failed to generate QR code: ' + error.message, 'error');
                console.error('QR Generation Error:', error);
            }
        }

        function showQRCode(code) {
            const url = `${location.origin}/c/${code}`;
            const canvas = document.getElementById('qr-canvas');
            
            // Enhanced QR generation with rounded corners and better error correction
            QRCode.toCanvas(canvas, url, { 
                width: 200,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#ffffff'
                },
                errorCorrectionLevel: 'H' // High error correction for logo overlay
            }, (error) => {
                if (error) {
                    showToast('Failed to generate QR code', 'error');
                    return;
                }
                
                // Cache QR code for offline use
                localStorage.setItem('myqer_qr_cache', canvas.toDataURL());
                localStorage.setItem('myqer_qr_code', code);
                localStorage.setItem('myqer_qr_url', url);
                
                // Update UI state
                document.getElementById('qr-placeholder').classList.add('hidden');
                document.getElementById('qr-display-area').classList.remove('hidden');
                document.getElementById('generate-qr-btn').classList.add('hidden');
                document.getElementById('code-permanent').classList.remove('hidden');
                document.getElementById('qr-info').classList.remove('hidden');
                document.getElementById('action-buttons').classList.remove('hidden');
                document.getElementById('voice-summary').classList.remove('hidden');
                
                // Add gentle pulse animation
                document.getElementById('qr-display-area').classList.add('qr-glow');
                setTimeout(() => {
                    document.getElementById('qr-display-area').classList.remove('qr-glow');
                }, 6000);
                
                // Update status badge
                const badge = document.getElementById('qr-status-badge');
                badge.className = 'px-3 py-1 rounded-lg text-xs font-semibold bg-green-100 text-green-700';
                badge.innerHTML = '<span>Active</span>';
                
                // Update info
                document.getElementById('short-code').textContent = `MYQER-${code}`;
                document.getElementById('share-link').value = url;
            });
        }

        function copyLink() {
            const link = document.getElementById('share-link');
            link.select();
            document.execCommand('copy');
            showToast('Emergency link copied to clipboard!', 'success');
        }

        function exportPNG() {
            const canvas = document.getElementById('qr-canvas');
            const link = document.createElement('a');
            link.download = `myqer-emergency-qr-${new Date().toISOString().split('T')[0]}.png`;
            link.href = canvas.toDataURL('image/png', 1.0);
            link.click();
            showToast('QR Code exported as PNG!', 'success');
        }

        function exportSVG() {
            // Enhanced SVG export functionality
            const code = localStorage.getItem('myqer_qr_code');
            const url = localStorage.getItem('myqer_qr_url');
            
            if (!code || !url) {
                showToast('No QR code to export', 'error');
                return;
            }

            // Generate SVG QR code
            QRCode.toString(url, { 
                type: 'svg',
                width: 200,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#ffffff'
                },
                errorCorrectionLevel: 'H'
            }, (error, svgString) => {
                if (error) {
                    showToast('Failed to export SVG', 'error');
                    return;
                }
                
                const blob = new Blob([svgString], { type: 'image/svg+xml' });
                const link = document.createElement('a');
                link.download = `myqer-emergency-qr-${new Date().toISOString().split('T')[0]}.svg`;
                link.href = URL.createObjectURL(blob);
                link.click();
                showToast('QR Code exported as SVG!', 'success');
            });
        }

        function printQR() {
            const canvas = document.getElementById('qr-canvas');
            const code = localStorage.getItem('myqer_qr_code');
            const fullName = document.getElementById('full_name').value || 'Name Not Set';
            const dob = document.getElementById('date_of_birth').value || 'DOB Not Set';
            const triageBadge = document.getElementById('triage-badge');
            const triageColor = triageBadge.querySelector('span').className;
            const triageText = triageBadge.textContent.trim();
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>MYQER‚Ñ¢ Emergency Medical Card</title>
                        <style>
                            @page { margin: 0.5in; }
                            body { 
                                text-align: center; 
                                padding: 20px; 
                                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
                                background: #f8fafc; 
                                margin: 0;
                            }
                            .card { 
                                background: white; 
                                padding: 30px; 
                                border-radius: 20px; 
                                box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
                                max-width: 400px; 
                                margin: 0 auto;
                                border: 3px solid #dc2626;
                            }
                            .header { 
                                margin-bottom: 20px; 
                                border-bottom: 2px solid #dc2626; 
                                padding-bottom: 15px;
                            }
                            h1 { 
                                color: #000; 
                                margin: 0; 
                                font-weight: 900; 
                                font-size: 2.5rem; 
                            }
                            .er { color: #dc2626; }
                            .subtitle { 
                                color: #6b7280; 
                                font-size: 0.9rem; 
                                font-style: italic; 
                                margin-top: 5px;
                            }
                            .patient-info {
                                background: #f9fafb;
                                padding: 15px;
                                border-radius: 10px;
                                margin: 20px 0;
                                text-align: left;
                            }
                            .patient-info h3 {
                                margin: 0 0 10px 0;
                                color: #374151;
                                font-size: 1.1rem;
                            }
                            .patient-info p {
                                margin: 5px 0;
                                color: #6b7280;
                                font-size: 0.9rem;
                            }
                            img { 
                                max-width: 200px; 
                                border: 3px solid #dc2626; 
                                border-radius: 12px; 
                                margin: 15px 0; 
                            }
                            .emergency { 
                                background: #fef2f2; 
                                padding: 15px; 
                                border-radius: 10px; 
                                margin: 15px 0; 
                                border: 2px solid #fecaca; 
                            }
                            .triage-badge {
                                display: inline-block;
                                padding: 8px 16px;
                                border-radius: 20px;
                                font-weight: bold;
                                font-size: 0.9rem;
                                margin: 10px 0;
                            }
                            .triage-green { background: #dcfce7; color: #166534; border: 2px solid #bbf7d0; }
                            .triage-amber { background: #fef3c7; color: #92400e; border: 2px solid #fde68a; }
                            .triage-red { background: #fee2e2; color: #991b1b; border: 2px solid #fecaca; }
                            .triage-black { background: #f3f4f6; color: #374151; border: 2px solid #d1d5db; }
                            .footer {
                                margin-top: 20px;
                                padding-top: 15px;
                                border-top: 1px solid #e5e7eb;
                                font-size: 0.8rem;
                                color: #9ca3af;
                            }
                            .code {
                                font-family: 'Courier New', monospace;
                                background: #f3f4f6;
                                padding: 8px 12px;
                                border-radius: 6px;
                                font-weight: bold;
                                color: #374151;
                                margin: 10px 0;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="card">
                            <div class="header">
                                <h1>MYQ<span class="er">ER</span>‚Ñ¢</h1>
                                <div class="subtitle">Emergency Medical Profile</div>
                            </div>
                            
                            <div class="patient-info">
                                <h3>Patient Information</h3>
                                <p><strong>Name:</strong> ${fullName}</p>
                                <p><strong>DOB:</strong> ${dob}</p>
                                <div class="code">Code: MYQER-${code}</div>
                            </div>
                            
                            <img src="${canvas.toDataURL()}" alt="MYQER Emergency QR Code">
                            
                            <div class="triage-badge triage-${triageText.toLowerCase()}">
                                Triage: ${triageText}
                            </div>
                            
                            <div class="emergency">
                                <p><strong>üì± SCAN FOR EMERGENCY ACCESS</strong></p>
                                <p>This QR code provides immediate access to critical medical information for emergency responders.</p>
                            </div>
                            
                            <div class="footer">
                                <p>MYQER‚Ñ¢ Emergency Medical System</p>
                                <p>GDPR & HIPAA Compliant ‚Ä¢ Emergency Access Only</p>
                                <p>Generated: ${new Date().toLocaleDateString()}</p>
                            </div>
                        </div>
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
            showToast('Emergency medical card ready to print!', 'success');
        }

        // Voice Summary for Responders
        function playVoiceSummary() {
            if (!('speechSynthesis' in window)) {
                showToast('Voice synthesis not supported in this browser', 'error');
                return;
            }

            const fullName = document.getElementById('full_name').value || 'Name not provided';
            const dob = document.getElementById('date_of_birth').value || 'Date of birth not provided';
            const bloodType = document.getElementById('blood_type').value || 'Blood type not specified';
            const triageText = document.getElementById('triage-badge').textContent.trim();
            
            const allergyText = allergies.length > 0 ? `Allergies: ${allergies.join(', ')}` : 'No known allergies';
            const conditionText = conditions.length > 0 ? `Medical conditions: ${conditions.join(', ')}` : 'No known medical conditions';
            const medicationText = medications.length > 0 ? `Current medications: ${medications.join(', ')}` : 'No current medications';
            
            const summary = `Emergency medical summary for ${fullName}. Date of birth: ${dob}. Blood type: ${bloodType}. Triage priority: ${triageText}. ${allergyText}. ${conditionText}. ${medicationText}.`;
            
            const utterance = new SpeechSynthesisUtterance(summary);
            utterance.rate = 0.8;
            utterance.pitch = 1;
            utterance.volume = 1;
            
            // Use appropriate language
            utterance.lang = currentLanguage === 'en' ? 'en-US' : 
                            currentLanguage === 'es' ? 'es-ES' :
                            currentLanguage === 'fr' ? 'fr-FR' :
                            currentLanguage === 'de' ? 'de-DE' :
                            currentLanguage === 'it' ? 'it-IT' : 'en-US';
            
            speechSynthesis.speak(utterance);
            showToast('Playing voice summary for responders', 'info');
        }

        // Profile Completion
        function updateCompletion() {
            let completed = 0;
            
            // Identity check (25%)
            const fullName = document.getElementById('full_name').value;
            const dob = document.getElementById('date_of_birth').value;
            if (fullName && dob) completed++;
            
            // Health check (25%)
            const bloodType = document.getElementById('blood_type').value;
            if (bloodType || allergies.length > 0 || conditions.length > 0 || medications.length > 0) completed++;
            
            // Contacts check (25%)
            if (contacts.length > 0) completed++;
            
            // QR Code check (25%)
            if (!document.getElementById('qr-display-area').classList.contains('hidden')) completed++;
            
            const percentage = (completed / 4) * 100;
            const circle = document.getElementById('completion-circle');
            const text = document.getElementById('completion-text');
            
            circle.style.strokeDasharray = `${percentage}, 100`;
            text.textContent = `${Math.round(percentage)}%`;
            
            // Change color based on completion
            if (percentage === 100) {
                circle.classList.remove('text-red-600');
                circle.classList.add('text-green-500');
                text.classList.remove('text-red-600');
                text.classList.add('text-green-500');
            } else {
                circle.classList.remove('text-green-500');
                circle.classList.add('text-red-600');
                text.classList.remove('text-green-500');
                text.classList.add('text-red-600');
            }
        }

        // Delete Account
        async function deleteAccount() {
            const confirmation = prompt('Type "DELETE" to confirm account deletion:');
            if (confirmation !== 'DELETE') {
                showToast('Account deletion cancelled', 'info');
                return;
            }

            try {
                // Delete in order: contacts, health_profiles, profiles
                await supabase.from('ice_contacts').delete().eq('user_id', currentUser.id);
                await supabase.from('health_profiles').delete().eq('user_id', currentUser.id);
                await supabase.from('profiles').delete().eq('id', currentUser.id);
                
                // Clear local storage
                localStorage.removeItem('myqer_qr_cache');
                localStorage.removeItem('myqer_qr_code');
                localStorage.removeItem('myqer_qr_url');
                localStorage.removeItem('myqer_language');
                
                await supabase.auth.signOut();
                showToast('Account deleted successfully', 'success');
                setTimeout(() => location.href = '/index.html', 2000);
            } catch (error) {
                showToast('Failed to delete account: ' + error.message, 'error');
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved language
            const savedLanguage = localStorage.getItem('myqer_language') || 'en';
            document.getElementById('language-selector').value = savedLanguage;
            changeLanguage(savedLanguage);
            
            // Check online status
            checkOnlineStatus();
            window.addEventListener('online', checkOnlineStatus);
            window.addEventListener('offline', checkOnlineStatus);
            
            checkSession();

            // Language selector
            document.getElementById('language-selector').addEventListener('change', (e) => {
                changeLanguage(e.target.value);
            });

            // Identity fields
            ['full_name', 'date_of_birth', 'country', 'national_health_id'].forEach(field => {
                document.getElementById(field).addEventListener('input', (e) => {
                    debouncedSave(field, e.target.value);
                });
            });

            // Health fields
            ['blood_type', 'organ_donor', 'life_support_pref'].forEach(field => {
                document.getElementById(field).addEventListener('change', (e) => {
                    debouncedSave(field, e.target.value, 'health_profiles');
                    if (field === 'life_support_pref') updateTriageBadge();
                });
            });

            // Triage override
            document.getElementById('triage_override').addEventListener('change', (e) => {
                debouncedSave('triage_override', e.target.value, 'health_profiles');
                updateTriageBadge();
            });

            // Pills inputs
            ['allergies', 'conditions', 'medications'].forEach(type => {
                document.getElementById(`${type}-input`).addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        addPill(type, e.target.value);
                        e.target.value = '';
                    }
                });
            });

            // Enhanced QR Generation Button
            document.getElementById('generate-qr-btn')?.addEventListener('click', async () => {
                try { 
                    await renderQR(); 
                    showToast('Emergency code ready.', 'success'); 
                } catch(e) { 
                    showToast('Failed to generate QR code.', 'error'); 
                    console.error(e); 
                }
            });

            // Enhanced Logout Button
            document.getElementById('btnLogout')?.addEventListener('click', async () => {
                try { 
                    await sb.auth.signOut(); 
                    location.replace('/'); 
                } catch(_) {
                    location.href = '/index.html';
                }
            });

            // Setup ICE auto-save functionality
            setupICEAutoSave();
        });
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'978881d4c7ac9491',t:'MTc1Njc2ODkxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();
    </script>
</body>
</html>
