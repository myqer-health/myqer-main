<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src  'self' 'unsafe-inline' https://cdn.jsdelivr.net https://unpkg.com;
  connect-src 'self' https://*.supabase.co https://*.supabase.io;
  img-src     'self' data: blob:;
  style-src   'self' 'unsafe-inline' https://fonts.googleapis.com;
  font-src    'self' https://fonts.gstatic.com data:;
  object-src  'none';
  base-uri    'self';
  form-action 'self';
  frame-ancestors 'self';
  child-src 'self' blob:;
  worker-src 'self' blob:;
">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MYQER™ Dashboard — Your Emergency Profile</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Supabase + QR -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

  <!-- App -->
  <script defer src="/scripts/app.js?v=11"></script>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --red:#DC2626; --green:#059669; --orange:#EA580C; --ink:#0F172A; --slate:#475569; --light-slate:#94A3B8;
      --bg:linear-gradient(135deg,#F8FAFC 0%,#F1F5F9 100%); --white:#fff; --glass:rgba(255,255,255,.95);
      --border:rgba(148,163,184,.15); --shadow:0 8px 32px rgba(15,23,42,.08); --shadow-lg:0 20px 64px rgba(15,23,42,.12);
      --shadow-xl:0 32px 80px rgba(15,23,42,.15); --gradient-red:linear-gradient(135deg,#DC2626 0%,#B91C1C 100%);
      --gradient-green:linear-gradient(135deg,#059669 0%,#047857 100%); --gradient-orange:linear-gradient(135deg,#EA580C 0%,#C2410C 100%)
    }
    body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--ink);line-height:1.6;min-height:100vh}

    /* Loading */
    #loadingState{position:fixed;inset:0;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}
    .spinner{width:48px;height:48px;border:4px solid var(--border);border-top:4px solid var(--red);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:1rem}
    @keyframes spin{to{transform:rotate(360deg)}} .loading-text{font-size:1.125rem;color:var(--slate);font-weight:500}

    /* Error box */
    #errorBox{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border:2px solid #EF4444;border-radius:16px;padding:2rem;max-width:400px;width:90%;text-align:center;box-shadow:var(--shadow-lg);z-index:9998;display:none}
    #errorBox h3{color:#EF4444;margin-bottom:1rem;font-size:1.25rem;font-weight:600} #errorMsg{color:var(--slate);margin-bottom:1.5rem}
    .error-actions{display:flex;gap:1rem;justify-content:center}

    /* Toasts */
    #toastArea{position:fixed;top:1rem;right:1rem;z-index:9997;pointer-events:none}
    .toast{background:#fff;border-radius:12px;padding:1rem 1.5rem;margin-bottom:.5rem;box-shadow:var(--shadow);border-left:4px solid var(--green);font-size:.875rem;font-weight:500;opacity:0;transform:translateX(100%);transition:.3s;pointer-events:auto;max-width:320px}
    .toast.show{opacity:1;transform:translateX(0)} .toast.error{border-left-color:#EF4444;color:#991B1B} .toast.success{border-left-color:var(--green);color:#166534}

    /* Header */
    header{background:#fff;border-bottom:1px solid var(--border);padding:1rem 2rem;position:sticky;top:0;z-index:1000;backdrop-filter:blur(20px)}
    .header-content{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
    .logo{display:flex;align-items:center;gap:.5rem}
    .logo h1{font-size:1.5rem;font-weight:800;letter-spacing:-.02em}
    .logo-myq{color:var(--ink)} .logo-er{color:var(--red)} .logo-tm{color:var(--ink);font-size:.8em;vertical-align:super}
    .logo-hint{font-size:.75rem;color:var(--light-slate);font-style:italic;font-weight:400}
    .header-controls{display:flex;align-items:center;gap:1rem}
    #langSelector{position:relative;background:var(--glass);border:1px solid var(--border);border-radius:8px;padding:.5rem 1rem;font-size:.875rem;cursor:pointer;backdrop-filter:blur(10px)}
    .lang-dropdown{position:absolute;top:100%;right:0;background:#fff;border:1px solid var(--border);border-radius:8px;box-shadow:var(--shadow);z-index:1001;min-width:120px;display:none}
    .lang-dropdown button{width:100%;padding:.75rem 1rem;border:none;background:none;text-align:left;cursor:pointer;font-size:.875rem;transition:background .2s}
    .lang-dropdown button:hover{background:var(--bg)}
    #netStatus{padding:.5rem 1rem;border-radius:20px;font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.05em}
    #netStatus.online{background:#DCFCE7;color:var(--green)} #netStatus.offline{background:#FEF3C7;color:#D97706}
    #btnSignOut{background:var(--red);color:#fff;border:none;border-radius:8px;padding:.75rem 1.5rem;font-weight:600;cursor:pointer;transition:.2s}
    #btnSignOut:hover{background:#B71C1C;transform:translateY(-1px)}

    /* Offline banner */
    #offlineBanner{background:#FEF3C7;color:#92400E;padding:.75rem 2rem;text-align:center;font-size:.875rem;font-weight:500;border-bottom:1px solid #F59E0B;display:none}

    /* Layout */
    main{max-width:1200px;margin:0 auto;padding:2rem;display:grid;gap:2rem}
    .card{background:var(--glass);backdrop-filter:blur(24px);border:1px solid var(--border);border-radius:24px;padding:3rem 3rem 3rem 4rem;box-shadow:var(--shadow-lg);position:relative;overflow:hidden;transition:.3s cubic-bezier(.4,0,.2,1);margin-left:1rem}
    .card:hover{transform:translateY(-4px);box-shadow:var(--shadow-xl)}
    .card::before{content:'';position:absolute;top:0;left:0;bottom:0;width:6px;background:var(--gradient-green);border-radius:0 4px 4px 0}
    .card.ice::before{background:var(--gradient-orange)} .card.critical::before{background:var(--gradient-red)} .card.emergency::before{background:var(--gradient-red)}
    .ribbon{position:absolute;top:2rem;left:-.5rem;background:var(--gradient-green);color:#fff;padding:.75rem 1.5rem .75rem 2rem;font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;border-radius:0 12px 12px 0;box-shadow:0 4px 16px rgba(5,150,105,.3);z-index:10}
    .ribbon.ice{background:var(--gradient-orange)} .ribbon.critical{background:var(--gradient-red)} .ribbon.emergency{background:var(--gradient-red)}
    .card-header{margin-bottom:1.5rem} .card-title{font-size:1.5rem;font-weight:700;color:var(--ink);margin-bottom:.5rem} .card-subtitle{color:var(--slate);font-size:.875rem;line-height:1.5}

    .form-grid{display:grid;gap:1.5rem} .form-grid.two-col{grid-template-columns:1fr 1fr}
    .form-group{display:flex;flex-direction:column;gap:.5rem} .form-group label{font-weight:600;color:var(--ink);font-size:.875rem}
    .form-group input,.form-group select,.form-group textarea{padding:.75rem 1rem;border:2px solid var(--border);border-radius:12px;font-size:1rem;transition:.2s;background:#fff}
    .form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:var(--red);box-shadow:0 0 0 3px rgba(211,47,47,.1)}
    .form-group textarea{resize:vertical;min-height:100px} .form-hint{font-size:.75rem;color:var(--light-slate)}
    .checkbox-group{display:flex;align-items:center;gap:.75rem} .checkbox-group input[type="checkbox"]{width:20px;height:20px;accent-color:var(--red)}

    .save-button{background:var(--red);color:#fff;border:none;border-radius:12px;padding:.875rem 2rem;font-weight:600;cursor:pointer;transition:.2s;margin-top:1rem}
    .save-button:hover:not(:disabled){background:#B71C1C;transform:translateY(-1px)} .save-button:disabled{background:var(--light-slate);cursor:not-allowed}

    .status-msg{font-size:.875rem;margin-top:.5rem;padding:.5rem;border-radius:8px;display:none}
    .status-msg.success{background:#DCFCE7;color:var(--green)} .status-msg.error{background:#FEE2E2;color:#DC2626}

    /* Triage */
    .triage-section{display:flex;align-items:center;gap:1rem;margin-top:1rem;padding:1rem;background:rgba(248,250,252,.5);border-radius:12px;border:1px solid var(--border)}
    .triage-label{font-weight:600;color:var(--ink)}
    #triagePill{padding:.5rem 1rem;border-radius:20px;font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.05em}
    #triagePill.green{background:#DCFCE7;color:var(--green)} #triagePill.amber{background:#FEF3C7;color:#D97706} #triagePill.red{background:#FEE2E2;color:#DC2626} #triagePill.black{background:#F1F5F9;color:var(--slate)}
    #triageOverride{padding:.5rem 1rem;border:1px solid var(--border);border-radius:8px;font-size:.875rem;background:#fff}
    
<!-- Emergency Card & QR (CLEANED) -->
<section class="card emergency emergency-card">
  <div class="ribbon emergency">Emergency</div>

  <div class="card-header">
    <h2 class="card-title" id="qrTitle">Emergency Card & QR</h2>
    <p class="card-subtitle" id="qrExplain">QR never changes; it always opens your latest info.</p>
  </div>

  <div class="qr-section" style="display:grid;grid-template-columns:min-content min-content 1fr;gap:24px;align-items:start;">
    <!-- LEFT: Online QR -->
    <div>
      <div id="qrSlot">
        <canvas id="qrCanvas" width="200" height="200" aria-label="QR Code"
                style="display:block;width:220px;height:220px;image-rendering:pixelated;background:#fff;"></canvas>
        <div class="qr-placeholder" id="qrPlaceholder">
          <span>QR Code will appear here<br>after saving your profile</span>
        </div>
      </div>
      <p id="codeUnderQR" class="text-mono text-muted"></p>
      <p id="qrStatus" role="status" aria-live="polite" hidden></p>
    </div>

    <!-- MIDDLE: Offline vCard QR -->
    <div id="vcardSlot"
         style="width:220px;height:220px;border-radius:12px;border:1px solid #fecaca;background:#fff;display:flex;align-items:center;justify-content:center;">
      <canvas id="vcardCanvas" width="200" height="200" aria-label="Offline ICE QR"
              style="display:block;width:220px;height:220px;image-rendering:pixelated;background:#fff;"></canvas>
      <div class="qr-placeholder" id="vcardPlaceholder" hidden>Generate the offline QR</div>
    </div>

    <!-- RIGHT: Actions in 2×2 grid -->
    <div class="vcard-actions" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;align-content:start;">
      <button class="btn-secondary" id="openLink"
              onclick="(function(){var u=document.getElementById('cardUrl')?.value||'';if(u) window.open(u,'_blank','noopener');})();">
        Open Link
      </button>
      <button class="btn-secondary" id="regenVcardBtn" disabled>Regenerate</button>
      <button class="btn-secondary" id="dlVcardPNG">Download PNG</button>
      <button class="btn-secondary" id="printVcard">Print</button>
    </div>
  </div>

  <p id="vcardHelp" class="help" style="margin-top:10px;">
    Generated when Country, Blood, Donor and an ICE phone are set. Re-generate and re-print if any change.
  </p>
</section>
<!-- /Emergency Card & QR -->
    /* ICE */
    .ice-row{background:rgba(234,88,12,.03);border:1px solid rgba(234,88,12,.1);border-radius:16px;padding:2rem;margin-bottom:1.5rem;transition:.3s;position:relative}
    .ice-row:hover{background:rgba(234,88,12,.05);border-color:rgba(234,88,12,.2);transform:translateY(-2px);box-shadow:0 8px 24px rgba(234,88,12,.1)}
    .ice-contact-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}
    .contact-number{background:var(--gradient-orange);color:#fff;width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1rem;box-shadow:0 4px 12px rgba(234,88,12,.3)}
    .ice-actions{display:flex;gap:.75rem;align-items:center}
    .iceSaveBtn{background:var(--gradient-orange);color:#fff;border:none;border-radius:8px;padding:.5rem 1rem;font-size:.75rem;font-weight:600;cursor:pointer;text-transform:uppercase;letter-spacing:.05em}
    .iceDeleteBtn{background:none;border:none;color:#DC2626;cursor:pointer;font-size:1.25rem;padding:.5rem;border-radius:8px;transition:.2s;display:flex;align-items:center;justify-content:center;width:36px;height:36px}
    .iceDeleteBtn:hover{background:rgba(220,38,38,.1);color:#B91C1C}
    .ice-form-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}
    .ice-form-grid .form-group:nth-child(3){grid-column:1/-1}
    #addIce{background:rgba(234,88,12,.1);color:var(--orange);border:2px dashed rgba(234,88,12,.3);border-radius:16px;padding:1.5rem 2rem;font-weight:600;cursor:pointer;transition:.3s;margin-top:1rem;width:100%;font-size:.875rem;text-transform:uppercase;letter-spacing:.05em}
    #addIce:hover:not(:disabled){background:rgba(234,88,12,.15);border-color:rgba(234,88,12,.5);transform:translateY(-2px)}
    #addIce:disabled{opacity:.5;cursor:not-allowed}

    /* Delete / disclaimers / footer */
    .delete-account{background:linear-gradient(135deg,rgba(220,38,38,.03) 0%,rgba(220,38,38,.08) 100%);border:1px solid rgba(220,38,38,.15);margin-top:3rem}
    .delete-form{background:rgba(220,38,38,.05);border:1px solid rgba(220,38,38,.1);border-radius:16px;padding:2rem;margin-top:1.5rem}
    .delete-button{background:#DC2626;color:#fff;border:none;border-radius:12px;padding:.875rem 2rem;font-weight:600;cursor:pointer;transition:.2s;margin-top:1rem;width:100%}
    .delete-button:hover:not(:disabled){background:#B91C1C;transform:translateY(-1px)} .delete-button:disabled{background:var(--light-slate);cursor:not-allowed;opacity:.6}

    .disclaimers{max-width:1200px;margin:3rem auto 2rem;padding:0 2rem}
    .disclaimer-content{background:rgba(148,163,184,.05);border:1px solid rgba(148,163,184,.1);border-radius:16px;padding:2rem;text-align:center}
    .disclaimer-content p{color:var(--slate);font-size:.875rem;line-height:1.6;margin:0}
    .disclaimer-content p:first-child{margin-bottom:.75rem;font-weight:500}

    .footer{background:#fff;border-top:1px solid var(--border);padding:2rem;margin-top:4rem}
    .footer-content{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}
    .footer-links{display:flex;gap:2rem}
    .footer-links a{color:var(--slate);text-decoration:none;font-size:.875rem;font-weight:500;transition:color .2s}
    .footer-links a:hover{color:var(--red)}
    .footer-copyright{color:var(--light-slate);font-size:.75rem}
    .hidden{display:none!important}

    @media (max-width:768px){
      header{padding:1rem}
      .header-content{flex-direction:column;gap:1rem;align-items:stretch}
      .header-controls{justify-content:space-between}
      main{padding:1rem;gap:1.5rem}
      .card{padding:1.5rem 1.5rem 1.5rem 2rem;margin-left:.5rem}
      .form-grid.two-col{grid-template-columns:1fr}
      .qr-section{grid-template-columns:1fr;gap:2rem;text-align:center}
      .qr-placeholder{width:150px;height:150px}
      #qrSlot{width:200px;height:200px;margin:0 auto}
      .download-grid{grid-template-columns:1fr}
      .ice-form-grid{grid-template-columns:1fr}
      .disclaimers{padding:0 1rem} .disclaimer-content{padding:1.5rem}
      .footer{padding:1.5rem 1rem}
      .footer-content{flex-direction:column;text-align:center;gap:1.5rem}
      .footer-links{justify-content:center}
      .vcard-grid{grid-template-columns:1fr}
    }
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    button:focus,input:focus,select:focus,textarea:focus{outline:2px solid var(--red);outline-offset:2px}
    /* Let the emergency card show the QR glow outside rounded corners */
.card.emergency { overflow: visible; }

/* Fix the QR layout: left column is a steady width */
.qr-section { grid-template-columns: 260px 1fr; align-items: start; }

/* Make both canvases behave like block elements and avoid squish */
#qrCanvas, #vcardCanvas { display: block; }

/* Keep the QR slot’s glow contained to itself, not the card */
#qrSlot { overflow: visible; }
#qrSlot::before { inset: -6px; border-radius: 24px; }

/* Safety: don’t let anything collapse the minimum height */
.card.emergency .qr-section { min-height: 260px; }

/* If you still see the dashed placeholder on top, make sure we hide it once the QR draws */
#qrPlaceholder { display: none; }  /* JS will toggle this anyway */
  </style>
  <style id="qr-layout-fix">
  /* card background */
  .card.emergency.emergency-card{
    background:linear-gradient(135deg,rgba(220,38,38,.03) 0%,rgba(220,38,38,.08) 100%);
    border:1px solid rgba(220,38,38,.15);
  }

  /* two-column area inside Emergency card */
  .qr-section{display:grid;grid-template-columns:260px 1fr;gap:3rem;align-items:start}

  /* both QRs same visual size */
  #qrCanvas,#vcardCanvas{display:block;width:220px;height:220px;image-rendering:pixelated;background:#fff}

  /* URL QR slot */
  #qrSlot{position:relative;width:240px;height:240px;background:#fff;border:3px solid rgba(220,38,38,.1);
          border-radius:20px;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 32px rgba(220,38,38,.1);
          overflow:visible}
  #qrSlot::before{content:'';position:absolute;inset:-6px;border-radius:24px;
                  background:conic-gradient(from 0deg,transparent,rgba(220,38,38,.2),transparent);
                  animation:rotate 3s linear infinite}

  /* trio row in the vCard area: [ONLINE mirror] [OFFLINE QR] [Buttons] */
  #vcardTrioRow{display:grid;grid-template-columns:min-content min-content 1fr;gap:24px;align-items:start}

  /* 2×2 buttons stack on the right */
  .vcard-actions{display:grid;grid-template-columns:1fr 1fr;gap:12px;align-content:start}
</style>
</head>
<body>
  <!-- Loading -->
  <div id="loadingState">
    <div class="spinner"></div>
    <div class="loading-text" data-i18n="loading.dashboard">Loading your dashboard…</div>
  </div>

  <!-- Error -->
  <div id="errorBox">
    <h3 data-i18n="error.title">Something went wrong</h3>
    <div id="errorMsg"></div>
    <div class="error-actions">
      <button class="btn-secondary" onclick="location.reload()" data-i18n="error.retry">Try Again</button>
    </div>
  </div>

  <!-- Toasts -->
  <div id="toastArea" aria-live="polite"></div>

  <!-- Header -->
  <header>
    <div class="header-content">
      <div class="logo">
        <h1><span class="logo-myq">MYQ</span><span class="logo-er">ER</span><span class="logo-tm">™</span></h1>
        <span class="logo-hint" data-i18n="logo.hint">pronounced "my care"</span>
      </div>
      <div class="header-controls">
        <div style="position: relative;">
          <button id="langSelector" aria-haspopup="true" aria-expanded="false">EN</button>
          <div class="lang-dropdown" id="langDropdown">
            <button data-lang="en">English</button><button data-lang="es">Español</button><button data-lang="fr">Français</button>
            <button data-lang="de">Deutsch</button><button data-lang="it">Italiano</button><button data-lang="pt">Português</button>
            <button data-lang="ro">Română</button><button data-lang="ar">العربية</button><button data-lang="hi">हिन्दी</button><button data-lang="zh">中文</button>
          </div>
        </div>
        <div id="netStatus" class="online" data-i18n="status.online">Online</div>
        <button id="btnSignOut" data-i18n="header.logout">Logout</button>
      </div>
    </div>
  </header>

  <!-- Offline banner -->
  <div id="offlineBanner"><span data-i18n="offline.message">You're offline — QR still works with cached data.</span></div>

  <!-- Main -->
  <main>
    <!-- Identity -->
    <section class="card identity">
      <div class="ribbon">Identity</div>
      <div class="card-header">
        <h2 class="card-title" data-i18n="identity.title">Identity — Personal Information</h2>
        <p class="card-subtitle" data-i18n="identity.hint">These details help responders confirm who you are.</p>
      </div>
      <form class="form-grid two-col">
        <div class="form-group">
          <label for="profileFullName" data-i18n="identity.fullName">Full Name</label>
          <input type="text" id="profileFullName" data-i18n-placeholder="identity.fullNamePlaceholder" placeholder="Enter your full legal name" required>
        </div>
        <div class="form-group">
          <label for="profileDob" data-i18n="identity.dob">Date of Birth</label>
          <input type="date" id="profileDob" required>
          <span class="form-hint" data-i18n="identity.dobHint">Format: YYYY-MM-DD</span>
        </div>
        <div class="form-group">
          <label for="profileCountry" data-i18n="identity.country">Country</label>
          <select id="profileCountry" required>
            <option value="" data-i18n="identity.selectCountry">Select your country</option>
            <option value="US">United States</option><option value="CA">Canada</option><option value="GB">United Kingdom</option>
            <option value="DE">Germany</option><option value="FR">France</option><option value="ES">Spain</option>
            <option value="IT">Italy</option><option value="PT">Portugal</option><option value="RO">Romania</option>
            <option value="IN">India</option><option value="CN">China</option><option value="AU">Australia</option>
            <option value="BR">Brazil</option><option value="MX">Mexico</option><option value="JP">Japan</option>
            <option value="KR">South Korea</option><option value="OTHER">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label for="profileHealthId" data-i18n="identity.healthId">National/Health ID (Optional)</label>
          <input type="text" id="profileHealthId" data-i18n-placeholder="identity.healthIdPlaceholder" placeholder="e.g., NHS number, SSN, etc.">
          <span class="form-hint" data-i18n="identity.healthIdHint">Only visible to medical professionals</span>
        </div>
      </form>
      <button class="save-button" id="saveProfile" data-i18n="common.saveProfile">Save Profile</button>
      <div class="status-msg" id="profileMsg"></div>
    </section>

    <!-- Critical Health -->
    <section class="card critical">
      <div class="ribbon critical">Critical</div>
      <div class="card-header">
        <h2 class="card-title" data-i18n="critical.title">CRITICAL — Medical & Health Details</h2>
        <p class="card-subtitle" data-i18n="critical.hint">Keep this current. It appears on your emergency card.</p>
      </div>
      <form class="form-grid">
        <div class="form-group">
          <label for="hfBloodType" data-i18n="critical.bloodType">Blood Type</label>
          <select id="hfBloodType">
            <option value="" data-i18n="critical.selectBloodType">Select blood type</option>
            <option value="O+">O+</option><option value="O-">O-</option><option value="A+">A+</option><option value="A-">A-</option>
            <option value="B+">B+</option><option value="B-">B-</option><option value="AB+">AB+</option><option value="AB-">AB-</option>
            <option value="Unknown" data-i18n="critical.unknown">Unknown</option>
          </select>
        </div>
        <div class="form-group">
          <label for="hfAllergies" data-i18n="critical.allergies">Critical Allergies</label>
          <textarea id="hfAllergies" placeholder="List any life-threatening allergies (medications, foods, etc.)"></textarea>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="hfDonor">
          <label for="hfDonor" data-i18n="critical.organDonor">I am an organ donor</label>
        </div>
        <div class="form-group">
          <label for="hfConditions" data-i18n="critical.conditions">Medical Conditions</label>
          <textarea id="hfConditions" placeholder="Diabetes, heart disease, epilepsy, etc."></textarea>
        </div>
        <div class="form-group">
          <label for="hfMeds" data-i18n="critical.medications">Current Medications</label>
          <textarea id="hfMeds" placeholder="List all current medications and dosages"></textarea>
        </div>
        <div class="form-group">
          <label for="hfImplants" data-i18n="critical.implants">Implants/Medical Devices</label>
          <textarea id="hfImplants" placeholder="Pacemaker, insulin pump, metal implants, etc."></textarea>
        </div>
      </form>

      <div class="triage-section">
        <span class="triage-label" data-i18n="triage.label">Triage:</span>
        <div id="triagePill" class="green">GREEN</div>
        <select id="triageOverride">
          <option value="auto" data-i18n="triage.useAuto">Use auto</option>
          <option value="green" data-i18n="triage.green">Green</option>
          <option value="amber" data-i18n="triage.amber">Amber</option>
          <option value="red" data-i18n="triage.red">Red</option>
          <option value="black" data-i18n="triage.black">Black</option>
        </select>
      </div>

      <button class="save-button" id="saveHealth" data-i18n="common.saveHealth">Save Health</button>
      <div class="status-msg" id="healthMsg"></div>
    </section>

    <!-- ICE Contacts -->
    <section class="card ice">
      <div class="ribbon ice">ICE</div>
      <div class="card-header">
        <h2 class="card-title" data-i18n="iceTitle">Emergency Contacts (ICE)</h2>
        <p class="card-subtitle" data-i18n="iceHint">Add up to 3 trusted contacts.</p>
      </div>

      <div id="iceContactsList"></div>

      <button id="addIce" data-i18n="ice.addContact">+ Add Emergency Contact</button>
      <button class="save-button" id="saveIce" data-i18n="common.saveIce">Save ICE Contacts</button>
      <div class="status-msg" id="iceMsg"></div>
    </section>

    <!-- Emergency Card & QR -->
    <section class="card emergency emergency-card">
      <div class="ribbon emergency">Emergency</div>

      <div class="card-header">
        <h2 class="card-title" id="qrTitle">Emergency Card & QR</h2>
        <p class="card-subtitle" id="qrExplain">QR never changes; it always opens your latest info.</p>
      </div>

      <div class="qr-section">
        <!-- LEFT: URL QR canvas -->
        <div>
          <div id="qrSlot">
            <canvas id="qrCanvas" width="200" height="200" aria-label="QR Code"></canvas>
            <div class="qr-placeholder" id="qrPlaceholder">
              <span>QR Code will appear here<br>after saving your profile</span>
            </div>
          </div>
          <p id="codeUnderQR" class="text-mono text-muted"></p>
          <p id="qrStatus" role="status" aria-live="polite" hidden></p>
        </div>

        <!-- RIGHT: controls -->
        <div class="qr-controls">
          <!-- URL section -->
          <div class="qr-url-section">
            <h4>Card URL</h4>
            <input type="text" id="cardUrl" readonly placeholder="https://myqer.com/c/ABC123">
            <div class="url-actions">
              <button class="btn-secondary" id="copyLink">Copy Link</button>
              <button class="btn-secondary" id="openLink">Open Link</button>
              <button class="btn-secondary" id="dlPNG">Download PNG</button>
            </div>
          </div>

          <!-- OFFLINE VCARD PANEL -->
          <div class="vcard-panel">
            <h4 style="text-transform:uppercase;letter-spacing:.05em;font-size:.875rem;margin-bottom:.75rem;">Offline ICE QR</h4>
            <div class="vcard-grid">
              <div id="vcardSlot">
  <canvas id="vcardCanvas" width="200" height="200" aria-label="Offline ICE QR"></canvas>
  <div class="qr-placeholder" id="vcardPlaceholder" hidden>
    Generate the offline QR
  </div>
</div>
              <div>
                <p id="vcardHelp" class="help">
                  Generated when Country, Blood, Donor and an ICE phone are set. Re-generate and re-print if any change.
                </p>
                <div class="vcard-actions">
                  <button class="btn-secondary" id="regenVcardBtn" disabled>Regenerate</button>
                  <button class="btn-secondary" id="dlVcardPNG">Download PNG</button>
                  <button class="btn-secondary" id="printVcard">Print</button>
                </div>
              </div>
            </div>
          </div>
          <!-- /OFFLINE VCARD PANEL -->
        </div>
      </div>
    </section>

    <!-- Delete -->
    <section class="card delete-account">
      <div class="ribbon critical">Danger</div>
      <div class="card-header">
        <h2 class="card-title" data-i18n="delete.title">Delete Account</h2>
        <p class="card-subtitle" data-i18n="delete.warning">This action cannot be undone. All your data will be permanently deleted.</p>
      </div>
      <div class="delete-form">
        <div class="form-group">
          <label for="deletePhrase" data-i18n="delete.confirmLabel">Type "DELETE MY ACCOUNT" to confirm:</label>
          <input type="text" id="deletePhrase" placeholder="DELETE MY ACCOUNT" autocomplete="off">
          <span class="form-hint" data-i18n="delete.confirmHint">This phrase must match exactly</span>
        </div>
        <button class="delete-button" id="deleteBtn" disabled data-i18n="delete.button">Delete My Account</button>
        <div class="status-msg" id="deleteMsg"></div>
      </div>
    </section>
  </main>

  <!-- Disclaimers -->
  <div class="disclaimers">
    <div class="disclaimer-content">
      <p data-i18n="disclaimer.medical">Informational only. Clinicians must confirm with official medical documents.</p>
      <p data-i18n="disclaimer.privacy">Data stays on your device unless you choose to share.</p>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-links">
        <a href="/privacy.html" data-i18n="footer.privacy">Privacy Policy</a>
        <a href="/terms.html" data-i18n="footer.terms">Terms of Service</a>
      </div>
      <div class="footer-copyright">
        <span data-i18n="footer.copyright">© 2024 MYQER™. All rights reserved.</span>
      </div>
    </div>
  </footer>

  <!-- Cloudflare snippet (leave as-is) -->
  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97984376b004496e',t:'MTc1NjkzNDEzNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>

  <script>document.getElementById('loadingState').style.display='none';</script>
</body>
</html>
