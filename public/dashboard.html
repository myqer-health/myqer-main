<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>MYQER™ Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    :root{--myqer-red:#dc2626}
    html,body{font-family:'Inter',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#fff}
    .glass{background:rgba(255,255,255,.9);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid rgba(0,0,0,.06);box-shadow:0 10px 30px rgba(0,0,0,.06)}
    .btn-primary{background:var(--myqer-red);color:#fff;font-weight:700;border-radius:.75rem;padding:.75rem 1rem}
    .btn-primary[disabled]{opacity:.5;cursor:not-allowed}
    .tag{display:inline-flex;align-items:center;gap:.25rem;background:#e5e7eb;color:#111;padding:.25rem .5rem;border-radius:999px;font-size:.825rem}
    .tag button{color:#6b7280}
    .toast{position:fixed;top:20px;right:20px;z-index:1000;background:#111;color:#fff;padding:.75rem 1rem;border-radius:.5rem;opacity:0;transform:translateY(-8px);transition:.25s}
    .toast.show{opacity:1;transform:none}
  </style>
</head>
<body class="min-h-screen">

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <header class="w-full border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="text-2xl font-extrabold">MYQ<span class="text-red-600">ER</span>™</div>
      <div class="flex items-center gap-4">
        <div class="flex items-center gap-2 text-sm text-gray-700">
          <span id="netDot" class="w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse"></span>
          <span id="netLabel">Online</span>
        </div>
        <button id="logoutBtn" class="text-sm font-semibold hover:text-red-600">Logout</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-6 py-6 space-y-6">

    <section class="glass rounded-2xl p-6 flex items-center justify-between">
      <div>
        <h2 class="text-2xl font-bold">Profile Completion</h2>
        <p class="text-gray-600">Complete your emergency profile.</p>
      </div>
      <div class="flex items-center gap-6">
        <div class="relative w-20 h-20">
          <svg class="w-20 h-20 transform -rotate-90" viewBox="0 0 36 36">
            <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#e5e7eb" stroke-width="3"/>
            <path id="progressArc" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#dc2626" stroke-width="3" stroke-dasharray="0,100"/>
          </svg>
          <div class="absolute inset-0 grid place-items-center">
            <span id="progressPct" class="text-xl font-bold">0%</span>
          </div>
        </div>
        <ul class="text-sm space-y-1">
          <li><span id="chkIdentity" class="font-bold text-amber-600">○</span> Identity</li>
          <li><span id="chkHealth" class="font-bold text-amber-600">○</span> Health</li>
          <li><span id="chkContacts" class="font-bold text-amber-600">○</span> ICE</li>
          <li><span id="chkQR" class="font-bold text-amber-600">○</span> QR</li>
        </ul>
      </div>
    </section>

    <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="glass rounded-2xl p-6 border-l-4 border-green-500">
        <div class="flex items-start justify-between mb-6">
          <div>
            <h3 class="text-xl font-bold">Identity Information</h3>
            <p class="text-gray-600 text-sm">Helps first responders confirm who you are.</p>
          </div>
          <div id="iconIdentity" class="w-8 h-8 rounded-full grid place-items-center bg-amber-500 text-white">○</div>
        </div>
        <div class="space-y-5">
          <div>
            <label class="block text-sm font-medium mb-1">Full Legal Name *</label>
            <input id="full_name" type="text" class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-600" placeholder="Jane Doe" required>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Date of Birth *</label>
            <input id="date_of_birth" type="text" class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-600" placeholder="DD/MM/YYYY" required>
            <p class="text-xs text-gray-500 mt-1">Format: DD/MM/YYYY</p>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Country of Residence *</label>
            <select id="country" class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-600" required>
              <option value="">Select your country</option>
              <option value="GB">🇬🇧 United Kingdom</option>
              <option value="US">🇺🇸 United States</option>
              <option value="CA">🇨🇦 Canada</option>
              <option value="DE">🇩🇪 Germany</option>
              <option value="FR">🇫🇷 France</option>
              <option value="ES">🇪🇸 Spain</option>
              <option value="IT">🇮🇹 Italy</option>
              <option value="IN">🇮🇳 India</option>
              <option value="CN">🇨🇳 China</option>
              <option value="AU">🇦🇺 Australia</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">National Health ID</label>
            <input id="national_health_id" type="text" class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-600" placeholder="NHS Number, SSN, etc."/>
            <p class="text-xs text-gray-500 mt-1">Stored privately. Not shown on your public card.</p>
          </div>
        </div>
      </div>

      <div class="glass rounded-2xl p-6 border-l-4 border-red-500">
        <div class="flex items-start justify-between mb-6">
          <div>
            <h3 class="text-xl font-bold">Health Profile</h3>
            <p class="text-gray-600 text-sm">Appears on your emergency card. Keep accurate.</p>
          </div>
          <div id="iconHealth" class="w-8 h-8 rounded-full grid place-items-center bg-amber-500 text-white">○</div>
        </div>
        <div class="space-y-5">
          <div>
            <label class="block text-sm font-medium mb-1">Blood Type</label>
            <select id="blood_type" class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-600">
              <option value="">Select blood type</option>
              <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
              <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
              <option>Unknown</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Organ Donor Status</label>
            <select id="organ_donor" class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-600">
              <option value="">Select status</option>
              <option value="yes">Yes (Registered)</option>
              <option value="no">No (Not a donor)</option>
              <option value="unspecified">Not specified</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Life Support Preference</label>
            <select id="life_support_pref" class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-600">
              <option value="">Select preference</option>
              <option value="Full">Full Life Support</option>
              <option value="Limited">Limited</option>
              <option value="Comfort">Comfort Care Only</option>
              <option value="DNR">DNR</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-semibold">Critical Allergies ⚠️</label>
            <div id="allergiesPills" class="flex flex-wrap gap-2 my-2"></div>
            <input id="allergiesInput" class="w-full border rounded-lg px-4 py-3" placeholder="Type allergy and press Enter"/>
          </div>
          <div>
            <label class="block text-sm font-semibold">Medical Conditions</label>
            <div id="conditionsPills" class="flex flex-wrap gap-2 my-2"></div>
            <input id="conditionsInput" class="w-full border rounded-lg px-4 py-3" placeholder="Type condition and press Enter"/>
          </div>
          <div>
            <label class="block text-sm font-semibold">Medications</label>
            <div id="medicationsPills" class="flex flex-wrap gap-2 my-2"></div>
            <input id="medicationsInput" class="w-full border rounded-lg px-4 py-3" placeholder="Type medication and press Enter"/>
          </div>
        </div>
      </div>
    </section>

    <section class="glass rounded-2xl p-6 border-l-4 border-amber-500">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div>
          <h3 class="text-xl font-bold">Triage</h3>
          <p class="text-gray-600 text-sm">Auto-computed from your data. You can override.</p>
          <p class="text-xs text-gray-500 mt-1">MYQER does not diagnose or provide medical advice. This triage label is user-provided and assistive only for responders.</p>
        </div>
        <div id="triageBadge" class="inline-flex items-center px-6 py-3 rounded-full text-white text-lg font-bold bg-green-600">
          🟢 <span class="ml-2">Green — Stable</span>
        </div>
      </div>
      <div class="mt-4 max-w-sm">
        <label class="block text-sm font-medium mb-1">Override</label>
        <select id="triage_override" class="w-full border rounded-lg px-4 py-3">
          <option value="auto">Auto (recommended)</option>
          <option value="Green">Green — Stable</option>
          <option value="Amber">Amber — Urgent</option>
          <option value="Red">Red — Immediate</option>
          <option value="Black">Black — Comfort Care</option>
        </select>
      </div>
    </section>

    <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="glass rounded-2xl p-6 border-l-4 border-purple-500">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h3 class="text-xl font-bold">ICE Contacts</h3>
            <p class="text-gray-600 text-sm"><span id="contactsCounter">0</span> of 5 added</p>
          </div>
          <button id="addContact" class="btn-primary">Add Contact</button>
        </div>
        <div id="contactsList" class="space-y-3"></div>
        <div id="noContacts" class="text-sm text-gray-500">Add people you trust. Name and phone are required.</div>
      </div>

      <div class="glass rounded-2xl p-6 border-l-4 border-gray-800">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold">Your QR Code</h3>
          <button id="generateQR" class="btn-primary">Generate</button>
        </div>
        <p class="text-gray-600 text-sm mb-4">Single, permanent code for your public emergency card.</p>
        <div id="qrBox" class="border rounded-xl h-52 grid place-items-center mb-3 overflow-hidden bg-white"></div>
        <div class="flex items-center gap-2 mb-3">
          <input id="shareLink" class="flex-1 border rounded-lg px-3 py-2 text-sm" readonly placeholder="Share link"/>
          <button id="copyLink" class="px-3 py-2 border rounded-lg text-sm">Copy</button>
        </div>
        <div class="flex items-center gap-2">
          <button id="exportPNG" class="px-3 py-2 border rounded-lg text-sm" disabled>Export PNG</button>
          <button id="printQR" class="px-3 py-2 border rounded-lg text-sm" disabled>Print</button>
        </div>
      </div>
    </section>

    <section class="glass rounded-2xl p-8 border border-red-200 text-center">
      <h3 class="text-xl font-bold mb-2 text-red-700">Danger Zone</h3>
      <p class="text-gray-700 mb-4">This will delete your profile, health data, contacts, and disable your QR.</p>
      <div class="max-w-sm mx-auto">
        <input id="confirmDelete" class="w-full border rounded-lg px-4 py-3 mb-3" placeholder='Type "DELETE" to confirm'/>
        <button id="deleteAccount" class="btn-primary w-full" disabled>Delete Account</button>
      </div>
    </section>

  </main>

  <!-- ONE script include. Remove all other inline <script> blocks. -->
  <script src="/assets/js/dashboard.js" defer></script>
</body>
</html>
