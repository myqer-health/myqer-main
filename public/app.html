<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>MYQER â€” Dashboard</title>

  <!-- PWA -->
  <link rel="manifest" href="/myqer_manifest.json" />
  <meta name="theme-color" content="#c62828" />

  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/images/icon-192.png" />
  <link rel="apple-touch-icon" href="/images/icon-192.png" />

  <!-- ðŸ§© main stylesheet -->
  <link rel="stylesheet" href="/styles/app.css" />

  <!-- (optional debug) -->
  <meta name="supabase-url" content="https://tgddpmxpbgrzrbzpomou.supabase.co" />

  <!-- Page-local tweaks -->
  <style>
    :root { --red:#c62828; --blur:22px; --glass:rgba(255,255,255,.22); --stroke:rgba(255,255,255,.35); }
    body{margin:0;background:linear-gradient(135deg,#f7f7f9,#e6ecf5);}
    header{position:sticky;top:0;backdrop-filter:blur(var(--blur));background:rgba(255,255,255,.45);
      padding:10px 16px;border-bottom:1px solid var(--stroke);display:flex;gap:12px;align-items:center;justify-content:space-between}
    .pill{border:1px solid var(--stroke);border-radius:999px;padding:.5rem .9rem;background:var(--glass)}
    .pill.red{border-color:var(--red);color:#fff;background:var(--red)}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px;display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:900px){.wrap{grid-template-columns:1fr 1fr}}
    .card{background:rgba(255,255,255,.45);backdrop-filter:blur(var(--blur));border:1px solid var(--stroke);border-radius:18px;padding:16px}
    h2{margin:.2rem 0 1rem}
    label{display:block;font-size:.9rem;opacity:.85;margin:.3rem 0}
    input,select,textarea{width:100%;padding:.7rem;border-radius:12px;border:1px solid var(--stroke);background:rgba(255,255,255,.7)}
    .section{display:grid;gap:.6rem}
    .triage{display:flex;align-items:center;gap:8px}
    #triageBadge{padding:.35rem .7rem;border-radius:999px;font-weight:600;border:1px solid var(--stroke)}
    #triageBadge[data-color="red"]{background:#ffe6e6;color:#a20000;border-color:#ffb3b3}
    #triageBadge[data-color="amber"]{background:#fff6e0;color:#a76a00;border-color:#ffd38a}
    #triageBadge[data-color="green"]{background:#e8ffe8;color:#0b7a0b;border-color:#b7f0b7}
    #triageBadge[data-color="blue"]{background:#e6f0ff;color:#0a4bb3;border-color:#b3d0ff}
    .ice-row{display:grid;grid-template-columns:2fr 1.3fr 1.7fr auto;gap:.5rem;align-items:center;margin:.4rem 0}
    .glass{background:rgba(255,255,255,.5);border:1px solid var(--stroke);padding:.4rem;border-radius:12px}
    .footer{opacity:.6;text-align:center;margin:20px 0}
  </style>
</head>
<body>
  <header>
    <strong>MYQER</strong>
    <div style="display:flex;gap:8px;align-items:center">
      <label for="langSel" data-i18n="labels.language" style="margin:0;opacity:.7">Language</label>
      <select id="langSel" data-lang-picker class="pill" aria-label="Language"></select>
      <button id="logout" class="pill" data-i18n="actions.logout">Logout</button>
    </div>
  </header>

  <main class="wrap" role="main">
    <!-- Personal Info -->
    <section class="card section" aria-labelledby="personalSection">
      <h2 id="personalSection" data-i18n="sections.personal">Personal Info</h2>
      <div class="triage" aria-live="polite">
        <span data-i18n="labels.triage">Triage</span>
        <span id="triageBadge" data-color="green">Green</span>
      </div>

      <label for="full_name" data-i18n="labels.full_name">Full name</label>
      <input id="full_name" autocomplete="name" />

      <label for="dob" data-i18n="labels.dob">Date of birth</label>
      <input id="dob" type="date" />

      <label for="country" data-i18n="labels.country">Country</label>
      <input id="country" autocomplete="country-name" />

      <label for="blood_type" data-i18n="labels.blood_type">Blood type</label>
      <select id="blood_type">
        <option value=""></option><option>A+</option><option>A-</option><option>B+</option><option>B-</option>
        <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
      </select>

      <label for="national_id" data-i18n="labels.national_id">National ID</label>
      <input id="national_id" />

      <label><input id="organ_donor" type="checkbox" /> <span data-i18n="labels.organ_donor">Organ donor</span></label>

      <label for="life_support_preference" data-i18n="labels.life_support">Life support preference</label>
      <input id="life_support_preference" placeholder="DNR / Full / Limited" />

      <label for="triage_override" data-i18n="labels.triage_override">Manual triage override</label>
      <select id="triage_override">
        <option value="">â€”</option>
        <option value="red">Red</option>
        <option value="amber">Amber</option>
        <option value="green">Green</option>
        <option value="blue">Blue</option>
      </select>
    </section>

    <!-- Health -->
    <section class="card section" aria-labelledby="healthSection">
      <h2 id="healthSection" data-i18n="sections.health">Health Profile</h2>
      <label for="allergies" data-i18n="labels.allergies">Allergies</label>
      <textarea id="allergies" rows="2" placeholder="comma-separated"></textarea>

      <label for="conditions" data-i18n="labels.conditions">Conditions</label>
      <textarea id="conditions" rows="2" placeholder="comma-separated"></textarea>

      <label for="medications" data-i18n="labels.medications">Medications</label>
      <textarea id="medications" rows="2" placeholder="comma-separated"></textarea>
    </section>

    <!-- ICE -->
    <section class="card section" aria-labelledby="iceSection">
      <h2 id="iceSection" data-i18n="sections.ice">ICE Contacts</h2>
      <div id="iceList"></div>
      <button id="addIce" class="pill red" data-i18n="actions.add_contact">Add contact</button>
    </section>

    <!-- QR -->
    <section class="card section" aria-labelledby="qrSection">
      <h2 id="qrSection" data-i18n="sections.qr">QR Emergency Card</h2>
      <div id="qr" style="display:grid;place-items:center;min-height:260px"></div>
      <a id="cardLink" href="#" target="_blank" rel="noopener"></a>
    </section>

    <!-- Backend Hooks -->
    <section class="card section" aria-labelledby="backendSection">
      <h2 id="backendSection">Backend Actions</h2>
      <div id="voiceWrap"></div>
      <div style="display:flex; gap:.5rem; flex-wrap:wrap">
        <button id="btnRegenQR" class="pill red">Regenerate QR</button>
        <button id="btnBuildVoice" class="pill">Build Voice (TTS)</button>
        <button id="btnPreviewResponder" class="pill">Preview Responder JSON</button>
      </div>
      <pre id="previewOut" class="glass" style="min-height:120px; padding:12px; border-radius:12px; overflow:auto"></pre>
    </section>
  </main>

  <p class="footer">Â© MYQER</p>

  <!-- App scripts -->
  <script type="module" src="/scripts/config.js"></script>
  <script type="module" src="/scripts/app.js"></script>
  <script type="module" src="/scripts/backend_hooks.js"></script>

  <!-- PWA registration -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/myqer_service_worker.js');
    }
  </script>

  <!-- Auth: protect page + logout -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    import { SUPABASE_URL, SUPABASE_ANON_KEY } from '/scripts/config.js';

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // protect: redirect if not signed in
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) location.replace('/login.html');

    // logout
    const btn = document.getElementById('logout');
    if (btn) {
      btn.addEventListener('click', async () => {
        await supabase.auth.signOut();
        location.replace('/login.html');
      });
    }
  </script>
  <!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MYQER â€” Dashboard</title>

  <!-- PWA -->
  <link rel="manifest" href="/myqer_manifest.json" />
  <meta name="theme-color" content="#c62828" />

  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/images/icon-192.png" />
  <link rel="apple-touch-icon" href="/images/icon-192.png" />

  <!-- Dashboard stylesheet -->
  <link rel="stylesheet" href="/styles/app.css" />
</head>
<body class="app-page">
  <header class="app-header" role="banner">
    <a class="brand" href="/" aria-label="MYQER Home">
      <span>MYQ</span><span class="er">ER</span><sup>â„¢</sup>
    </a>

    <div class="header-actions">
      <label for="langSel" class="visually-hidden">Language</label>
      <select id="langSel" data-lang-picker class="pill" aria-label="Language"></select>
      <button id="logout" class="pill ghost">Logout</button>
    </div>
  </header>

  <main class="app-wrap" role="main">
    <!-- Personal Info -->
    <section class="card section" aria-labelledby="personalSection">
      <div class="card-head">
        <h2 id="personalSection">Personal info</h2>
        <div class="triage">
          <span class="label">Triage</span>
          <span id="triageBadge" class="badge" data-color="green">Green</span>
        </div>
      </div>

      <div class="field">
        <label for="full_name">Full name</label>
        <input id="full_name" autocomplete="name" />
      </div>

      <div class="grid-2">
        <div class="field">
          <label for="dob">Date of birth</label>
          <input id="dob" type="date" />
        </div>
        <div class="field">
          <label for="country">Country</label>
          <input id="country" autocomplete="country-name" />
        </div>
      </div>

      <div class="grid-2">
        <div class="field">
          <label for="blood_type">Blood type</label>
          <select id="blood_type">
            <option value=""></option><option>A+</option><option>A-</option><option>B+</option><option>B-</option>
            <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
          </select>
        </div>
        <div class="field">
          <label for="national_id">Health/National ID (optional)</label>
          <input id="national_id" />
        </div>
      </div>

      <div class="grid-2">
        <label class="check">
          <input id="organ_donor" type="checkbox" />
          <span>Organ donor</span>
        </label>

        <div class="field">
          <label for="life_support_preference">Life support preference</label>
          <input id="life_support_preference" placeholder="DNR / Full / Limited" />
        </div>
      </div>

      <div class="field">
        <label for="triage_override">Manual triage override</label>
        <select id="triage_override">
          <option value="">â€”</option>
          <option value="green">Green</option>
          <option value="yellow">Yellow</option>
          <option value="red">Red</option>
          <option value="black">Black</option>
        </select>
      </div>
    </section>

    <!-- Health -->
    <section class="card section" aria-labelledby="healthSection">
      <div class="card-head">
        <h2 id="healthSection">Health profile</h2>
      </div>

      <div class="field critical">
        <label for="allergies">Allergies</label>
        <textarea id="allergies" rows="2" placeholder="commaâ€‘separated"></textarea>
      </div>

      <div class="field warning">
        <label for="conditions">Conditions</label>
        <textarea id="conditions" rows="2" placeholder="commaâ€‘separated"></textarea>
      </div>

      <div class="field">
        <label for="medications">Medications</label>
        <textarea id="medications" rows="2" placeholder="commaâ€‘separated"></textarea>
      </div>

      <div class="field">
        <label for="implants">Implants / devices</label>
        <input id="implants" placeholder="e.g., pacemaker, insulin pump" />
      </div>

      <div class="field">
        <label for="notes">Clinical notes</label>
        <textarea id="notes" rows="3" placeholder="short, plain language notes"></textarea>
      </div>
    </section>

    <!-- ICE -->
    <section class="card section" aria-labelledby="iceSection">
      <div class="card-head">
        <h2 id="iceSection">ICE contacts</h2>
        <small class="muted">Up to 3 contacts</small>
      </div>

      <div id="iceList" class="ice-list"></div>

      <button id="addIce" class="btn primary">Add contact</button>
    </section>

    <!-- QR -->
    <section class="card section" aria-labelledby="qrSection">
      <div class="card-head">
        <h2 id="qrSection">QR Emergency Card</h2>
      </div>

      <div id="qr" class="qr-box"></div>

      <div class="row">
        <button id="btnRegenQR" class="btn primary">Generate / Regenerate QR</button>
        <a id="cardLink" class="btn ghost" href="#" target="_blank" rel="noopener">Open public card</a>
      </div>

      <p class="tiny muted">Your card and voice can be cached to this device for offline access.</p>
    </section>

    <!-- Backend Hooks (dev tools) -->
    <section class="card section" aria-labelledby="backendSection">
      <div class="card-head">
        <h2 id="backendSection">Backend actions</h2>
      </div>

      <div class="row wrap">
        <button id="btnBuildVoice" class="btn">Build Voice (TTS)</button>
        <button id="btnPreviewResponder" class="btn">Preview Responder JSON</button>
      </div>

      <div id="voiceWrap"></div>
      <pre id="previewOut" class="code-box" aria-live="polite"></pre>
    </section>
  </main>

  <footer class="app-footer">
    <ul class="badges">
      <li>GDPR</li><li>HIPAAâ€‘ready</li><li>Zero tracking</li><li>Onâ€‘device privacy</li>
    </ul>
    <p>Â© 2025 MYQER â€” Emergency Response QR</p>
  </footer>

  <!-- Scripts -->
  <script type="module" src="/scripts/config.js"></script>
  <script type="module" src="/scripts/app.js"></script>
  <script type="module" src="/scripts/backend_hooks.js"></script>

  <!-- SW + Logout (unchanged logic) -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/myqer_service_worker.js');
    }
  </script>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    import { SUPABASE_URL, SUPABASE_ANON_KEY } from '/scripts/config.js';
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const btn = document.getElementById('logout');
    if (btn) btn.addEventListener('click', async () => {
      await supabase.auth.signOut();
      location.replace('/login.html');
    });
  </script>
</body>
</html>
</body>
</html>
