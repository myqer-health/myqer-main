<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MYQER — Reset Password</title>
  <link rel="icon" type="image/png" sizes="192x192" href="/assets/icon-192.png" />
  <link rel="stylesheet" href="/styles/app.css" />
  <style>
    :root{ --er:#c62828; --line:#e5e9ef; }
    body{ margin:0; min-height:100vh; display:grid; place-items:center; background:linear-gradient(145deg,#f6f9fc,#ffffff); }
    .auth-card{
      width:min(560px,92vw); background:#fff; border:1px solid var(--line);
      border-radius:18px; box-shadow:0 8px 28px rgba(17,18,20,.08);
      padding:28px; text-align:left;
    }
    h1{ margin:0 0 6px; }
    p.muted{ margin:0 0 16px; color:#5f666d; }
    label{ display:block; font-size:14px; margin-bottom:6px; color:#21262c; }
    input{
      width:100%; height:48px; padding:12px 14px; font-size:16px;
      border:1.5px solid var(--line); border-radius:12px; background:#fff;
    }
    input:focus{ outline:none; border-color:var(--er); box-shadow:0 0 0 3px rgba(198,40,40,.12); }
    .btn{ display:inline-flex; align-items:center; justify-content:center;
      height:46px; padding:0 18px; border-radius:12px; border:0; cursor:pointer; font-weight:700; }
    .btn-primary{ background:var(--er); color:#fff; }
    .notice{ margin-top:12px; font-size:14px; color:#5f666d; }
  </style>
</head>
<body>
  <main class="auth-card">
    <h1>Reset your password</h1>
    <p class="muted">Enter the email for your MYQER account. We’ll send a secure reset link.</p>

    <form id="resetForm">
      <label for="email">Email</label>
      <input id="email" name="email" type="email" placeholder="you@example.com" required />
      <div style="margin-top:14px">
        <button class="btn btn-primary" type="submit">Send reset email</button>
      </div>
    </form>

    <p id="msg" class="notice" role="status" aria-live="polite"></p>
  </main>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    // pull from your existing config.js if you prefer:
    const SUPABASE_URL  = window.SUPABASE_URL  || 'https://YOUR-PROJECT-REF.supabase.co';
    const SUPABASE_ANON = window.SUPABASE_ANON_KEY || 'YOUR-ANON-KEY';
    const RESET_REDIRECT = location.origin + '/reset.html';  // handle both request + token on same page

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);
    const form = document.getElementById('resetForm');
    const msg  = document.getElementById('msg');

    // If the page is opened from the email link, the access_token will be in the hash.
    // Let users set a new password right away.
    const hash = location.hash || '';
    if (hash.includes('type=recovery') || hash.includes('access_token')) {
      // Simplest flow: prompt for new password
      const newPass = prompt('Enter a new password (min 8 characters):');
      if (newPass && newPass.length >= 8) {
        const { error } = await supabase.auth.updateUser({ password: newPass });
        if (error) { alert('Error: ' + error.message); }
        else { alert('Password updated. You can now sign in.'); location.href = '/login.html'; }
      }
    }

    form?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      msg.textContent = '';
      const email = (new FormData(form)).get('email');
      const { error } = await supabase.auth.resetPasswordForEmail(String(email), {
        redirectTo: RESET_REDIRECT
      });
      msg.textContent = error ? ('⚠️ ' + error.message) : '✅ Check your email for the reset link.';
    });
  </script>
</body>
</html>
