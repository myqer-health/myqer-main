<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reset Password — MYQER</title>
  <link rel="icon" type="image/png" sizes="192x192" href="/assets/icon-192.png" />
  <link rel="stylesheet" href="/styles/app.css" />
  <style>
    body{margin:0;background:linear-gradient(135deg,#f6f8fb,#ffffff)}
    .wrap{min-height:100vh;display:grid;place-items:center;padding:20px}
    .card{width:min(640px,94vw);background:#fff;border:1px solid #eceff3;border-radius:18px;
          box-shadow:0 12px 36px rgba(17,18,20,.08); padding:26px}
    h1{margin:0 0 8px}
    .muted{color:#6b6f76;margin:0 0 16px}
    .row{display:grid;gap:12px;margin:14px 0}
    input{height:48px;border:1px solid #dde3ea;border-radius:12px;padding:12px 14px;font-size:16px;width:100%}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .btn{height:44px;padding:0 18px;border-radius:999px;border:1px solid #e2e6ec;background:#fff;cursor:pointer}
    .btn-primary{background:#c62828;color:#fff;border-color:#c62828}
    .alert{display:none;margin-top:12px;padding:12px 14px;border-radius:10px;font-weight:600}
    .ok{background:#e9f8ee;color:#126b2f;border:1px solid #bfe8cd}
    .err{background:#fdecea;color:#9a1b1b;border:1px solid #f5c6c6}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Reset your password</h1>
      <p class="muted">Enter a new password for your MYQER account.</p>

      <div class="row">
        <label>New password</label>
        <input id="pw1" type="password" autocomplete="new-password" placeholder="••••••••" />
      </div>
      <div class="row">
        <label>Confirm password</label>
        <input id="pw2" type="password" autocomplete="new-password" placeholder="••••••••" />
      </div>

      <div class="actions">
        <button id="submit" class="btn btn-primary">Update password</button>
        <a class="btn" href="/login.html">Back to sign in</a>
      </div>

      <div id="ok" class="alert ok">✅ Password updated. Redirecting to app…</div>
      <div id="err" class="alert err">⚠️ Could not update password. Please try again.</div>
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    const supabase = createClient('https://YOUR-PROJECT-REF.supabase.co','YOUR-ANON-KEY');

    const ok = document.getElementById('ok');
    const err = document.getElementById('err');
    const btn = document.getElementById('submit');

    function show(el){ el.style.display='block'; }
    function hide(el){ el.style.display='none'; }

    // When the page opens from the email link, Supabase delivers a session in the URL.
    // No extra work needed; we just call updateUser() while that session is active.
    btn.addEventListener('click', async () => {
      hide(ok); hide(err);
      const p1 = document.getElementById('pw1').value.trim();
      const p2 = document.getElementById('pw2').value.trim();
      if (!p1 || p1 !== p2 || p1.length < 6) {
        err.textContent = '⚠️ Passwords must match and be at least 6 characters.'; show(err); return;
      }
      try {
        const { error } = await supabase.auth.updateUser({ password: p1 });
        if (error) throw error;
        show(ok);
        setTimeout(()=>location.href='/app.html', 1200);
      } catch(e){
        err.textContent = '⚠️ '+(e.message || 'Could not update password.'); show(err);
      }
    });
  </script>
</body>
</html>
