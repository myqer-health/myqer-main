<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign in — MYQER</title>

  <!-- Icons / PWA -->
  <link rel="icon" type="image/png" sizes="192x192" href="/images/icon-192.png" />
  <link rel="apple-touch-icon" href="/images/icon-192.png" />
  <link rel="manifest" href="/myqer_manifest.json" />
  <meta name="theme-color" content="#c62828" />

  <!-- Main site styles -->
  <link rel="stylesheet" href="/styles/app.css" />

  <!-- Scoped polish just for auth page -->
  <style>
    html, body { height: 100%; overflow-x: hidden; background: var(--wash,#f5f7fb); }
    .auth-wrap {
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .auth-card {
      --blur: 22px;
      background: rgba(255,255,255,.65);
      backdrop-filter: blur(var(--blur));
      -webkit-backdrop-filter: blur(var(--blur));
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,.08);
      width: min(92vw, 560px);
      padding: clamp(20px, 4vw, 36px);
    }
    .brand-row {
      display:flex; align-items:center; justify-content:space-between; margin-bottom: 8px;
    }
    .brand-row .brand { text-decoration:none; font-weight:800; letter-spacing:.2px; color:#111; }
    .brand-row .brand .er { color:#c62828; }
    .auth-title { font-size: clamp(28px, 4.2vw, 36px); line-height:1.1; margin: 6px 0 6px; }
    .auth-sub   { color:#555; margin:0 0 16px; }

    .field { margin: 12px 0; }
    .field label { display:block; font-weight:600; font-size:.95rem; margin-bottom:6px; }
    .input, .btn {
      width: 100%;
      border-radius: 14px;
      padding: 14px 16px;
      font-size: 1rem;
      border: 1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.9);
    }
    .input:focus { outline: none; border-color: #c62828; box-shadow: 0 0 0 3px rgba(198,40,40,.15); }
    .pw-wrap { position: relative; }
    .pw-toggle {
      position: absolute; right: 8px; top: 8px;
      border:1px solid rgba(0,0,0,.12); background:#fff; border-radius:999px;
      padding: 7px 12px; font-size:.9rem; cursor:pointer;
    }

    .btn { cursor:pointer; transition:.15s ease; }
    .btn.primary {
      background:#c62828; color:#fff; border-color:#c62828; font-weight:700;
    }
    .btn.primary:hover { filter:brightness(.95); }
    .btn.secondary {
      background:#fff; color:#111; border-color:rgba(0,0,0,.14);
    }
    .btn.linky { background:transparent; border:0; color:#555; text-decoration:underline; padding:10px 0; }

    .btn-lg { padding: 16px 18px; font-size:1.05rem; border-radius:16px; }
    .stack { display:grid; gap: 10px; margin-top: 14px; }

    .row-between { display:flex; justify-content:space-between; gap: 12px; align-items:center; }
    .muted { color:#6a6a6a; font-size:.9rem; }

    .alert { margin-top:12px; padding:12px 14px; border-radius:12px; font-weight:600; }
    .alert.err { background:#fff2f2; border:1px solid #ffbaba; color:#a70000; }
    .alert.ok  { background:#ecfbf1; border:1px solid #b9efcd; color:#0b6b3a; }

    @media (max-width: 420px) {
      .row-between { flex-direction: column; align-items: stretch; gap: 8px; }
    }
  </style>
</head>
<body>
  <main class="auth-wrap">
    <section class="auth-card" role="dialog" aria-labelledby="authTitle">
      <div class="brand-row">
        <a class="brand" href="/"><span>MYQ</span><span class="er">ER</span><sup>™</sup></a>
      </div>

      <h1 id="authTitle" class="auth-title">Sign in</h1>
      <p class="auth-sub">
        Use your email and password. New here?
        <strong>Create account</strong> below.
      </p>

      <form id="loginForm" novalidate>
        <div class="field">
          <label for="email">Email</label>
          <input id="email" class="input" type="email" placeholder="you@example.com" autocomplete="email" required />
        </div>

        <div class="field pw-wrap">
          <label for="password">Password</label>
          <input id="password" class="input" type="password" placeholder="Your password" autocomplete="current-password" required />
          <button class="pw-toggle" type="button" id="togglePw">Show</button>
        </div>

        <!-- Stacked CTAs -->
        <div class="stack">
          <button class="btn btn-lg primary" type="submit" id="btnSignin">Sign in</button>
          <a class="btn btn-lg secondary" href="/register.html">Create account</a>
          <a class="btn linky" href="/reset.html">Forgot password?</a>
        </div>

        <p class="muted" style="margin-top:14px">
          By continuing you agree to our
          <a href="/terms.html">Terms</a> and <a href="/privacy.html">Privacy</a>.
        </p>

        <div id="msg" class="alert" style="display:none"></div>
      </form>
    </section>
  </main>

  <!-- Supabase sign-in -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    import { SUPABASE_URL, SUPABASE_ANON_KEY } from '/scripts/config.js';

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const form = document.getElementById('loginForm');
    const msg  = document.getElementById('msg');
    const email = document.getElementById('email');
    const pw = document.getElementById('password');

    // Show/Hide password
    document.getElementById('togglePw')?.addEventListener('click', (e)=>{
      const t = e.currentTarget;
      if (pw.type === 'password') { pw.type = 'text'; t.textContent = 'Hide'; }
      else { pw.type = 'password'; t.textContent = 'Show'; }
    });

    function showMsg(text, ok=false){
      msg.textContent = text;
      msg.className = 'alert ' + (ok ? 'ok' : 'err');
      msg.style.display = 'block';
    }

    form?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      msg.style.display = 'none';

      const { data, error } = await supabase.auth.signInWithPassword({
        email: email.value.trim(),
        password: pw.value
      });

      if (error) {
        // Friendly messages
        const map = {
          'Invalid login credentials': 'Email or password is incorrect.',
          'Email not confirmed': 'Please confirm your email first (check your inbox).'
        };
        showMsg(map[error.message] || error.message);
        return;
      }

      // Success
      showMsg('Welcome back. Redirecting…', true);
      // Small delay so the user sees success state
      setTimeout(()=> location.replace('/app.html'), 250);
    });
  </script>
</body>
</html>
