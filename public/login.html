<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sign in — MYQER</title>
  <link rel="icon" type="image/png" sizes="192x192" href="/assets/icon-192.png" />
  <link rel="apple-touch-icon" href="/assets/icon-192.png" />
  <link rel="stylesheet" href="/styles/app.css" />
  <style>
    :root { --brand:#c62828; --glass:rgba(255,255,255,.55); --stroke:rgba(0,0,0,.08); --blur:22px; }
    body{margin:0;background:linear-gradient(135deg,#f7f8fb,#e9eef6);font:16px/1.5 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    .wrap{min-height:100dvh;display:grid;place-items:center;padding:24px}
    .card{width:min(520px,92vw);background:var(--glass);backdrop-filter:blur(var(--blur));
      border:1px solid var(--stroke);border-radius:18px;box-shadow:0 10px 24px rgba(0,0,0,.08);padding:24px}
    h1{margin:0 0 .5rem;font-size:28px;letter-spacing:-.02em}
    .sub{margin:0 0 16px;color:#555}
    label{display:block;margin:.6rem 0 .35rem;font-weight:600}
    input{width:100%;padding:.8rem 1rem;border-radius:12px;border:1px solid var(--stroke);
      background:#fff}
    .row{display:flex;gap:10px;align-items:center}
    .btn{border:1px solid var(--stroke);background:#fff;border-radius:999px;padding:.7rem 1.1rem;cursor:pointer}
    .btn-primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .btn-ghost{background:#fff}
    .note{margin-top:10px;color:#666;font-size:.9rem}
    .alert{border-radius:12px;padding:.7rem 1rem;margin:0 0 12px}
    .alert.error{background:#fff3f3;border:1px solid #ffd0d0;color:#8b0000}
    .alert.success{background:#f1fff3;border:1px solid #cfe8d5;color:#0a6b2d}
    .right{margin-left:auto}
    .input-wrap{position:relative}
    .toggle{position:absolute;right:8px;top:8px;height:36px;border-radius:10px;padding:0 10px}
    .brand{font-weight:800;letter-spacing:.02em}
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
        <div class="brand">MYQ<span style="color:#c62828">ER</span><sup>™</sup></div>
        <div class="right"></div>
      </div>

      <h1>Sign in</h1>
      <p class="sub">Use your email and password. New here? Click <strong>Create account</strong>.</p>

      <div id="msg" class="alert" style="display:none"></div>

      <label for="email">Email</label>
      <input id="email" type="email" autocomplete="email" inputmode="email" placeholder="you@example.com" />

      <label for="password">Password</label>
      <div class="input-wrap">
        <input id="password" type="password" autocomplete="current-password" placeholder="Your password" />
        <button id="togglePw" class="btn toggle" type="button" aria-label="Show password">Show</button>
      </div>

      <div class="row" style="margin-top:14px">
        <button id="btnSignIn" class="btn btn-primary">Sign in</button>
        <a class="btn btn-ghost" href="/reset.html">Forgot password?</a>
        <div class="right"></div>
        <button id="btnCreate" class="btn">Create account</button>
      </div>

      <p class="note" style="margin-top:14px">By continuing you agree to our <a href="/terms.html">Terms</a> and <a href="/privacy.html">Privacy</a>.</p>
    </section>
  </main>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    import { SUPABASE_URL, SUPABASE_ANON_KEY } from '/scripts/config.js';

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const msg = document.getElementById('msg');

    const show = (type, text) => {
      msg.className = 'alert ' + (type === 'error' ? 'error' : 'success');
      msg.textContent = text;
      msg.style.display = 'block';
    };

    document.getElementById('togglePw').addEventListener('click', () => {
      const v = password.getAttribute('type') === 'password' ? 'text' : 'password';
      password.setAttribute('type', v);
      document.getElementById('togglePw').textContent = v === 'password' ? 'Show' : 'Hide';
    });

    // If already logged in -> app
    supabase.auth.getSession().then(({ data }) => {
      if (data.session) location.replace('/app.html');
    });

    document.getElementById('btnSignIn').addEventListener('click', async () => {
      msg.style.display = 'none';
      const { data, error } = await supabase.auth.signInWithPassword({
        email: email.value.trim(), password: password.value
      });
      if (error) return show('error', error.message);
      location.replace('/app.html');
    });

    document.getElementById('btnCreate').addEventListener('click', async () => {
      msg.style.display = 'none';
      const e = email.value.trim();
      const p = password.value;
      if (!e || !p) return show('error', 'Enter an email and password first, then press Create account.');
      const { data, error } = await supabase.auth.signUp({
        email: e, password: p,
        options: { emailRedirectTo: 'https://myqer.com/app.html' }
      });
      if (error) return show('error', error.message);
      show('success', 'Check your inbox to confirm your email. Open the link on this device.');
    });
  </script>
</body>
</html>
